# Project Rules & Coding Standards

## ðŸš¨ Critical Database Rules (Zero Tolerance)
1. **Single Source of Truth**: `backend/database/models.py` is the absolute definition of the database schema. All changes must start here.
2. **Repository Pattern Only**:
   - **NEVER** write raw SQL (`SELECT`, `INSERT`, etc.) in application code.
   - **NEVER** use `psycopg2.connect()` or `asyncpg.connect()` directly.
   - **ALWAYS** use `backend.database.repository` classes (e.g., `NewsRepository`, `StockRepository`).
   - Use `get_sync_session()` for synchronous DB operations.
3. **Legacy Patterns Prohibited**:
   - Do not import `backend.data.news_models` (Deleted/Legacy).
   - Do not use SQLite for any news or trading features (PostgreSQL only).

## ðŸ“‚ File Structure Standards
- `backend/database/models.py`: All SQLAlchemy ORM models.
- `backend/database/repository.py`: All database interaction logic.
- `backend/database/migrations/`: One-off scripts and Alembic revisions.

## ðŸ¤– AI Agent Behavior (Antigravity/Claude)
- When asked to add a feature involving DB:
  1. Check `models.py` for existing tables.
  2. If a new table/column is needed, propose a `models.py` update first.
  3. Implement logic using extending `repository.py`.
- When asked to fix a DB error:
  1. Check if the error is due to direct SQL usage.
  2. If so, refactor to use the Repository pattern immediately.
