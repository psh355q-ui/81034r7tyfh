# ğŸ“š Phase 14: Deep Reasoning Strategy

**Version**: 1.0  
**Date**: 2025-11-26  
**Status**: êµ¬í˜„ ì™„ë£Œ  

---

## ğŸ¯ ê°œìš”

Phase 14ëŠ” **"ê¼¬ë¦¬ì— ê¼¬ë¦¬ë¥¼ ë¬´ëŠ”" 3ë‹¨ê³„ ì‹¬ì¸µ ì¶”ë¡ (Deep Reasoning)** ì „ëµì„ êµ¬í˜„í•©ë‹ˆë‹¤.

### ì™œ í•„ìš”í•œê°€?

**ë‹¨ìˆœ ë‰´ìŠ¤ ë¶„ì„ (ê¸°ì¡´)**
```
ë‰´ìŠ¤: "Google TPU v6 ë°œí‘œ"
â†’ 1ì°¨ì› íŒë‹¨: "Google í˜¸ì¬, ë§¤ìˆ˜"
ë¬¸ì œ: ì‹œì¥ì€ ì´ë¯¸ ì•Œê³  ìˆìŒ. ìˆ¨ì€ ìˆ˜í˜œì ë†“ì¹¨.
```

**ì‹¬ì¸µ ì¶”ë¡  (Phase 14)**
```
ë‰´ìŠ¤: "Google TPU v6 ë°œí‘œ"
â†’ Step 1: Google ì§ì ‘ í˜¸ì¬
â†’ Step 2: TPU í™•ëŒ€ â†’ Nvidia ì˜ì¡´â†“ â†’ Broadcom(TPU ì„¤ê³„) ìˆ˜í˜œ
â†’ Step 3: Hidden Beneficiary = AVGO (ë¸Œë¡œë“œì»´)
ê²°ë¡ : "ë‚¨ë“¤ì´ GOOGL ì‚´ ë•Œ, ìš°ë¦¬ëŠ” AVGOë¥¼ ì‚°ë‹¤"
```

---

## ğŸ—ï¸ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Deep Reasoning Pipeline                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  News Input                                                      â”‚
â”‚      â†“                                                           â”‚
â”‚  [Entity Extraction] - í•µì‹¬ ê¸°ì—…/í‚¤ì›Œë“œ ì¶”ì¶œ                      â”‚
â”‚      â†“                                                           â”‚
â”‚  [Knowledge Graph Lookup] - ê¸°ì¡´ ê´€ê³„ ì¡°íšŒ                       â”‚
â”‚      â†“                                                           â”‚
â”‚  [Live Verification] - ì‹¤ì‹œê°„ ê²€ìƒ‰ìœ¼ë¡œ ê´€ê³„ ê²€ì¦                  â”‚
â”‚      â†“                                                           â”‚
â”‚  [3-Step CoT Reasoning]                                          â”‚
â”‚      â”‚                                                           â”‚
â”‚      â”œâ”€ Step 1: Direct Impact (ì§ì ‘ ì˜í–¥)                        â”‚
â”‚      â”‚     "Google TPU â†’ Google í˜¸ì¬"                            â”‚
â”‚      â”‚                                                           â”‚
â”‚      â”œâ”€ Step 2: Secondary Impact (ê¼¬ë¦¬ ë¬¼ê¸°)                     â”‚
â”‚      â”‚     "TPU í™•ëŒ€ â†’ Nvidia ì˜ì¡´â†“ â†’ Broadcom ìˆ˜í˜œ"             â”‚
â”‚      â”‚                                                           â”‚
â”‚      â””â”€ Step 3: Strategic Conclusion                             â”‚
â”‚            "Primary: GOOGL, Hidden: AVGO, Loser: NVDA"           â”‚
â”‚      â†“                                                           â”‚
â”‚  [Action Items] - ì‹¤í–‰ ê°€ëŠ¥í•œ ë§¤ë§¤ ì‹ í˜¸                          â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ íŒŒì¼ êµ¬ì¡°

```
backend/
â”œâ”€â”€ config_phase14.py              # Phase 14 ì„¤ì • (AI ì—­í•  ë°°ì •)
â”œâ”€â”€ ai/
â”‚   â”œâ”€â”€ ai_client_factory.py       # AI í´ë¼ì´ì–¸íŠ¸ ì¶”ìƒí™” íŒ©í† ë¦¬
â”‚   â””â”€â”€ reasoning/
â”‚       â”œâ”€â”€ deep_reasoning.py      # í•µì‹¬ Deep Reasoning ì „ëµ
â”‚       â””â”€â”€ cot_prompts.py         # CoT í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ (Claude/Gemini/GPT)
â”œâ”€â”€ data/
â”‚   â””â”€â”€ knowledge_graph/
â”‚       â””â”€â”€ knowledge_graph.py     # Knowledge Graph (ê´€ê³„ ì €ì¥/ê²€ìƒ‰)
â”œâ”€â”€ backtesting/
â”‚   â””â”€â”€ ab_backtest.py             # A/B ë°±í…ŒìŠ¤íŠ¸ (Keyword vs CoT+RAG)
â”œâ”€â”€ apis/
â”‚   â””â”€â”€ reasoning_api.py           # REST API ì—”ë“œí¬ì¸íŠ¸
scripts/
â””â”€â”€ run_deep_reasoning.py          # ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸
docs/
â””â”€â”€ Phase14_DeepReasoning.md       # ì´ ë¬¸ì„œ
```

---

## ğŸš€ ë¹ ë¥¸ ì‹œì‘

### 1. ì„¤ì¹˜

```bash
cd ai-trading-system

# ì˜ì¡´ì„± ì„¤ì¹˜
pip install pydantic-settings google-generativeai anthropic openai

# ì„ íƒì  (A/B ë°±í…ŒìŠ¤íŠ¸ìš©)
pip install yfinance pandas numpy
```

### 2. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

```bash
# .env
ANTHROPIC_API_KEY=sk-ant-...
GEMINI_API_KEY=AIza...
OPENAI_API_KEY=sk-...  # ì„ íƒ (ì„ë² ë”©ìš©)

# Phase 14 ì„¤ì • (ì„ íƒ)
PHASE14_REASONING_MODEL_NAME=gemini-1.5-pro
PHASE14_ENABLE_LIVE_KNOWLEDGE_CHECK=true
```

### 3. ë°ëª¨ ì‹¤í–‰

```bash
# ì „ì²´ ë°ëª¨ (Mock ëª¨ë“œ)
python scripts/run_deep_reasoning.py --mode demo

# íŠ¹ì • ë‰´ìŠ¤ ë¶„ì„
python scripts/run_deep_reasoning.py --mode reasoning \
    --news "Google announced TPU v6 with Anthropic signing 1M TPU contract"

# A/B ë°±í…ŒìŠ¤íŠ¸
python scripts/run_deep_reasoning.py --mode backtest
```

---

## ğŸ§  í•µì‹¬ ì»´í¬ë„ŒíŠ¸

### 1. AI Client Factory

**Model-Agnostic ì„¤ê³„** - ì–´ë–¤ AIë“  êµì²´ ê°€ëŠ¥

```python
from backend.ai.ai_client_factory import AIClientFactory

# Gemini í´ë¼ì´ì–¸íŠ¸
client = AIClientFactory.create("gemini-1.5-pro")

# Claude í´ë¼ì´ì–¸íŠ¸
client = AIClientFactory.create("claude-3-haiku-20240307")

# OpenAI í´ë¼ì´ì–¸íŠ¸  
client = AIClientFactory.create("gpt-4o-mini")

# ëª¨ë‘ ë™ì¼í•œ ì¸í„°í˜ì´ìŠ¤
response = await client.call_api("Your prompt here")
search_result = await client.search_web("Your query")
```

### 2. Knowledge Graph

**ê¸°ì—… ê°„ ê´€ê³„ë¥¼ ê·¸ë˜í”„ë¡œ ì €ì¥**

```python
from backend.data.knowledge_graph.knowledge_graph import KnowledgeGraph

kg = KnowledgeGraph()

# ê´€ê³„ ì¶”ê°€
await kg.add_relationship(
    subject="Google",
    relation="partner",
    obj="Broadcom",
    evidence_text="Broadcom designs TPU interconnects"
)

# ê´€ê³„ ì¡°íšŒ
relations = await kg.get_relationships("Google")
# â†’ [{"subject": "Google", "relation": "partner", "object": "Broadcom"}, ...]

# ê²½ë¡œ íƒìƒ‰ (ê¼¬ë¦¬ ë¬¼ê¸°)
paths = await kg.find_path("Google", "Nvidia", max_depth=2)
# â†’ Google â†’ competitor â†’ Nvidia
# â†’ Google â†’ partner â†’ Broadcom â†’ customer â†’ Nvidia
```

### 3. Deep Reasoning Strategy

```python
from backend.ai.reasoning.deep_reasoning import DeepReasoningStrategy

strategy = DeepReasoningStrategy()

result = await strategy.analyze_news(
    "Google announced Gemini 3 trained entirely on TPUs"
)

# ê²°ê³¼ í™•ì¸
print(result.theme)               # "Rise of Custom AI Silicon"
print(result.primary_beneficiary) # {"ticker": "GOOGL", "action": "BUY", "confidence": 0.85}
print(result.hidden_beneficiary)  # {"ticker": "AVGO", "action": "BUY", "confidence": 0.90}
print(result.loser)               # {"ticker": "NVDA", "action": "TRIM", "confidence": 0.60}
print(result.reasoning_trace)     # ["1. Google TPU success...", "2. Broadcom benefits..."]
```

---

## ğŸ“Š A/B ë°±í…ŒìŠ¤íŠ¸

### ë¹„êµ ë°©ë²•

| ë°©ë²• | ì„¤ëª… | ì¥ì  | ë‹¨ì  |
|------|------|------|------|
| **Keyword-only** | í‚¤ì›Œë“œ ë§¤ì¹­ ê·œì¹™ | ë¹ ë¦„, ì €ë¹„ìš© | ìˆ¨ì€ ìˆ˜í˜œì ë†“ì¹¨ |
| **CoT+RAG** | ì‹¬ì¸µ ì¶”ë¡  + ì§€ì‹ ê·¸ë˜í”„ | Hidden Beneficiary ë°œêµ´ | AI ë¹„ìš© ë°œìƒ |

### ì‹¤í–‰

```bash
python scripts/run_deep_reasoning.py --mode backtest
```

### ì˜ˆìƒ ê²°ê³¼

```
===============================================================================
                    A/B BACKTEST COMPARISON REPORT
===============================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Metric              â”‚ Keyword-only     â”‚ CoT+RAG                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Avg Abnormal Return â”‚          5.20%   â”‚                12.40%  â”‚
â”‚ Hit Rate            â”‚         60.00%   â”‚                80.00%  â”‚
â”‚ Sharpe Ratio        â”‚           0.45   â”‚                  1.12  â”‚
â”‚ Total Signals       â”‚              8   â”‚                    12  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ† WINNER: CoT+RAG (+138.5% improvement)
```

---

## ğŸ”Œ API ì—”ë“œí¬ì¸íŠ¸

### POST /api/v1/reasoning/analyze

```bash
curl -X POST http://localhost:8000/api/v1/reasoning/analyze \
  -H "Content-Type: application/json" \
  -d '{
    "news_text": "Google announced TPU v6",
    "enable_verification": true
  }'
```

**ì‘ë‹µ:**
```json
{
  "success": true,
  "theme": "Rise of Custom AI Silicon",
  "primary_beneficiary": {
    "ticker": "GOOGL",
    "action": "BUY",
    "confidence": 0.85
  },
  "hidden_beneficiary": {
    "ticker": "AVGO",
    "action": "BUY",
    "confidence": 0.90
  },
  "reasoning_trace": [
    "1. Google TPU v6 reduces Nvidia dependency",
    "2. Broadcom designs TPU â†’ hidden beneficiary"
  ]
}
```

### GET /api/v1/reasoning/knowledge/{entity}

```bash
curl http://localhost:8000/api/v1/reasoning/knowledge/Google
```

### GET /api/v1/reasoning/backtest

```bash
curl http://localhost:8000/api/v1/reasoning/backtest
```

---

## âš™ï¸ ì„¤ì • ì˜µì…˜

### config_phase14.py

```python
class Phase14Settings:
    # AI ëª¨ë¸ ì—­í•  ë°°ì •
    REASONING_MODEL_NAME = "gemini-1.5-pro"  # ì‹¬ì¸µ ì¶”ë¡ ìš©
    SCREENER_MODEL_NAME = "gemini-1.5-flash"  # ë¹ ë¥¸ ìŠ¤í¬ë¦¬ë‹
    
    # ì‹¤ì‹œê°„ ê²€ì¦
    ENABLE_LIVE_KNOWLEDGE_CHECK = True
    KNOWLEDGE_VERIFY_INTERVAL_HOURS = 24
    
    # ì¶”ë¡  ì„¤ì •
    REASONING_STEPS = 3
    MAX_REASONING_DEPTH = 3
    CONFIDENCE_THRESHOLD = 0.6
    
    # ë¹„ìš© ê´€ë¦¬
    DAILY_REASONING_LIMIT = 10
    MAX_REASONING_TOKENS = 4000
    REASONING_CACHE_TTL_HOURS = 12
```

---

## ğŸ’° ë¹„ìš© ë¶„ì„

| ëª¨ë¸ | ì—­í•  | ë¹„ìš©/í˜¸ì¶œ | ì¼ 10íšŒ | ì›” ë¹„ìš© |
|------|------|----------|---------|---------|
| Gemini 1.5 Pro | Reasoning | ~$0.007 | $0.07 | **$2.10** |
| Gemini 1.5 Flash | Screener | ~$0.0003 | $0.003 | $0.09 |
| Claude Haiku | Decision | ~$0.001 | $0.01 | $0.30 |

**ì´ ì˜ˆìƒ ë¹„ìš©: ~$2.50/ì›”** (ì¼ 10íšŒ ì‹¬ì¸µ ì¶”ë¡  ê¸°ì¤€)

---

## ğŸ”§ í™•ì¥ ê°€ì´ë“œ

### ìƒˆ AI ê³µê¸‰ì ì¶”ê°€

```python
# backend/ai/ai_client_factory.py

class MyCustomClient(BaseAIClient):
    async def call_api(self, prompt, max_tokens=2000, temperature=0.3, system_prompt=None):
        # êµ¬í˜„
        pass
    
    async def search_web(self, query):
        # êµ¬í˜„
        pass

# íŒ©í† ë¦¬ì— ë“±ë¡
AIClientFactory._providers["mycustom"] = MyCustomClient
```

### ìƒˆ ê´€ê³„ íƒ€ì… ì¶”ê°€

```python
# backend/config_phase14.py

RELATIONSHIP_TYPES = [
    "partner",
    "competitor",
    "supplier",
    "customer",
    "investor",
    # ìƒˆ íƒ€ì… ì¶”ê°€
    "acquirer",      # ì¸ìˆ˜ì
    "joint_venture"  # í•©ì‘ íˆ¬ì
]
```

---

## ğŸ“ í•µì‹¬ ì¸ì‚¬ì´íŠ¸ (Gemini + ChatGPT ì œì•ˆ)

### 1. ì—”ë¹„ë””ì•„ ë…ì ì˜ ê· ì—´
- Google TPU + Anthropic ê³„ì•½ = "ë°˜(å) ì—”ë¹„ë””ì•„ ì—°í•©"
- ë¹…í…Œí¬ ìì²´ ì¹© ê°œë°œ ê°€ì†í™”
- Broadcom = "AI ì‹œëŒ€ì˜ ìˆ¨ì€ ìˆ˜í˜œì"

### 2. ì—ë„ˆì§€ ìœ„ê¸° ì—°ê²°ê³ ë¦¬
```
AI í­ë°œ â†’ ë°ì´í„°ì„¼í„° í™•ëŒ€ â†’ ì „ë ¥ ë¶€ì¡± â†’ ì›ìë ¥/SMR ìˆ˜ìš”
â†’ ìˆ¨ì€ ìˆ˜í˜œì: Vistra, Constellation Energy, ë³€ì••ê¸° ê´€ë ¨ì£¼
```

### 3. ë©”ëª¨ë¦¬ ìŠˆí¼ì‚¬ì´í´ ì—­ì„¤
- "ìŠ¤ë§ˆíŠ¸í° ë©”ëª¨ë¦¬ ì¡°ë‹¬ ì¤‘ë‹¨" = ê²‰ë³´ê¸° ì•…ì¬
- ì‹¤ì œ: ê³µê¸‰ì ìš°ìœ„ ì‹œì¥ = ê°€ê²© ê²°ì •ê¶Œ = **í˜¸ì¬**
- AIê°€ "ì—­ë°œìƒ" ë¶„ì„ì„ ìˆ˜í–‰í•˜ë„ë¡ ì»¨í…ìŠ¤íŠ¸ ì£¼ì…

---

## ğŸ“ Changelog

### v1.0.0 (2025-11-26)
- ì´ˆê¸° êµ¬í˜„
- Deep Reasoning Strategy
- Knowledge Graph
- AI Client Factory (Model-Agnostic)
- A/B Backtest Engine
- REST API
- CoT í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ (Claude/Gemini/GPT)

---

## ğŸ”— ê´€ë ¨ ë¬¸ì„œ

- [MASTER_GUIDE.md](../MASTER_GUIDE.md) - ì „ì²´ í”„ë¡œì íŠ¸ ê°€ì´ë“œ
- [config_phase14.py](../backend/config_phase14.py) - ì„¤ì • íŒŒì¼
- [Spec-Kit ë¬¸ì„œ](https://github.com/github/spec-kit)

---

*"The market can stay irrational longer than you can stay solvent, but deep reasoning helps you stay rational."*
