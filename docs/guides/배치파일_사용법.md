# 🚀 배치 파일 사용 가이드

## 📁 배치 파일 목록

데이터 수집을 쉽게 실행할 수 있도록 6개의 배치 파일을 제공합니다.

| 순서 | 파일명 | 용도 | 실행 시점 |
|------|--------|------|----------|
| 1️⃣ | **1_DB_마이그레이션.bat** | 데이터베이스 테이블 생성 | 최초 1회만 |
| 2️⃣ | **2_데이터수집_테스트.bat** | 5분 테스트 실행 | 시스템 확인용 |
| 3️⃣ | **3_데이터수집_시작.bat** | 실제 데이터 수집 (14일) | 매일 실행 |
| 4️⃣ | **4_모니터링_대시보드.bat** | 실시간 모니터링 | 선택적 |
| 5️⃣ | **5_품질리포트_생성.bat** | 품질 리포트 | 주기적 확인 |
| 6️⃣ | **6_로그_확인.bat** | 로그 파일 보기 | 문제 발생 시 |

---

## 🎯 사용 순서

### 1️⃣ 최초 1회 - DB 마이그레이션

**실행 파일**: `1_DB_마이그레이션.bat`

```
더블클릭 → Enter 입력 (비밀번호) → 완료
```

**역할**:
- `constitutional_validations` 테이블 생성
- `constitutional_violations` 테이블 생성

**예상 시간**: 5초

**성공 메시지**:
```
✅ 마이그레이션 완료

생성된 테이블:
  ✅ constitutional_validations
  ✅ constitutional_violations
```

**오류 발생 시**:
- PostgreSQL이 실행 중인지 확인
- 데이터베이스 `ai_trading_system`이 존재하는지 확인
- psql이 PATH에 등록되어 있는지 확인

---

### 2️⃣ 시스템 테스트 (선택)

**실행 파일**: `2_데이터수집_테스트.bat`

```
더블클릭 → 5분 대기 → 결과 확인
```

**역할**:
- 5분간 시스템 정상 작동 확인
- 뉴스 수집 테스트
- War Room 토론 테스트
- Constitutional 검증 테스트

**예상 시간**: 약 5분

**성공 기준**:
- ✅ 뉴스 기사 1개 이상 수집
- ✅ War Room 토론 1개 이상 실행
- ✅ Constitutional 검증 정상 작동
- ✅ 로그 파일 생성

---

### 3️⃣ 실제 데이터 수집 시작

**실행 파일**: `3_데이터수집_시작.bat`

```
더블클릭 → 백그라운드 실행 유지
```

**역할**:
- 14일간 데이터 수집
- 100개 토론 목표
- 5분 간격 뉴스 체크

**실행 방식**:
- **창을 닫지 마세요!** (최소화는 가능)
- 매일 백엔드 켤 때마다 실행
- Ctrl+C로 중단 가능

**예상 시간**: 14일 (목표 달성 시 자동 종료)

**화면 출력 예시**:
```
================================================================================
🚀 데이터 수집 시작
================================================================================

실행 모드: 연속 수집 (14일, 100개 토론 목표)
뉴스 체크 간격: 5분

[CYCLE #1] - 2025-12-27 10:00:00
================================================================================

[PHASE 1] News Collection
   📰 RSS Crawler...
      ✅ 3 articles from RSS

[PHASE 2] War Room Analysis
   [1/3] Analyzing: Apple announces...
      ✅ Signal: BUY AAPL
      📊 Confidence: 85.0%
      🏛️ Constitutional: ✅ PASS
```

---

### 4️⃣ 실시간 모니터링 (선택)

**실행 파일**: `4_모니터링_대시보드.bat`

```
더블클릭 → 실시간 대시보드 확인
```

**역할**:
- 수집 현황 실시간 표시
- 품질 지표 모니터링
- 최근 검증 기록 표시

**실행 방식**:
- **별도 창에서 실행** (3번과 동시 실행)
- 5초마다 자동 갱신
- Ctrl+C로 종료

**대시보드 내용**:
```
================================================================================
🎯 DATA ACCUMULATION MONITOR
================================================================================

📊 ACCUMULATION STATS
   News articles:   45
   Debates:         12
   Unique tickers:  8

🏛️ CONSTITUTIONAL VALIDATION
   Total validations: 12
   Violations:        1
   Pass rate:         91.7%

📋 RECENT VALIDATIONS
   2025-12-27 10:29 | AAPL | BUY  | 85% | ✅ PASS
   2025-12-27 10:25 | NVDA | HOLD | 75% | ✅ PASS
```

---

### 5️⃣ 품질 리포트 생성 (주기적)

**실행 파일**: `5_품질리포트_생성.bat`

```
더블클릭 → 리포트 확인
```

**역할**:
- 최근 7일 데이터 분석
- 종합 품질 점수 계산
- JSON 파일로 저장

**실행 주기**:
- 일주일에 1-2회
- 또는 확인이 필요할 때

**리포트 내용**:
```
📊 DATA QUALITY REPORT
================================================================================
Period: Last 7 days

📰 NEWS QUALITY
   Articles collected:  145
   Coverage score:      72.5/100

🎭 DEBATE QUALITY
   Avg confidence:      81.5%

🏛️ CONSTITUTIONAL COMPLIANCE
   Compliance rate:     92.1%

📊 SIGNAL QUALITY
   Ticker coverage:     15 unique tickers

OVERALL QUALITY SCORE: 84.6/100
Quality Rating: 🟡 GOOD
```

---

### 6️⃣ 로그 확인 (문제 발생 시)

**실행 파일**: `6_로그_확인.bat`

```
더블클릭 → 최근 로그 확인
```

**역할**:
- 로그 파일 목록 표시
- 최근 30줄 출력
- 오류 확인용

**확인 시점**:
- 에러 발생 시
- 수집이 안 될 때
- 문제 진단 필요 시

---

## 💡 일일 사용 패턴

### 백엔드 시작할 때마다

```
1. 3_데이터수집_시작.bat 더블클릭
2. (선택) 4_모니터링_대시보드.bat 더블클릭 (별도 창)
3. 창 최소화 후 작업 진행
4. 백엔드 종료 시 Ctrl+C로 중단
```

### 주간 체크 (일주일에 1회)

```
1. 5_품질리포트_생성.bat 실행
2. 품질 점수 확인
3. 80점 이상이면 정상
4. 60점 미만이면 6_로그_확인.bat으로 원인 파악
```

---

## ⚠️ 주의사항

### ✅ 해야 할 것

- ✅ 최초 1회 `1_DB_마이그레이션.bat` 실행
- ✅ `3_데이터수집_시작.bat` 창 유지 (최소화는 가능)
- ✅ 매일 백엔드와 함께 실행
- ✅ 주기적으로 품질 리포트 확인

### ❌ 하지 말아야 할 것

- ❌ `3_데이터수집_시작.bat` 창 닫기 (데이터 수집 중단됨)
- ❌ PostgreSQL 종료 (DB 오류 발생)
- ❌ logs 폴더 삭제 (기록 손실)

---

## 🔧 문제 해결

### 문제 1: "Python을 찾을 수 없습니다"

**원인**: Python이 PATH에 등록되지 않음

**해결**:
1. Python 설치 확인
2. 환경변수 PATH에 Python 경로 추가
3. 또는 절대 경로 사용: `C:\Python311\python.exe`

---

### 문제 2: "psql을 찾을 수 없습니다"

**원인**: PostgreSQL이 PATH에 등록되지 않음

**해결**:
1. PostgreSQL 설치 확인
2. PATH에 추가: `C:\Program Files\PostgreSQL\15\bin`
3. 또는 Docker 사용 중이면 Docker Exec 사용

---

### 문제 3: "뉴스가 수집되지 않습니다"

**원인**: 네트워크 또는 API 문제

**해결**:
1. 인터넷 연결 확인
2. `6_로그_확인.bat`로 에러 확인
3. Gemini API 키 확인 (.env 파일)

---

### 문제 4: "데이터베이스 연결 실패"

**원인**: PostgreSQL 미실행

**해결**:
```bash
# Docker 사용 시
docker start ai-trading-postgres

# 로컬 설치 시
net start postgresql-x64-15
```

---

## 📊 데이터 확인

### 데이터베이스 쿼리

```sql
-- PostgreSQL 접속
psql -U postgres -d ai_trading_system

-- 현재까지 수집 통계
SELECT
    COUNT(*) as 총토론수,
    COUNT(DISTINCT ticker) as 고유티커수,
    ROUND(100.0 * SUM(CASE WHEN is_constitutional THEN 1 ELSE 0 END) / COUNT(*), 1) as 통과율
FROM constitutional_validations;

-- 최근 기록
SELECT * FROM constitutional_validations
ORDER BY validation_timestamp DESC
LIMIT 10;
```

---

## 📁 생성되는 파일

```
D:\code\ai-trading-system\
├── logs\
│   ├── data_accumulation.log               ← 메인 로그
│   ├── constitutional_validations.jsonl    ← 검증 백업
│   ├── accumulation_stats_*.json           ← 세션 통계
│   └── quality_report_*.json               ← 품질 리포트
```

---

## ✅ 목표 달성 기준

14일 후 이런 결과가 나오면 성공:

| 지표 | 목표 |
|------|------|
| ✅ 수집 기간 | 14일+ |
| ✅ 토론 수 | 100개+ |
| ✅ 고유 티커 | 10개+ |
| ✅ Constitutional 통과율 | 90%+ |
| ✅ 평균 신뢰도 | 75%+ |
| ✅ 전체 품질 점수 | 80점+ |

---

**작성일**: 2025-12-27
**버전**: 1.0

**참고 문서**:
- [DATA_ACCUMULATION.md](DATA_ACCUMULATION.md)
- [시작하기.md](시작하기.md)
- [실행가이드.md](실행가이드.md)
