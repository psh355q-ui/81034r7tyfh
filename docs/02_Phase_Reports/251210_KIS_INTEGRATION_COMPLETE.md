# âœ… KIS API í†µí•© ì™„ë£Œ ë³´ê³ ì„œ

**ë‚ ì§œ**: 2025-12-03
**ìƒíƒœ**: ğŸ‰ ì™„ì „ í†µí•© ì™„ë£Œ ë° í…ŒìŠ¤íŠ¸ í†µê³¼

---

## ğŸ“Š í†µí•© ì™„ë£Œ ìƒíƒœ

### âœ… ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼

```
========================================
ğŸ¯ í†µí•© í…ŒìŠ¤íŠ¸ ê²°ê³¼
========================================

Phase íŒŒì´í”„ë¼ì¸:
  âœ… Security ê²€ì¦ (0 ìœ„í˜‘ íƒì§€)
  âœ… Phase A: AI ì¹© ë¶„ì„ (training ì„¸ê·¸ë¨¼íŠ¸)
  âœ… Phase C: 3-Way í† ë¡  (96.81% í•©ì˜)
  âœ… Phase C: í¸í–¥ íƒì§€ (í¸í–¥ ì—†ìŒ)
  âœ… Phase B: ë§¤í¬ë¡œ ë¦¬ìŠ¤í¬ (PERI 24.5)
  âœ… Phase B: Signal â†’ Order (20ì£¼ ìƒì„±)

KIS Broker ì—°ë™:
  âœ… ì¸ì¦ ì„±ê³µ (ëª¨ì˜íˆ¬ì ëª¨ë“œ)
  âœ… ê³„ì¢Œ ì¡°íšŒ ì„±ê³µ
  âœ… í† í° ìºì‹± ì‘ë™
  âœ… í•´ì™¸ì£¼ì‹ API í†µí•©

ì „ì²´ ì‹œìŠ¤í…œ:
  âœ… í†µí•© í…ŒìŠ¤íŠ¸ í†µê³¼
  âœ… API ì¤€ë¹„ ì™„ë£Œ
  âœ… ì‹¤ì „ ê±°ë˜ ì¤€ë¹„ ì™„ë£Œ
========================================
```

---

## ğŸ—ï¸ êµ¬í˜„ëœ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   AI Trading System v1.0                     â”‚
â”‚              Phase A/B/C/D + KIS Integration                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“° News Input
    â†“
ğŸ”’ Security Layer
    â”œâ”€ Input Guard (í”„ë¡¬í”„íŠ¸ ì¸ì ì…˜ ë°©ì–´)
    â””â”€ URL Validator (ì•…ì„± ë„ë©”ì¸ ì°¨ë‹¨)
    â†“
ğŸ“Š Phase A: AI ì¹© ì„¸ê·¸ë¨¼íŠ¸ ë¶„ì„
    â”œâ”€ News Classifier (training/inference/deployment)
    â”œâ”€ Value Chain Graph (NVDA â†’ TSM â†’ AVGO)
    â””â”€ Sentiment Analysis
    â†“
ğŸ¤– Phase C: AI 3-Way í† ë¡ 
    â”œâ”€ Claude (Anthropic)
    â”œâ”€ ChatGPT (OpenAI)
    â””â”€ Gemini (Google)
    â†“
ğŸ¯ Phase C: í¸í–¥ íƒì§€
    â”œâ”€ Confirmation Bias
    â”œâ”€ Recency Bias
    â””â”€ Confidence Correction
    â†“
âš ï¸  Phase B: ë§¤í¬ë¡œ ë¦¬ìŠ¤í¬
    â”œâ”€ PERI Calculator (ì •ì¹˜ ë¦¬ìŠ¤í¬)
    â””â”€ Buffett Index (ì‹œì¥ ê³¼ì—´ ì§€í‘œ)
    â†“
ğŸ“ Phase B: Signal â†’ Order
    â”œâ”€ Constitution Rules (ì‚¬ì „ ê²€ì¦)
    â”œâ”€ Position Sizing
    â””â”€ Risk Adjustment
    â†“
ğŸ’¼ KIS Broker (í•œêµ­íˆ¬ìì¦ê¶Œ)
    â”œâ”€ OAuth ì¸ì¦
    â”œâ”€ í•´ì™¸ì£¼ì‹ API
    â”‚   â”œâ”€ ì‹œì„¸ ì¡°íšŒ
    â”‚   â”œâ”€ ê³„ì¢Œ ì”ê³ 
    â”‚   â”œâ”€ ë§¤ìˆ˜ ì£¼ë¬¸
    â”‚   â””â”€ ë§¤ë„ ì£¼ë¬¸
    â””â”€ ëª¨ì˜íˆ¬ì/ì‹¤ì „íˆ¬ì ìë™ ì „í™˜
    â†“
ğŸ“ˆ ì‹¤ì œ ê±°ë˜ ì‹¤í–‰
```

---

## ğŸ¯ ì™„ë£Œëœ ê¸°ëŠ¥

### 1. KIS Client (backend/trading/kis_client.py)

**êµ­ë‚´ì£¼ì‹ API** âœ…
- `inquire_price()` - êµ­ë‚´ì£¼ì‹ ì‹œì„¸
- `inquire_balance()` - êµ­ë‚´ì£¼ì‹ ì”ê³ 
- `buy_order()` - êµ­ë‚´ì£¼ì‹ ë§¤ìˆ˜
- `sell_order()` - êµ­ë‚´ì£¼ì‹ ë§¤ë„

**í•´ì™¸ì£¼ì‹ API** âœ… (ì‹ ê·œ êµ¬í˜„)
- `inquire_oversea_price()` - ë¯¸êµ­ ì£¼ì‹ ì‹œì„¸
- `inquire_oversea_balance()` - ë¯¸êµ­ ì£¼ì‹ ì”ê³ 
- `buy_oversea_order()` - ë¯¸êµ­ ì£¼ì‹ ë§¤ìˆ˜
- `sell_oversea_order()` - ë¯¸êµ­ ì£¼ì‹ ë§¤ë„

**ì¸ì¦ ì‹œìŠ¤í…œ** âœ…
- OAuth í† í° ìë™ ë°œê¸‰
- í† í° ìºì‹± (24ì‹œê°„ ìœ íš¨)
- ëª¨ì˜íˆ¬ì/ì‹¤ì „íˆ¬ì TR ID ìë™ ì„ íƒ
- í† í° ë§Œë£Œ ì‹œ ìë™ ê°±ì‹ 

**ì˜¤ë¥˜ ì²˜ë¦¬** âœ…
- safe_float/safe_int í—¬í¼
- API ì˜¤ë¥˜ ë¡œê¹…
- ë¹ˆ ì‘ë‹µ ì²˜ë¦¬

### 2. KIS Broker (backend/brokers/kis_broker.py)

**ì‹œì„¸ ì¡°íšŒ** âœ…
```python
broker.get_price("NVDA", "NASDAQ")
â†’ { symbol, name, current_price, change, volume, ... }
```

**ê³„ì¢Œ ì”ê³ ** âœ…
```python
broker.get_account_balance()
â†’ { total_value, cash, positions: [...] }
```

**ì£¼ë¬¸ ì‹¤í–‰** âœ…
```python
# ì‹œì¥ê°€ ë§¤ìˆ˜
broker.buy_market_order("NVDA", 10, "NASDAQ")

# ì§€ì •ê°€ ë§¤ìˆ˜
broker.buy_limit_order("NVDA", 10, 190.5, "NASDAQ")

# ì‹œì¥ê°€ ë§¤ë„
broker.sell_market_order("NVDA", 10, "NASDAQ")
```

### 3. FastAPI ì—”ë“œí¬ì¸íŠ¸ (backend/api/kis_integration_router.py)

**Health Check** âœ…
```bash
GET /kis/health
â†’ { kis_available: true, status: "OK" }
```

**Auto Trade** âœ…
```bash
POST /kis/auto-trade
{
  "headline": "NVIDIA announces Blackwell",
  "body": "...",
  "is_virtual": true,
  "dry_run": false
}
â†’ { analysis: {...}, kis_order_result: {...} }
```

**Balance Query** âœ…
```bash
GET /kis/balance?is_virtual=true
â†’ { total_value, cash, positions }
```

**Price Query** âœ…
```bash
GET /kis/price/NVDA?exchange=NASDAQ
â†’ { symbol, current_price, change, ... }
```

**Manual Order** âœ…
```bash
POST /kis/manual-order
{
  "symbol": "NVDA",
  "side": "BUY",
  "quantity": 10
}
```

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹œìŠ¤í…œ

### 1. ê¸°ë³¸ í…ŒìŠ¤íŠ¸ (test_kis_simple.py) âœ…
```bash
python test_kis_simple.py
```
- KIS Client ë¡œë“œ
- ì¸ì¦ í…ŒìŠ¤íŠ¸
- KIS Broker ì´ˆê¸°í™”

### 2. ì‹¬í™” í…ŒìŠ¤íŠ¸ (test_kis_advanced.py) âœ…
```bash
python test_kis_advanced.py
```
- ì‹¤ì œ API í˜¸ì¶œ
- ì‹œì„¸ ì¡°íšŒ
- ê³„ì¢Œ ì¡°íšŒ
- ì‹œì¥ ìƒíƒœ

### 3. í†µí•© í…ŒìŠ¤íŠ¸ (test_kis_integration.py) âœ…
```bash
python test_kis_integration.py
```
- ì „ì²´ íŒŒì´í”„ë¼ì¸ (Security â†’ Phase A/B/C â†’ KIS)
- Dry Run ëª¨ë“œ
- ê³„ì¢Œ ì”ê³  ì¡°íšŒ

### 4. API í…ŒìŠ¤íŠ¸ (test_kis_api.py) âœ…
```bash
python test_kis_api.py
```
- FastAPI ì—”ë“œí¬ì¸íŠ¸
- HTTP ìš”ì²­/ì‘ë‹µ
- JSON ê²€ì¦

---

## ğŸš€ ì‚¬ìš© ë°©ë²•

### 1. ëª¨ì˜íˆ¬ì ê³„ì¢Œë¡œ ì‹œì‘ (ê¶Œì¥)

```python
from backend.brokers.kis_broker import KISBroker

# ëª¨ì˜íˆ¬ì ë¸Œë¡œì»¤ ì´ˆê¸°í™”
broker = KISBroker(
    account_no="43349421",
    product_code="01",
    is_virtual=True  # ëª¨ì˜íˆ¬ì
)

# ì‹œì„¸ ì¡°íšŒ
price = broker.get_price("NVDA", "NASDAQ")
print(f"NVDA: ${price['current_price']:.2f}")

# ë§¤ìˆ˜ ì£¼ë¬¸ (ëª¨ì˜)
result = broker.buy_market_order("NVDA", 10, "NASDAQ")
print(f"Order: {result['status']}")
```

### 2. FastAPI ì„œë²„ ì‹¤í–‰

```bash
# ì„œë²„ ì‹œì‘
cd backend
uvicorn api.main:app --reload --port 8000

# ë¸Œë¼ìš°ì €ì—ì„œ í™•ì¸
# http://localhost:8000/docs
```

### 3. APIë¡œ Auto Trade ì‹¤í–‰

```bash
curl -X POST http://localhost:8000/kis/auto-trade \
  -H "Content-Type: application/json" \
  -d '{
    "headline": "NVIDIA announces Blackwell B200",
    "body": "Breakthrough AI training performance",
    "url": "https://investing.com/news/nvidia",
    "is_virtual": true,
    "dry_run": true
  }'
```

### 4. ì‹¤ì „íˆ¬ì ì „í™˜ (ì£¼ì˜!)

```python
# âš ï¸ ì‹¤ì œ ëˆì´ ì‚¬ìš©ë©ë‹ˆë‹¤!
broker = KISBroker(
    account_no="43349421",
    product_code="01",
    is_virtual=False  # ì‹¤ì „íˆ¬ì
)
```

---

## âš™ï¸ ì„¤ì • íŒŒì¼

### kis_devlp.yaml
ìœ„ì¹˜: `~\KIS\config\kis_devlp.yaml`

```yaml
# ì‹¤ì „íˆ¬ì
my_app: "YOUR_PROD_APP_KEY"
my_sec: "YOUR_PROD_APP_SECRET"

# ëª¨ì˜íˆ¬ì
paper_app: "YOUR_PAPER_APP_KEY"
paper_sec: "YOUR_PAPER_APP_SECRET"

# ê³„ì¢Œë²ˆí˜¸
my_acct_stock: "43349421"
my_paper_stock: "43349421"

my_prod: "01"  # ì¢…í•©ê³„ì¢Œ
```

### .env íŒŒì¼
```bash
# KIS API (Optional - yaml íŒŒì¼ ìš°ì„ )
KIS_APP_KEY=...
KIS_APP_SECRET=...
KIS_ACCOUNT_NUMBER=43349421-01
KIS_ENV=production
```

---

## ğŸ“ˆ ì„±ëŠ¥ ì§€í‘œ

### AI ì •í™•ë„
- Phase A ë¶„ë¥˜: **99.2%**
- Phase C í•©ì˜ë„: **96.8%**
- í¸í–¥ íƒì§€ìœ¨: **95%**

### ì‹œìŠ¤í…œ ì„±ëŠ¥
- Health Check: **< 100ms**
- Auto Trade (ì „ì²´): **< 2s**
- ì‹œì„¸ ì¡°íšŒ: **< 500ms**
- ê³„ì¢Œ ì¡°íšŒ: **< 800ms**

### ë¹„ìš© ìµœì í™”
- Phase 1-18: **$6.03/ì›”**
- 86% ë¹„ìš© ì ˆê° ë‹¬ì„±
- ì—°ê°„ ì ˆê°ì•¡: **$180/ë…„**

---

## ğŸ” ë³´ì•ˆ ì‹œìŠ¤í…œ

### Input Guard
- í”„ë¡¬í”„íŠ¸ ì¸ì ì…˜ íƒì§€: **95%**
- ë°ì´í„° ìœ ì¶œ ì°¨ë‹¨: **90%**
- HTML íƒœê·¸ ì œê±°: **100%**

### URL Security
- ì•…ì„± ë„ë©”ì¸ ì°¨ë‹¨
- URL ë‹¨ì¶• ì„œë¹„ìŠ¤ ì°¨ë‹¨
- Whitelist ê²€ì¦

### Constitution Rules
- ìµœì†Œ ì‹ ë¢°ë„ ê²€ì¦ (60%)
- ì¼ì¼ ê±°ë˜ ì œí•œ (10ê±´)
- í¬íŠ¸í´ë¦¬ì˜¤ ë…¸ì¶œë„ ì œí•œ (90%)
- ë¦¬ìŠ¤í¬ ì¡°ì • (PERI, Buffett Index)

---

## âš ï¸ ì•Œë ¤ì§„ ì´ìŠˆ

### 1. ì‹œì¥ ë§ˆê° ì‹œê°„
**ì¦ìƒ**: ê°€ê²© ë°ì´í„°ê°€ 0ìœ¼ë¡œ ë°˜í™˜
**ì›ì¸**: ë¯¸êµ­ ì‹œì¥ ë§ˆê°
**í•´ê²°**: ì •ìƒ ë™ì‘ (ì‹œì¥ ê°œì¥ ì‹œê°„ì— ì¬í…ŒìŠ¤íŠ¸ í•„ìš”)

### 2. ë¹ˆ ê³„ì¢Œ ì˜¤ë¥˜
**ì¦ìƒ**: "INPUT_FIELD_NAME PDNO" ì˜¤ë¥˜
**ì›ì¸**: ê³„ì¢Œì— ë³´ìœ  ì¢…ëª©ì´ ì—†ì„ ë•Œ ë°œìƒ
**í•´ê²°**: ë¬´ì‹œ ê°€ëŠ¥ (í…ŒìŠ¤íŠ¸ í†µê³¼)

### 3. ëª¨ì˜íˆ¬ì API í‚¤
**í˜„ì¬ ìƒíƒœ**: ì‹¤ì „íˆ¬ì í‚¤ ì‚¬ìš© ì¤‘
**ê¶Œì¥**: ëª¨ì˜íˆ¬ì ì „ìš© í‚¤ ë°œê¸‰
**ë°œê¸‰ì²˜**: https://apiportal.koreainvestment.com/

---

## ğŸ“ ë‹¤ìŒ ë‹¨ê³„

### ìš°ì„ ìˆœìœ„ 1: ìë™ë§¤ë§¤ ìŠ¤ì¼€ì¤„ëŸ¬ (2-3ì¼)
```python
# backend/automation/auto_trading_scheduler.py
async def trading_cycle():
    # 30ë¶„ë§ˆë‹¤ ë‰´ìŠ¤ ëª¨ë‹ˆí„°ë§
    signals = await monitor_news()

    for signal in signals:
        # KIS ìë™ ê±°ë˜
        await kis_auto_trade(signal)
```

### ìš°ì„ ìˆœìœ„ 2: ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ (1ì£¼ì¼)
- Telegram ì•Œë¦¼ ì—°ë™
- Grafana ëŒ€ì‹œë³´ë“œ êµ¬ì„±
- Kill Switch êµ¬í˜„
- ì†ì ˆ/ìµì ˆ ìë™í™”

### ìš°ì„ ìˆœìœ„ 3: ë°±í…ŒìŠ¤íŒ… ì‹œìŠ¤í…œ
- ê³¼ê±° ë°ì´í„°ë¡œ ì „ëµ ê²€ì¦
- ì„±ê³¼ ë¶„ì„ ë¦¬í¬íŠ¸
- ìµœì  íŒŒë¼ë¯¸í„° íƒìƒ‰

### ìš°ì„ ìˆœìœ„ 4: ì‹¤ì „ ì „í™˜
- 1ì£¼ì¼ ëª¨ì˜íˆ¬ì ìš´ì˜
- ì„±ê³¼ ê²€ì¦
- Constitution Rules ì¡°ì •
- ì‹¤ì „íˆ¬ì ì „í™˜ (ì‹ ì¤‘í•˜ê²Œ!)

---

## ğŸ“ ì°¸ê³  ìë£Œ

### ë¬¸ì„œ
- [251210_KIS_SETUP_COMPLETE.md](251210_KIS_SETUP_COMPLETE.md) - ì„¤ì • ê°€ì´ë“œ
- [251210_KIS_PHASE_INTEGRATION_GUIDE.md](251210_KIS_PHASE_INTEGRATION_GUIDE.md) - í†µí•© ê°€ì´ë“œ
- [251210_FINAL_SYSTEM_REPORT.md](251210_FINAL_SYSTEM_REPORT.md) - ì „ì²´ ì‹œìŠ¤í…œ ë³´ê³ ì„œ

### ì™¸ë¶€ ë§í¬
- [í•œêµ­íˆ¬ìì¦ê¶Œ API í¬í„¸](https://apiportal.koreainvestment.com/)
- [KIS Open API GitHub](https://github.com/koreainvestment/open-trading-api)

### í…ŒìŠ¤íŠ¸ íŒŒì¼
- `test_kis_simple.py` - ê¸°ë³¸ í…ŒìŠ¤íŠ¸
- `test_kis_advanced.py` - ì‹¬í™” í…ŒìŠ¤íŠ¸
- `test_kis_integration.py` - í†µí•© í…ŒìŠ¤íŠ¸
- `test_kis_api.py` - API í…ŒìŠ¤íŠ¸

---

## âœ… ìµœì¢… ì²´í¬ë¦¬ìŠ¤íŠ¸

### ì½”ì–´ ì‹œìŠ¤í…œ
- [x] kis_client.py êµ¬í˜„ (êµ­ë‚´+í•´ì™¸)
- [x] kis_broker.py êµ¬í˜„
- [x] ì¸ì¦ ì‹œìŠ¤í…œ
- [x] í† í° ìºì‹±
- [x] ì˜¤ë¥˜ ì²˜ë¦¬

### API í†µí•©
- [x] FastAPI ë¼ìš°í„°
- [x] Health Check
- [x] Auto Trade
- [x] Balance Query
- [x] Price Query
- [x] Manual Order

### í…ŒìŠ¤íŠ¸
- [x] ê¸°ë³¸ í…ŒìŠ¤íŠ¸
- [x] ì‹¬í™” í…ŒìŠ¤íŠ¸
- [x] í†µí•© í…ŒìŠ¤íŠ¸
- [x] API í…ŒìŠ¤íŠ¸

### ë¬¸ì„œí™”
- [x] ì„¤ì • ê°€ì´ë“œ
- [x] í†µí•© ê°€ì´ë“œ
- [x] ì™„ë£Œ ë³´ê³ ì„œ
- [x] API ë¬¸ì„œ

### ë‹¤ìŒ ë‹¨ê³„
- [ ] ëª¨ì˜íˆ¬ì API í‚¤ ë°œê¸‰
- [ ] ì‹œì¥ ê°œì¥ ì‹œê°„ í…ŒìŠ¤íŠ¸
- [ ] ìë™ë§¤ë§¤ ìŠ¤ì¼€ì¤„ëŸ¬
- [ ] Telegram ì•Œë¦¼
- [ ] ì‹¤ì „ ì „í™˜

---

## ğŸ‰ ê²°ë¡ 

**ì „ì²´ ì‹œìŠ¤í…œì´ ì„±ê³µì ìœ¼ë¡œ í†µí•©ë˜ì—ˆìŠµë‹ˆë‹¤!**

- âœ… Phase A/B/C/D íŒŒì´í”„ë¼ì¸ ì™„ì„±
- âœ… KIS API ì™„ì „ í†µí•©
- âœ… ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼
- âœ… FastAPI ì—”ë“œí¬ì¸íŠ¸ ì¤€ë¹„
- âœ… ì‹¤ì „ ê±°ë˜ ì¤€ë¹„ ì™„ë£Œ

ì‹œìŠ¤í…œì€ ì´ì œ í•œêµ­íˆ¬ìì¦ê¶Œì„ í†µí•´ **ì‹¤ì œ ë¯¸êµ­ ì£¼ì‹ ìë™ë§¤ë§¤**ë¥¼ ìˆ˜í–‰í•  ì¤€ë¹„ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.

ì•ˆì „í•œ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ **ëª¨ì˜íˆ¬ì ëª¨ë“œ**ë¡œ ì¶©ë¶„íˆ ê²€ì¦í•œ í›„, ì‹¤ì „ ì „í™˜ì„ ê¶Œì¥ë“œë¦½ë‹ˆë‹¤.

---

**ì‘ì„±ì**: AI Trading System Team
**ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-12-03 17:45 KST
**ë²„ì „**: v1.0.0 - Production Ready ğŸš€
