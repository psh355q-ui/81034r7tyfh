# TASKS: AI Trading System Enhancement - War Room ê°•í™”

**í”„ë¡œì íŠ¸ëª…**: AI Trading System Meta-Controller V2 + Risk Management Enhancement  
**ì‘ì„±ì¼**: 2026-01-27  
**ë²„ì „**: v3.0 Final  
**ëª©í‘œ**: "ì‹¤ì œ ê³ ê° ìê¸ˆì„ ìš´ìš© ê°€ëŠ¥í•œ ì‹œìŠ¤í…œ" êµ¬ì¶•

---

## MVP ìº¡ìŠ

1. **ëª©í‘œ**: War Room ì—ì´ì „íŠ¸ë¥¼ 3ì¶• ë¦¬ìŠ¤í¬ ê°ì§€ ì‹œìŠ¤í…œìœ¼ë¡œ ê°•í™”
2. **í˜ë¥´ì†Œë‚˜**: ê¸°ê´€ íˆ¬ììê¸‰ ë¦¬ìŠ¤í¬ ê´€ë¦¬ê°€ í•„ìš”í•œ íŠ¸ë ˆì´ë”/íˆ¬ìì
3. **í•µì‹¬ ê°€ì¹˜**: VIX + Correlation + Drawdown 3ì¶• ë¦¬ìŠ¤í¬ ê°ì§€ë¡œ "ì‹¤ì œ ê³ ê° ìê¸ˆ" ìš´ìš© ê°€ëŠ¥
4. **ì„±ê³µ ì§€í‘œ**: 
   - Correlation Crisis ê°ì§€ ì„±ê³µ (í‰ê·  ìƒê´€ê´€ê³„ 0.85+ íƒì§€)
   - Drawdown Recovery ìë™ ì „í™˜ (20% ì†ì‹¤ ì‹œ Dividend ëª¨ë“œ ê°•ë“±)
   - Liquidity ê±°ë¶€ìœ¨ < 1% (ìœ íš¨í•œ ì£¼ë¬¸ë§Œ í†µê³¼)
5. **ì œì•½ ì¡°ê±´**: 
   - Phase 1+ ì‘ì—…ì€ ë°˜ë“œì‹œ Git Worktree ì‚¬ìš©
   - ëª¨ë“  Phase 1+ íƒœìŠ¤í¬ëŠ” TDD (REDâ†’GREENâ†’REFACTOR) ì ìš©
   - í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ 80% ì´ìƒ ìœ ì§€
6. **ê¸°ìˆ  ìŠ¤íƒ**: Python, FastAPI, pytest, yfinance, numpy, pandas
7. **ì¶œì‹œ ì „ëµ**: Phaseë³„ ì ì§„ì  ë°°í¬ (Phase 0 â†’ 0-B â†’ 1 â†’ 2)
8. **ë¦¬ìŠ¤í¬**: 
   - Correlation ê³„ì‚° ì‹œ ë°ì´í„° ë¶€ì¡± (ì¢…ëª© 2ê°œ ë¯¸ë§Œ)
   - yfinance API ì œí•œ (rate limit)
   - False positive (ì •ìƒ ì‹œì¥ì¸ë° Crisis íŒë‹¨)
9. **ì˜ì¡´ì„±**: 
   - ê¸°ì¡´ War Room MVP
   - Constitution ì‹œìŠ¤í…œ
   - Portfolio State ê´€ë¦¬
10. **ë‹¤ìŒ ë‹¨ê³„**: Phase 0 Meta-Controller V2 êµ¬í˜„ â†’ ë°±í…ŒìŠ¤íŠ¸ ê²€ì¦ (2020 COVID)

---

## ë§ˆì¼ìŠ¤í†¤ ê°œìš”

| ë§ˆì¼ìŠ¤í†¤ | ì„¤ëª… | ì£¼ìš” ê¸°ëŠ¥ | ê¸°ê°„ |
|----------|------|-----------|------|
| M0 | Meta-Controller V2 ê¸°ë°˜ | Correlation + Drawdown + Liquidity | Week 1-2 |
| M1 | Exit Rules + Thesis Keeper | AI ê°œì… ì—†ëŠ” ì²­ì‚° ê·œì¹™ | Week 3-4 |
| M2 | Data Enhancement | Fundamental + Macro + Dividend | Week 5-6 |
| M3 | News RAG | Fact/Opinion ë¶„ë¦¬, ê²€ìƒ‰ í†µí•© | Week 7-8 |

---

## M0: Meta-Controller V2 ê¸°ë°˜ (Week 1-2)

### [x] Phase 0, T0.1: Correlation Shock Detector êµ¬í˜„

**ë‹´ë‹¹**: backend-specialist

**ì„¤ëª…**: í¬íŠ¸í´ë¦¬ì˜¤ ë‚´ë¶€ ìƒê´€ê´€ê³„ ê¸‰ë“± ê°ì§€ ì‹œìŠ¤í…œ êµ¬í˜„. VIXê°€ ë‚®ì•„ë„ ë‚´ í¬íŠ¸í´ë¦¬ì˜¤ ì•ˆì—ì„œ ë¶„ì‚° íš¨ê³¼ê°€ ì†Œë©¸í•˜ëŠ” ìˆœê°„ì„ íƒì§€.

**ì‘ì—… ìœ„ì¹˜**: main ë¸Œëœì¹˜ (Phase 0)

**ì‚°ì¶œë¬¼**:
- `backend/ai/correlation_shock_detector.py`
- `tests/test_correlation_shock_detector.py` (Phase 0ì´ì§€ë§Œ í…ŒìŠ¤íŠ¸ ì‘ì„± ê¶Œì¥)

**êµ¬í˜„ ìƒì„¸**:
```python
class CorrelationShockDetector:
    def detect_correlation_regime(portfolio: Dict) -> Tuple[str, float]:
        # ìµœê·¼ 20ì¼ ìˆ˜ìµë¥  ê³„ì‚°
        # ìƒê´€ê´€ê³„ í–‰ë ¬ ìƒì„±
        # í‰ê·  ìƒê´€ê´€ê³„ ê³„ì‚°
        # íŒë‹¨: avg_corr > 0.85 â†’ "crisis_correlation"
        #      avg_corr > 0.70 â†’ "elevated_correlation"
        #      else â†’ "normal"
```

**ì¸ìˆ˜ ì¡°ê±´**:
- [x] ìƒê´€ê´€ê³„ 0.85+ íƒì§€ ì‹œ "crisis_correlation" ë°˜í™˜
- [x] ì¢…ëª© 1ê°œ í¬íŠ¸í´ë¦¬ì˜¤ëŠ” "single_position" ë°˜í™˜
- [x] í…ŒìŠ¤íŠ¸: ë°˜ë„ì²´ 4ì¢…ëª© (NVDA, AMD, TSM, AVGO) â†’ crisis ê°ì§€

---

### [x] Phase 0, T0.2: Drawdown Recovery Mode êµ¬í˜„

**ë‹´ë‹¹**: backend-specialist

**ì„¤ëª…**: í¬íŠ¸í´ë¦¬ì˜¤ ì†ì‹¤ ê¸°ë°˜ ìë™ ë°©ì–´ ëª¨ë“œ ì „í™˜. 20% ì†ì‹¤ì— Dividend ëª¨ë“œ ê°•ì œ ì „í™˜, 10% ì†ì‹¤ì— í¬ì§€ì…˜ 50% ì¶•ì†Œ.

**ì‘ì—… ìœ„ì¹˜**: main ë¸Œëœì¹˜ (Phase 0)

**ì‚°ì¶œë¬¼**:
- `backend/ai/drawdown_recovery.py`
- `tests/test_drawdown_recovery.py`

**êµ¬í˜„ ìƒì„¸**:
```python
class DrawdownRecoveryMode:
    def check_drawdown(current_value: float, peak_value: float) -> Dict:
        drawdown = (peak_value - current_value) / peak_value
        
        if drawdown >= 0.20:
            return {'severity': 'critical', 'forced_mode': 'dividend', 
                    'position_limit_multiplier': 0.3}
        elif drawdown >= 0.10:
            return {'severity': 'warning', 'position_limit_multiplier': 0.5}
```

**ì¸ìˆ˜ ì¡°ê±´**:
- [x] 20% ì†ì‹¤ â†’ severity='critical', forced_mode='dividend'
- [x] 10% ì†ì‹¤ â†’ severity='warning', multiplier=0.5
- [x] 5% ì†ì‹¤ â†’ severity='normal', multiplier=1.0

---

### [x] Phase 0, T0.3: Meta-Controller V2 í†µí•©

**ë‹´ë‹¹**: backend-specialist

**ì„¤ëª…**: 3ì¶• ë¦¬ìŠ¤í¬ ê°ì§€ ì‹œìŠ¤í…œ í†µí•©. VIX + Correlation + Drawdown ì¤‘ ê°€ì¥ ë³´ìˆ˜ì ì¸ íŒë‹¨ ì±„íƒ. ìš°ì„ ìˆœìœ„: Drawdown > Correlation > VIX.

**ì‘ì—… ìœ„ì¹˜**: main ë¸Œëœì¹˜ (Phase 0)

**ì˜ì¡´ì„±**: T0.1 (Correlation Detector), T0.2 (Drawdown Recovery) ì™„ë£Œ í•„ìš”

**ì‚°ì¶œë¬¼**:
- `backend/ai/meta_controller_v2.py`
- `tests/test_meta_controller_v2.py`

**êµ¬í˜„ ìƒì„¸**:
```python
class MetaControllerV2:
    def __init__(self):
        self.correlation_detector = CorrelationShockDetector()
        self.drawdown_monitor = DrawdownRecoveryMode()
    
    def evaluate_market_regime(market_data, portfolio_data) -> Dict:
        # 1. VIX ê¸°ë°˜ íŒë‹¨
        # 2. Correlation ê¸°ë°˜ íŒë‹¨
        # 3. Drawdown ê¸°ë°˜ íŒë‹¨
        # 4. ê°€ì¥ ë³´ìˆ˜ì ì¸ íŒë‹¨ ì±„íƒ (_combine_regimes)
```

**ê²€ì¦ ì‹œë‚˜ë¦¬ì˜¤**:
1. **Scenario 1**: VIX 15 (ì •ìƒ) + Drawdown 20% â†’ forced_mode='dividend'
2. **Scenario 2**: VIX 38 (ìœ„ê¸°) + Correlation 0.92 â†’ forced_mode='dividend' (ë‘˜ ë‹¤ crisisì§€ë§Œ Drawdownì´ ìš°ì„ )
3. **Scenario 3**: ëª¨ë‘ ì •ìƒ â†’ final_regime='risk_on', multiplier=1.0

**ì¸ìˆ˜ ì¡°ê±´**:
- [x] 3ì¶• íŒë‹¨ ë¡œì§ êµ¬í˜„ ì™„ë£Œ
- [x] ìš°ì„ ìˆœìœ„ ì •í™• (Drawdown > Correlation > VIX)
- [x] 3ê°œ ì‹œë‚˜ë¦¬ì˜¤ ëª¨ë‘ í…ŒìŠ¤íŠ¸ í†µê³¼

---

### [x] Phase 0, T0.4: Liquidity Guardian êµ¬í˜„

**ë‹´ë‹¹**: backend-specialist

**ì„¤ëª…**: ì£¼ë¬¸ ì§ì „ ìœ ë™ì„± ì²´í¬. ì£¼ë¬¸ëŸ‰ì´ ì¼í‰ê·  ê±°ë˜ëŸ‰ì˜ 5% ì´ˆê³¼ ì‹œ ê±°ë¶€, Bid-Ask Spread 2% ì´ˆê³¼ ì‹œ ê²½ê³ .

**ì‘ì—… ìœ„ì¹˜**: main ë¸Œëœì¹˜ (Phase 0)

**ì‚°ì¶œë¬¼**:
- `backend/ai/liquidity_guardian.py`
- `tests/test_liquidity_guardian.py`

**êµ¬í˜„ ìƒì„¸**:
```python
class LiquidityGuardian:
    def check_liquidity(symbol: str, order_shares: int, order_value: float) -> Dict:
        # 1. í‰ê·  ê±°ë˜ëŸ‰ ì¡°íšŒ (yfinance, 20ì¼)
        # 2. volume_impact = order_shares / avg_volume
        # 3. if volume_impact > 0.05: return {'allow': False}
        # 4. Bid-Ask Spread ì²´í¬
        # 5. if spread > 0.02: return {'allow': True, 'warning': ...}
```

**Mock ìš”êµ¬ì‚¬í•­**:
- yfinance API í˜¸ì¶œ Mock ì²˜ë¦¬ (rate limit ë°©ì§€)
- í…ŒìŠ¤íŠ¸ìš© ê³ ì • ë°ì´í„° ì‚¬ìš©

**ê²€ì¦ ì‹œë‚˜ë¦¬ì˜¤**:
1. **ëŒ€í˜•ì£¼ ì†ŒëŸ‰ ì£¼ë¬¸**: AAPL 100ì£¼ â†’ allow=True
2. **ì†Œí˜•ì£¼ ëŒ€ëŸ‰ ì£¼ë¬¸**: SMCI 10,000ì£¼ (ì¼í‰ê·  6%) â†’ allow=False
3. **ë†’ì€ ìŠ¤í”„ë ˆë“œ**: COIN, spread 2.5% â†’ allow=True, warning ë©”ì‹œì§€

**ì¸ìˆ˜ ì¡°ê±´**:
- [x] ê±°ë˜ëŸ‰ 5% ì´ˆê³¼ â†’ ê±°ë¶€
- [x] Spread 2% ì´ˆê³¼ â†’ ê²½ê³ 
- [x] Mock í…ŒìŠ¤íŠ¸ í†µê³¼

---

### [x] Phase 0, T0.5: War Room MVP í†µí•©

**ë‹´ë‹¹**: backend-specialist

**ì„¤ëª…**: Meta-Controller V2ë¥¼ ê¸°ì¡´ War Room MVPì— í†µí•©. ì‹¬ì˜ ì‹œì‘ ì „ ì‹œì¥ êµ­ë©´ íŒë‹¨ ìˆ˜í–‰.

**ì‘ì—… ìœ„ì¹˜**: main ë¸Œëœì¹˜ (Phase 0)

**ì˜ì¡´ì„±**: T0.3 (Meta-Controller V2) ì™„ë£Œ í•„ìš”

**ìˆ˜ì • íŒŒì¼**:
- `backend/ai/mvp/war_room_mvp.py`

**êµ¬í˜„ ìƒì„¸**:
```python
class WarRoomMVP:
    def __init__(self):
        # ...
        self.meta_controller = MetaControllerV2()  # ğŸ†•
    
    async def deliberate(...):
        # ğŸ†• Meta-Controller ì²´í¬
        market_regime_result = self.meta_controller.evaluate_market_regime(
            market_data={'vix': vix, ...},
            portfolio_data={'current_value': ..., 'peak_value': ..., ...}
        )
        
        # ëª¨ë“œ ê°•ë“± ì²˜ë¦¬
        if market_regime_result.get('forced_mode'):
            logger.warning(f"âš ï¸ Mode Override: {market_regime_result['reason']}")
            persona_mode = market_regime_result['forced_mode']
        
        # ê¸°ì¡´ Agent ì‹¬ì˜ ì§„í–‰...
```

**ì¸ìˆ˜ ì¡°ê±´**:
- [x] Meta-Controller ê²°ê³¼ë¥¼ War Room ë¡œê·¸ì— ê¸°ë¡
- [x] forced_mode ë°œìƒ ì‹œ persona_mode ìë™ ë³€ê²½
- [x] position_limit_multiplierë¥¼ í—Œë²• ê²€ì¦ì— ì „ë‹¬

---

### [x] Phase 0, T0.6: í†µí•© í…ŒìŠ¤íŠ¸ ë° ë°±í…ŒìŠ¤íŠ¸

**ë‹´ë‹¹**: backend-specialist

**ì„¤ëª…**: 2020 COVID Crash ì‹œë®¬ë ˆì´ì…˜. 3ì›” 9ì¼~23ì¼ êµ¬ê°„ì—ì„œ Correlation Crisis + VIX ê¸‰ë“± ê°ì§€ ì—¬ë¶€ ê²€ì¦.

**ì‘ì—… ìœ„ì¹˜**: main ë¸Œëœì¹˜ (Phase 0)

**ì˜ì¡´ì„±**: M0 ì „ì²´ ì™„ë£Œ

**ì‚°ì¶œë¬¼**:
- `tests/integration/test_meta_controller_backtest.py`
- `docs/validation/meta_controller_v2_backtest_report.md` (ê²°ê³¼ ë¬¸ì„œ)

**ê²€ì¦ ëŒ€ìƒ**:
1. 2020ë…„ 3ì›” 9ì¼~23ì¼ ë°˜ë„ì²´ í¬íŠ¸í´ë¦¬ì˜¤ (NVDA, AMD, INTC, TSM)
2. Correlation ì¶”ì´: ì •ìƒ(0.4) â†’ ìœ„ê¸°(0.95) ê°ì§€ ì—¬ë¶€
3. Drawdown ì¶”ì´: 0% â†’ 25% â†’ ëª¨ë“œ ê°•ë“± ë°œìƒ ì—¬ë¶€
4. VIX ì¶”ì´: 15 â†’ 82.69 (ìµœê³ ì ) â†’ Crisis ê°ì§€

**ì¸ìˆ˜ ì¡°ê±´**:
- [ ] Correlation Crisis ê°ì§€ (3ì›” 16ì¼ ì´í›„)
- [ ] Drawdown 20% ë„ë‹¬ ì‹œì ì— Dividend ëª¨ë“œ ê°•ë“±
- [ ] ë°±í…ŒìŠ¤íŠ¸ ë³´ê³ ì„œ ì‘ì„± ì™„ë£Œ

---

## M1: Exit Rules + Thesis Keeper (Week 3-4)

### [] Phase 1, T1.1: Exit Rules Engine - Dividend Mode REDâ†’GREEN

**ë‹´ë‹¹**: backend-specialist

**Git Worktree ì„¤ì •**:
```bash
git worktree add ../ai-trading-phase1-exit-rules -b phase/1-exit-rules
cd ../ai-trading-phase1-exit-rules
```

**TDD ì‚¬ì´í´**:

1. **RED**: `tests/test_exit_rules_dividend.py` ì‘ì„± (ì‹¤íŒ¨ í™•ì¸)
   - `test_dividend_cut_detection()` - ë°°ë‹¹ ì‚­ê° ê³µì‹œ â†’ ì¦‰ì‹œ ë§¤ë„
   - `test_payout_ratio_risk()` - Payout Ratio 80% ì´ˆê³¼ â†’ ë§¤ë„
   - `test_dividend_yield_trap()` - Yieldê°€ ì„¹í„° í‰ê·  1.5ë°° ì´ˆê³¼ â†’ ê²½ê³ 

2. **GREEN**: `backend/ai/exit_rules.py` ìµœì†Œ êµ¬í˜„
   ```python
   class ExitRuleEngine:
       def check_dividend_exit(position, news) -> Tuple[bool, str]:
           # ë°°ë‹¹ ì‚­ê° í‚¤ì›Œë“œ ë§¤ì¹­
           # Payout Ratio ì²´í¬
           return (should_exit, reason)
   ```

3. **REFACTOR**: ì½”ë“œ ì •ë¦¬
   - í‚¤ì›Œë“œ ë§¤ì¹­ ë¡œì§ ë¶„ë¦¬
   - ë‰´ìŠ¤ íŒŒì‹± ìœ í‹¸ í•¨ìˆ˜í™”

**ì‚°ì¶œë¬¼**:
- `backend/ai/exit_rules.py`
- `tests/test_exit_rules_dividend.py`

**ì¸ìˆ˜ ì¡°ê±´**:
- [x] 2020ë…„ 3ì›” 9ì¼~23ì¼ ì‹œë®¬ë ˆì´ì…˜ ì™„ë£Œ
- [x] Correlation ì¶”ì´ ê²€ì¦: 0.4 â†’ 0.95 (crisis ê°ì§€)
- [x] Drawdown ì¶”ì´ ê²€ì¦: 0% â†’ 25% (dividend ëª¨ë“œ ê°•ì œ ì „í™˜)
- [x] VIX ì¶”ì´ ê²€ì¦: 54.5 â†’ 82.69 (crisis ê°ì§€)
- [x] ìš°ì„ ìˆœìœ„ ê²€ì¦: Drawdown > Correlation > VIX ì •í™• ì‘ë™
- [x] ë°±í…ŒìŠ¤íŠ¸ ë¦¬í¬íŠ¸ ìƒì„±: `docs/validation/meta_controller_v2_backtest_report.md`

---

### [] Phase 1, T1.2: Exit Rules - Long-Term + Trading Modes REDâ†’GREEN

**ë‹´ë‹¹**: backend-specialist

**Git Worktree ì„¤ì •**: ë™ì¼ (`../ai-trading-phase1-exit-rules`)

**TDD ì‚¬ì´í´**:

1. **RED**: `tests/test_exit_rules_longterm.py`, `tests/test_exit_rules_trading.py` ì‘ì„±
   - Long-Term: Thesis Violation íŒë‹¨
   - Trading: ì†ì ˆê°€(-3%), ëª©í‘œê°€(+7%), MACD ë°ë“œ í¬ë¡œìŠ¤

2. **GREEN**: `ExitRuleEngine` í™•ì¥
   ```python
   def check_longterm_exit(position, thesis, current_analysis):
       # LLMìœ¼ë¡œ Thesis Violation íŒë‹¨
   
   def check_trading_exit(position, price_data):
       # ì†ì ˆ/ìµì ˆ ë¡œì§
       # MACD ì²´í¬
   ```

3. **REFACTOR**: ëª¨ë“œë³„ ì²­ì‚° ë¡œì§ ì¶”ìƒí™”

**ì‚°ì¶œë¬¼**:
- `backend/ai/exit_rules.py` (í™•ì¥)
- `tests/test_exit_rules_longterm.py`
- `tests/test_exit_rules_trading.py`

**ì¸ìˆ˜ ì¡°ê±´**:
- [ ] 4ê°€ì§€ ëª¨ë“œ ëª¨ë‘ í…ŒìŠ¤íŠ¸ í†µê³¼
- [ ] Long-Term Thesis Violation LLM ë¡œì§ ê²€ì¦
- [ ] Trading ì†ì ˆ/ìµì ˆ ì •í™•ì„± 95% ì´ìƒ

---

### [] Phase 1, T1.3: Thesis Keeper DB ìŠ¤í‚¤ë§ˆ + Service REDâ†’GREEN

**ë‹´ë‹¹**: backend-specialist

**Git Worktree ì„¤ì •**:
```bash
git worktree add ../ai-trading-phase1-thesis -b phase/1-thesis
cd ../ai-trading-phase1-thesis
```

**TDD ì‚¬ì´í´**:

1. **RED**: `tests/test_thesis_keeper.py` ì‘ì„±
   - `test_save_thesis()` - íˆ¬ì ë…¼ë¦¬ ì €ì¥
   - `test_get_active_thesis()` - í™œì„± í¬ì§€ì…˜ Thesis ì¡°íšŒ
   - `test_mark_violated()` - Thesis ìœ„ë°˜ í‘œì‹œ

2. **GREEN**: DB ë§ˆì´ê·¸ë ˆì´ì…˜ + Service êµ¬í˜„
   ```sql
   -- migrations/create_portfolio_thesis.sql
   CREATE TABLE portfolio_thesis (
       id SERIAL PRIMARY KEY,
       ticker VARCHAR(10),
       thesis_text TEXT,
       moat_type VARCHAR(50),
       moat_strength DECIMAL(3,2),
       status VARCHAR(20) DEFAULT 'active'
   );
   ```
   
   ```python
   # backend/services/thesis_keeper.py
   class ThesisKeeper:
       def save_thesis(ticker, thesis_text, moat_type, ...):
       def get_thesis(ticker):
       def mark_violated(ticker, reason):
   ```

3. **REFACTOR**: DB ì¸ë±ìŠ¤ ìµœì í™”, ì¡°íšŒ ì¿¼ë¦¬ ê°œì„ 

**ì‚°ì¶œë¬¼**:
- `backend/database/migrations/create_portfolio_thesis.sql`
- `backend/services/thesis_keeper.py`
- `tests/test_thesis_keeper.py`

**ì¸ìˆ˜ ì¡°ê±´**:
- [ ] PostgreSQL ë§ˆì´ê·¸ë ˆì´ì…˜ ì„±ê³µ
- [ ] CRUD í…ŒìŠ¤íŠ¸ í†µê³¼
- [ ] ë™ì‹œì„± í…ŒìŠ¤íŠ¸ (2ê°œ Thesis ë™ì‹œ ì €ì¥)

---

### [] Phase 1, T1.4: Position Aging Tracker + Thesis í†µí•© REDâ†’GREEN

**ë‹´ë‹¹**: backend-specialist

**Git Worktree ì„¤ì •**: ë™ì¼ (`../ai-trading-phase1-thesis`)

**TDD ì‚¬ì´í´**:

1. **RED**: `tests/test_position_aging.py` ì‘ì„±
   - `test_dividend_180_days()` - 180ì¼ì´ˆê³¼ â†’ review_needed
   - `test_longterm_90_days()` - 90ì¼ ì´ˆê³¼ â†’ forced_review
   - `test_trading_7_days()` - 7ì¼ ì´ˆê³¼ â†’ stale

2. **GREEN**: `backend/ai/position_aging.py` êµ¬í˜„
   ```python
   class PositionAgingTracker:
       AGING_RULES = {
           "dividend": {"review_days": 180, "stale_days": 365},
           # ...
       }
       def check_position_age(position, mode):
           # ë³´ìœ  ì¼ìˆ˜ ê³„ì‚°
           # AGING_RULES ì°¸ì¡°í•˜ì—¬ íŒë‹¨
   ```

3. **REFACTOR**: Thesis Keeperì™€ ì—°ë™í•˜ì—¬ review íŠ¸ë¦¬ê±° ì‹œ Thesis ì¬ê²€í†  ìë™ ìˆ˜í–‰

**ì‚°ì¶œë¬¼**:
- `backend/ai/position_aging.py`
- `tests/test_position_aging.py`
- Thesis Keeper ì—°ë™ ë¡œì§

**ì¸ìˆ˜ ì¡°ê±´**:
- [ ] 4ê°€ì§€ ëª¨ë“œ aging ê·œì¹™ ì •í™•
- [ ] Thesis ì¬ê²€í†  íŠ¸ë¦¬ê±° ë™ì‘ í™•ì¸
- [ ] í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ 85% ì´ìƒ

---

## M2: Data Enhancement (Week 5-6)

### [] Phase 2, T2.1: Fundamental Data Service REDâ†’GREEN

**ë‹´ë‹¹**: backend-specialist

**Git Worktree ì„¤ì •**:
```bash
git worktree add ../ai-trading-phase2-data -b phase/2-data
cd ../ai-trading-phase2-data
```

**TDD ì‚¬ì´í´**:

1. **RED**: `tests/test_fundamental_service.py` ì‘ì„±
   - `test_get_valuation_metrics()` - PER, PBR, PEG ì¡°íšŒ
   - `test_get_profitability()` - ROE, ROA, Margin ì¡°íšŒ
   - `test_cache_ttl()` - Redis ìºì‹± 24ì‹œê°„ TTL ê²€ì¦

2. **GREEN**: `backend/services/fundamental_service.py` êµ¬í˜„
   ```python
   class FundamentalDataService:
       def get_fundamental_data(ticker) -> Dict:
           # yfinance.Ticker(ticker).info ì¡°íšŒ
           # Redis ìºì‹± (24h TTL)
           return {
               "valuation": {"pe_ratio": ..., "pb_ratio": ...},
               "profitability": {"roe": ..., "roa": ...},
               "financial_health": {"debt_to_equity": ...}
           }
   ```

3. **REFACTOR**: yfinance API í˜¸ì¶œ ì¬ì‹œë„ ë¡œì§ ì¶”ê°€, ì˜ˆì™¸ ì²˜ë¦¬ ê°•í™”

**ì‚°ì¶œë¬¼**:
- `backend/services/fundamental_service.py`
- `tests/test_fundamental_service.py`

**Mock ìš”êµ¬ì‚¬í•­**:
- yfinance API Mock (unittest.mock ì‚¬ìš©)
- Redis Mock

**ì¸ìˆ˜ ì¡°ê±´**:
- [ ] yfinance ë°ì´í„° ì •í™•ì„± ê²€ì¦ (AAPL ìƒ˜í”Œ)
- [ ] ìºì‹± ë™ì‘ í™•ì¸
- [ ] API ì‹¤íŒ¨ ì‹œ graceful degradation

---

### [] Phase 2, T2.2: Dividend Data Collector REDâ†’GREEN

**ë‹´ë‹¹**: backend-specialist

**Git Worktree ì„¤ì •**: ë™ì¼ (`../ai-trading-phase2-data`)

**TDD ì‚¬ì´í´**:

1. **RED**: `tests/test_dividend_collector.py` ì‘ì„±
   - `test_dividend_yield()` - ë°°ë‹¹ë¥  ê³„ì‚°
   - `test_payout_ratio()` - Payout Ratio ê³„ì‚°
   - `test_dividend_growth_rate()` - 5ë…„ ë°°ë‹¹ ì„±ì¥ë¥ 

2. **GREEN**: `backend/services/dividend_collector.py` êµ¬í˜„
   ```python
   class DividendCollector:
       def get_dividend_data(ticker) -> Dict:
           # yfinance dividends ì¡°íšŒ
           # Payout Ratio = ë°°ë‹¹ê¸ˆ / EPS
           # 5ë…„ CAGR ê³„ì‚°
           return {
               "dividend_yield": 0.042,
               "dividend_payout_ratio": 0.55,
               "dividend_growth_rate_5y": 0.08,
               "is_dividend_aristocrat": True
           }
   ```

3. **REFACTOR**: FundamentalDataServiceì™€ í†µí•©

**ì‚°ì¶œë¬¼**:
- `backend/services/dividend_collector.py`
- `tests/test_dividend_collector.py`

**ê²€ì¦ ì‹œë‚˜ë¦¬ì˜¤**:
- JNJ (Dividend Aristocrat): dividend_aristocrat=True í™•ì¸
- AAPL: ë°°ë‹¹ ì„±ì¥ë¥  ì •í™•ì„± ê²€ì¦

**ì¸ìˆ˜ ì¡°ê±´**:
- [ ] Dividend Aristocrat íŒì • ì •í™•
- [ ] Payout Ratio ê³„ì‚° ì •í™•ì„± 95% ì´ìƒ
- [ ] Dividend ëª¨ë“œ Agentì— ë°ì´í„° ì£¼ì… ì„±ê³µ

---

### [] Phase 2, T2.3: Earnings Blackout Zone (ì¡°ê±´ë¶€) REDâ†’GREEN

**ë‹´ë‹¹**: backend-specialist

**Git Worktree ì„¤ì •**: ë™ì¼ (`../ai-trading-phase2-data`)

**TDD ì‚¬ì´í´**:

1. **RED**: `tests/test_earnings_blackout.py` ì‘ì„±
   - `test_trading_mode_blackout()` - TRADING ëª¨ë“œ, D-3 â†’ blackout=True
   - `test_dividend_mode_warning()` - DIVIDEND ëª¨ë“œ, D-2 â†’ warning_only=True
   - `test_no_earnings_data()` - ì‹¤ì ì¼ ì •ë³´ ì—†ìŒ â†’ blackout=False

2. **GREEN**: `backend/ai/earnings_blackout.py` êµ¬í˜„
   ```python
   class EarningsBlackout:
       BLACKOUT_RULES = {
           "trading": { "enabled": True, "d_before": 3, "d_after": 1},
           "dividend": {"enabled": False}
       }
       def check_earnings_proximity(symbol, persona_mode):
           # ì‹¤ì  ë°œí‘œì¼ ì¡°íšŒ (yfinance calendar)
           # ëª¨ë“œë³„ ê·œì¹™ ì ìš©
   ```

3. **REFACTOR**: ì‹¤ì ì¼ ìºì‹± ì¶”ê°€

**ì‚°ì¶œë¬¼**:
- `backend/ai/earnings_blackout.py`
- `tests/test_earnings_blackout.py`

**ì¸ìˆ˜ ì¡°ê±´**:
- [ ] TRADING/AGGRESSIVE ëª¨ë“œë§Œ ìë™ ì°¨ë‹¨
- [ ] D-3 ~ D+1 êµ¬ê°„ ì •í™•
- [ ] yfinance earnings_dates API í˜¸ì¶œ ì„±ê³µ

---

### [] Phase 2, T2.4: Analyst Agent ë°ì´í„° í†µí•©

**ë‹´ë‹¹**: backend-specialist

**Git Worktree ì„¤ì •**: ë™ì¼ (`../ai-trading-phase2-data`)

**ì„¤ëª…**: Fundamental, Dividend, Earnings ë°ì´í„°ë¥¼ Analyst Agent í”„ë¡¬í”„íŠ¸ì— ì£¼ì….

**ìˆ˜ì • íŒŒì¼**:
- `backend/ai/mvp/analyst_agent_mvp.py`

**êµ¬í˜„ ìƒì„¸**:
```python
class AnalystReasoningAgent:
    def _build_reasoning_prompt(...):
        # ğŸ†• Fundamental ë°ì´í„° ì£¼ì…
        fundamental = fundamental_service.get_fundamental_data(symbol)
        prompt_parts.append(f"""
## í€ë”ë©˜í„¸ ë¶„ì„:
- PER: {fundamental['valuation']['pe_ratio']}
- ROE: {fundamental['profitability']['roe']:.2%}
""")
        
        # ğŸ†• Dividend ë°ì´í„° ì£¼ì… (DIVIDEND ëª¨ë“œ)
        if persona_mode == 'dividend':
            dividend = dividend_collector.get_dividend_data(symbol)
            prompt_parts.append(f"""
## ë°°ë‹¹ ë¶„ì„:
- ë°°ë‹¹ë¥ : {dividend['dividend_yield']:.2%}
- Payout Ratio: {dividend['dividend_payout_ratio']:.1%}
""")
```

**ì¸ìˆ˜ ì¡°ê±´**:
- [ ] Fundamental ë°ì´í„°ê°€ í”„ë¡¬í”„íŠ¸ì— í¬í•¨
- [ ] DIVIDEND ëª¨ë“œì—ì„œ ë°°ë‹¹ ë°ì´í„° ì¶”ê°€ í™•ì¸
- [ ] Analyst ì¶”ë¡  ê²°ê³¼ì— "PER", "ROE" í‚¤ì›Œë“œ ì¶œí˜„

---

## M3: News RAG (Week 7-8)

### [] Phase 3, T3.1: News Fact/Opinion Tagging REDâ†’GREEN

**ë‹´ë‹¹**: backend-specialist

**Git Worktree ì„¤ì •**:
```bash
git worktree add ../ai-trading-phase3-news-rag -b phase/3-news-rag
cd ../ai-trading-phase3-news-rag
```

**TDD ì‚¬ì´í´**:

1. **RED**: `tests/test_news_tagging.py` ì‘ì„±
   - `test_fact_classification()` - "NVDA beats estimate" â†’ FACT
   - `test_opinion_classification()` - "Analyst predicts" â†’ OPINION
   - `test_speculation_classification()` - "May announce" â†’ SPECULATION

2. **GREEN**: `backend/data/processors/unified_news_processor.py` ìˆ˜ì •
   ```python
   class UnifiedNewsProcessor:
       def analyze_with_llm(article):
           # ollama í”„ë¡¬í”„íŠ¸ì— claim_type ì¶”ê°€
           prompt = f"""
ë¶„ë¥˜í•´ì£¼ì„¸ìš”:
1. Urgency: ...
2. Sentiment: ...
3. ğŸ†• Claim Type: FACT | OPINION | SPECULATION
"""
           result = llm.generate(prompt)
           return NewsAnalysis(..., claim_type=result['claim_type'])
   ```

3. **REFACTOR**: LLM í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ë¶„ë¦¬

**ì‚°ì¶œë¬¼**:
- `backend/data/processors/unified_news_processor.py` (ìˆ˜ì •)
- `tests/test_news_tagging.py`

**ì¸ìˆ˜ ì¡°ê±´**:
- [ ] Claim Type ë¶„ë¥˜ ì •í™•ë„ 90% ì´ìƒ
- [ ] ollama LLM ì‘ë‹µ íŒŒì‹± ì•ˆì •ì„± í™•ì¸
- [ ] DB ìŠ¤í‚¤ë§ˆì— `claim_type` ì»¬ëŸ¼ ì¶”ê°€ (ë§ˆì´ê·¸ë ˆì´ì…˜)

---

### [] Phase 3, T3.2: RAG Indexer (ìš”ì•½ ì„ë² ë”©) REDâ†’GREEN

**ë‹´ë‹¹**: backend-specialist

**Git Worktree ì„¤ì •**: ë™ì¼ (`../ai-trading-phase3-news-rag`)

**TDD ì‚¬ì´í´**:

1. **RED**: `tests/test_news_rag_indexer.py` ì‘ì„±
   - `test_summary_embedding()` - LLM ìš”ì•½ â†’ ì„ë² ë”© ìƒì„±
   - `test_chromadb_insert()` - ChromaDBì— ì €ì¥
   - `test_metadata_extraction()` - ticker, sector, claim_type ë©”íƒ€ë°ì´í„°

2. **GREEN**: `backend/services/news_rag_indexer.py` êµ¬í˜„
   ```python
   class NewsRAGIndexer:
       def index_new_articles():
           # PostgreSQLì—ì„œ last_indexed_id ì´í›„ ì¡°íšŒ
           # LLM ìš”ì•½ ìƒì„± (3-5ë¬¸ì¥)
           # sentence-transformers ì„ë² ë”©
           # ChromaDB ì €ì¥
   ```

3. **REFACTOR**: ë°°ì¹˜ ì„ë² ë”© ì²˜ë¦¬ (í•œ ë²ˆì— 10ê°œì”©)

**ì‚°ì¶œë¬¼**:
- `backend/services/news_rag_indexer.py`
- `tests/test_news_rag_indexer.py`
- ChromaDB ì´ˆê¸° ì„¤ì • ìŠ¤í¬ë¦½íŠ¸

**ì¸ìˆ˜ ì¡°ê±´**:
- [ ] ChromaDB ì €ì¥ ì„±ê³µ
- [ ] ì„ë² ë”© ì°¨ì›: 384 (paraphrase-multilingual-MiniLM-L12-v2)
- [ ] 100ê°œ ë‰´ìŠ¤ ì¸ë±ì‹± < 30ì´ˆ

---

### [] Phase 3, T3.3: News RAG Query Service REDâ†’GREEN

**ë‹´ë‹¹**: backend-specialist

**Git Worktree ì„¤ì •**: ë™ì¼ (`../ai-trading-phase3-news-rag`)

**TDD ì‚¬ì´í´**:

1. **RED**: `tests/test_news_rag_query.py` ì‘ì„±
   - `test_semantic_search()` - "NVDA GPU shortage" ê²€ìƒ‰ â†’ ê´€ë ¨ ë‰´ìŠ¤ ë°˜í™˜
   - `test_claim_type_filter()` - FACTë§Œ í•„í„°ë§
   - `test_time_filter()` - ìµœê·¼ 7ì¼ ë‰´ìŠ¤ë§Œ

2. **GREEN**: `backend/services/news_rag_query.py` êµ¬í˜„
   ```python
   class NewsRAGQuery:
       def search(query, ticker, days=7, top_k=5, claim_types=['FACT']):
           # query ì„ë² ë”© ìƒì„±
           # ChromaDB.query(where={ticker, published_date, claim_type})
           return results
   ```

3. **REFACTOR**: ê²€ìƒ‰ ê²°ê³¼ ìºì‹± (10ë¶„ TTL)

**ì‚°ì¶œë¬¼**:
- `backend/services/news_rag_query.py`
- `tests/test_news_rag_query.py`

**ê²€ì¦ ì‹œë‚˜ë¦¬ì˜¤**:
- Query: "NVDA GPU supply chain" â†’ "H200 ê³µê¸‰ ì°¨ì§ˆ" ë‰´ìŠ¤ ê²€ìƒ‰
- Claim Type: FACTë§Œ â†’ SPECULATION ì œì™¸ í™•ì¸

**ì¸ìˆ˜ ì¡°ê±´**:
- [ ] Semantic Search ì •í™•ë„ 80% ì´ìƒ
- [ ] Claim Type í•„í„°ë§ ë™ì‘
- [ ] ê²€ìƒ‰ ì‘ë‹µ ì‹œê°„ < 500ms

---

### [] Phase 3, T3.4: War Room Agent ë‰´ìŠ¤ ê²€ìƒ‰ í†µí•©

**ë‹´ë‹¹**: backend-specialist

**Git Worktree ì„¤ì •**: ë™ì¼ (`../ai-trading-phase3-news-rag`)

**ì„¤ëª…**: Analyst/Risk Agentê°€ RAG Query Serviceë¥¼ í˜¸ì¶œí•˜ì—¬ ê´€ë ¨ ë‰´ìŠ¤ ê²€ìƒ‰ í›„ í”„ë¡¬í”„íŠ¸ì— ì£¼ì….

**ìˆ˜ì • íŒŒì¼**:
- `backend/ai/mvp/analyst_agent_mvp.py`
- `backend/ai/mvp/risk_agent_mvp.py`

**êµ¬í˜„ ìƒì„¸**:
```python
class AnalystReasoningAgent:
    def __init__(self):
        self.news_rag = get_news_rag()  # ğŸ†•
    
    def _search_news(symbol, persona_mode):
        queries = {
            "dividend": f"{symbol} ë°°ë‹¹ ì¦ê°€ ì‚­ê°",
            "long_term": f"{symbol} ê²½ìŸë ¥ ì‹ ì œí’ˆ",
            "aggressive": f"{symbol} breakthrough ê¸‰ë“±"
        }
        
        claim_types = ['FACT', 'OPINION'] if persona_mode != 'aggressive' else ['FACT', 'OPINION', 'SPECULATION']
        
        return news_rag.search(
            query=queries[persona_mode],
            ticker=symbol,
            days=7,
            claim_types=claim_types
        )
```

**ì¸ìˆ˜ ì¡°ê±´**:
- [ ] Analyst Agent ì¶”ë¡ ì— ë‰´ìŠ¤ 3ê°œ í¬í•¨
- [ ] AGGRESSIVE ëª¨ë“œë§Œ SPECULATION í—ˆìš© í™•ì¸
- [ ] ë‰´ìŠ¤ ì—†ì–´ë„ ì—ëŸ¬ ì—†ì´ ì§„í–‰

---

## ì˜ì¡´ì„± ê·¸ë˜í”„

```mermaid
graph TD
    %% Phase 0
    T01[T0.1 Correlation Detector] --> T03[T0.3 Meta-Controller V2]
    T02[T0.2 Drawdown Recovery] --> T03
    T03 --> T05[T0.5 War Room í†µí•©]
    T04[T0.4 Liquidity Guardian] --> T05
    T05 --> T06[T0.6 ë°±í…ŒìŠ¤íŠ¸]
    
    %% Phase 1
    T11[T1.1 Exit Rules Dividend] --> T12[T1.2 Exit Rules LongTerm+Trading]
    T13[T1.3 Thesis Keeper DB] --> T14[T1.4 Position Aging]
    T12 --> T14
    
    %% Phase 2
    T21[T2.1 Fundamental Service] --> T24[T2.4 Analyst í†µí•©]
    T22[T2.2 Dividend Collector] --> T24
    T23[T2.3 Earnings Blackout] --> T24
    
    %% Phase 3
    T31[T3.1 Fact/Opinion Tagging] --> T32[T3.2 RAG Indexer]
    T32 --> T33[T3.3 RAG Query]
    T33 --> T34[T3.4 Agent í†µí•©]
    
    %% Cross-Phase
    T06 --> T11
    T14 --> T21
    T24 --> T31
```

---

## ë³‘ë ¬ ì‹¤í–‰ ê°€ëŠ¥ íƒœìŠ¤í¬

| Phase | ë³‘ë ¬ ê°€ëŠ¥ íƒœìŠ¤í¬ | ì´ìœ  |
|-------|----------------|------|
| Phase 0 | T0.1, T0.2, T0.4 | ì„œë¡œ ë…ë¦½ì ì¸ ëª¨ë“ˆ |
| Phase 1 | T1.1, T1.3 | Exit Rulesì™€ Thesis Keeper ë³„ê°œ |
| Phase 2 | T2.1, T2.2, T2.3 | ë°ì´í„° ìˆ˜ì§‘ê¸° ë…ë¦½ ì‹¤í–‰ |
| Phase 3 | - (ìˆœì°¨ ì‹¤í–‰) | RAG Indexer â†’ Query â†’ Agent ìˆœì„œ í•„ìˆ˜ |

---

## í”„ë¡œì íŠ¸ ì…‹ì—… ì œì•ˆ

TASKS.md ìƒì„±ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!

ì´ì œ Phase 0ë¥¼ ì‹œì‘í•  ì¤€ë¹„ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ìŒ ë‹¨ê³„ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”:

1. **ì˜ˆ** - ë°”ë¡œ Phase 0, T0.1 (Correlation Shock Detector) êµ¬í˜„ ì‹œì‘
2. **ì•„ë‹ˆì˜¤** - TASKS.md ê²€í†  í›„ ìˆ˜ë™ìœ¼ë¡œ ì‹œì‘

---

**ì‘ì„±ì**: Antigravity (tasks-generator workflow)  
**ì°¸ì¡° ë¬¸ì„œ**: 
- `docs/planning/260127/AI_Trading_System_Enhancement_Plan.md`
- `.agent/rules/tdd-workflow.md`
- `.agent/rules/git-conventions.md`
