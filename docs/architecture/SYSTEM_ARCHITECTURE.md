# AI Trading System - ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

**Last Updated**: 2025-12-30
**Version**: 1.0.0
**Author**: AI Trading System Development Team

---

## ğŸ“‹ ëª©ì°¨

1. [ì‹œìŠ¤í…œ ê°œìš”](#ì‹œìŠ¤í…œ-ê°œìš”)
2. [ê¸°ìˆ  ìŠ¤íƒ](#ê¸°ìˆ -ìŠ¤íƒ)
3. [ë°ì´í„°ë² ì´ìŠ¤ ì•„í‚¤í…ì²˜](#ë°ì´í„°ë² ì´ìŠ¤-ì•„í‚¤í…ì²˜)
4. [ë°±ì—”ë“œ ì•„í‚¤í…ì²˜](#ë°±ì—”ë“œ-ì•„í‚¤í…ì²˜)
5. [í”„ë¡ íŠ¸ì—”ë“œ ì•„í‚¤í…ì²˜](#í”„ë¡ íŠ¸ì—”ë“œ-ì•„í‚¤í…ì²˜)
6. [AI ì—ì´ì „íŠ¸ ì‹œìŠ¤í…œ](#ai-ì—ì´ì „íŠ¸-ì‹œìŠ¤í…œ)
7. [ë°ì´í„° íë¦„](#ë°ì´í„°-íë¦„)
8. [ìŠ¤ì¼€ì¤„ëŸ¬ ì‹œìŠ¤í…œ](#ìŠ¤ì¼€ì¤„ëŸ¬-ì‹œìŠ¤í…œ)
9. [API ì—”ë“œí¬ì¸íŠ¸](#api-ì—”ë“œí¬ì¸íŠ¸)
10. [ë³´ì•ˆ ë° ì¸ì¦](#ë³´ì•ˆ-ë°-ì¸ì¦)
11. [ë°°í¬ ë° ìš´ì˜](#ë°°í¬-ë°-ìš´ì˜)

---

## ì‹œìŠ¤í…œ ê°œìš”

### í”„ë¡œì íŠ¸ ëª©ì 

AI Trading Systemì€ **ë‹¤ì¤‘ AI ì—ì´ì „íŠ¸ ê¸°ë°˜ ìë™ íŠ¸ë ˆì´ë”© ì‹œìŠ¤í…œ**ì…ë‹ˆë‹¤. ë‰´ìŠ¤ ë¶„ì„, ê¸°ìˆ ì  ë¶„ì„, ë¦¬ìŠ¤í¬ ê´€ë¦¬, í¬íŠ¸í´ë¦¬ì˜¤ ìµœì í™” ë“±ì„ AI ì—ì´ì „íŠ¸ë“¤ì´ í˜‘ì—…í•˜ì—¬ ìˆ˜í–‰í•˜ê³ , ìµœì¢…ì ìœ¼ë¡œ PM(Portfolio Manager) ì—ì´ì „íŠ¸ê°€ ì˜ì‚¬ê²°ì •ì„ ë‚´ë¦½ë‹ˆë‹¤.

### í•µì‹¬ íŠ¹ì§•

1. **Multi-Agent War Room**: 9ê°œì˜ ì „ë¬¸ AI ì—ì´ì „íŠ¸ê°€ í˜‘ì—…
2. **News-Driven Trading**: ë‰´ìŠ¤ í•´ì„ ë° ì‹œì¥ ë°˜ì‘ ì˜ˆì¸¡
3. **Auto-Learning**: NIA(News Interpretation Accuracy) ê¸°ë°˜ ê°€ì¤‘ì¹˜ ìë™ ì¡°ì •
4. **Portfolio Optimization**: Modern Portfolio Theory ê¸°ë°˜ ìµœì í™”
5. **Risk Management**: ì‹¤ì‹œê°„ ë¦¬ìŠ¤í¬ ëª¨ë‹ˆí„°ë§ ë° ì†ì ˆ ìë™í™”
6. **Accountability System**: AI ì˜ì‚¬ê²°ì • ì¶”ì  ë° ì‹¤íŒ¨ í•™ìŠµ

### ì‹œìŠ¤í…œ êµ¬ì„±

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        User Interface                            â”‚
â”‚                    (React + TypeScript)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ REST API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      FastAPI Backend                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  API Router  â”‚  â”‚  Schedulers  â”‚  â”‚  AI Agents   â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ SQLAlchemy ORM
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PostgreSQL Database                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  Core Data   â”‚  â”‚  AI Data     â”‚  â”‚  System Data â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ê¸°ìˆ  ìŠ¤íƒ

### Backend

| êµ¬ë¶„ | ê¸°ìˆ  | ë²„ì „ | ìš©ë„ |
|------|------|------|------|
| **Framework** | FastAPI | 0.104+ | REST API ì„œë²„ |
| **ORM** | SQLAlchemy | 2.0+ | ë°ì´í„°ë² ì´ìŠ¤ ORM |
| **Database** | PostgreSQL | 14+ | ë©”ì¸ ë°ì´í„°ë² ì´ìŠ¤ |
| **AI SDK** | Google Gemini | 2.0 Flash | AI ì—ì´ì „íŠ¸ ì¶”ë¡  |
| **Scheduler** | APScheduler | 3.10+ | ìŠ¤ì¼€ì¤„ ì‘ì—… ê´€ë¦¬ |
| **Data Analysis** | Pandas | 2.0+ | ë°ì´í„° ë¶„ì„ ë° ì²˜ë¦¬ |
| **Financial Data** | yfinance | 0.2+ | ì£¼ê°€ ë°ì´í„° ë‹¤ìš´ë¡œë“œ |
| **Optimization** | scipy | 1.11+ | í¬íŠ¸í´ë¦¬ì˜¤ ìµœì í™” |
| **HTTP Client** | httpx | 0.24+ | ë¹„ë™ê¸° HTTP ìš”ì²­ |
| **Validation** | Pydantic | 2.0+ | ë°ì´í„° ê²€ì¦ |

### Frontend

| êµ¬ë¶„ | ê¸°ìˆ  | ë²„ì „ | ìš©ë„ |
|------|------|------|------|
| **Framework** | React | 18+ | UI í”„ë ˆì„ì›Œí¬ |
| **Language** | TypeScript | 5.0+ | íƒ€ì… ì•ˆì „ì„± |
| **Routing** | React Router | 6.0+ | í´ë¼ì´ì–¸íŠ¸ ë¼ìš°íŒ… |
| **State Management** | React Query | 4.0+ | ì„œë²„ ìƒíƒœ ê´€ë¦¬ |
| **Charts** | Recharts | 2.5+ | ì°¨íŠ¸ ì‹œê°í™” |
| **Icons** | Lucide React | 0.263+ | ì•„ì´ì½˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ |
| **Styling** | Tailwind CSS | 3.0+ | ìœ í‹¸ë¦¬í‹° CSS |
| **Build Tool** | Vite | 4.0+ | ë¹Œë“œ ë„êµ¬ |

### Infrastructure

| êµ¬ë¶„ | ê¸°ìˆ  | ìš©ë„ |
|------|------|------|
| **Containerization** | Docker | ê°œë°œ/ë°°í¬ í™˜ê²½ |
| **Orchestration** | Docker Compose | ë©€í‹° ì»¨í…Œì´ë„ˆ ê´€ë¦¬ |
| **Reverse Proxy** | Nginx | í”„ë¡ì‹œ ì„œë²„ |
| **Process Manager** | Uvicorn | ASGI ì„œë²„ |

---

## ë°ì´í„°ë² ì´ìŠ¤ ì•„í‚¤í…ì²˜

### ERD ê°œìš”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Core Trading Data                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  - trading_signals        (íŠ¸ë ˆì´ë”© ì‹œê·¸ë„)                      â”‚
â”‚  - orders                 (ì£¼ë¬¸ ë‚´ì—­)                            â”‚
â”‚  - positions              (í¬ì§€ì…˜ ì •ë³´)                          â”‚
â”‚  - portfolio_history      (í¬íŠ¸í´ë¦¬ì˜¤ íˆìŠ¤í† ë¦¬)                  â”‚
â”‚  - multi_asset_config     (ë©€í‹° ìì‚° ì„¤ì •)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         News & Analysis                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  - news_articles          (ë‰´ìŠ¤ ê¸°ì‚¬)                            â”‚
â”‚  - news_interpretations   (ë‰´ìŠ¤ í•´ì„)                            â”‚
â”‚  - news_market_reactions  (ì‹œì¥ ë°˜ì‘ ì˜ˆì¸¡)                       â”‚
â”‚  - news_decision_links    (ì˜ì‚¬ê²°ì • ì—°ê²°)                        â”‚
â”‚  - news_narratives        (ë‰´ìŠ¤ ë‚´ëŸ¬í‹°ë¸Œ)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      AI Agent & Learning                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  - war_room_conversations (War Room ëŒ€í™” ê¸°ë¡)                   â”‚
â”‚  - agent_weights_history  (ì—ì´ì „íŠ¸ ê°€ì¤‘ì¹˜ íˆìŠ¤í† ë¦¬)             â”‚
â”‚  - failure_analysis       (ì‹¤íŒ¨ ë¶„ì„)                            â”‚
â”‚  - decision_logs          (ì˜ì‚¬ê²°ì • ë¡œê·¸)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Portfolio & Risk Management                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  - asset_correlations     (ìì‚° ìƒê´€ê³„ìˆ˜)                        â”‚
â”‚  - portfolio_optimization (í¬íŠ¸í´ë¦¬ì˜¤ ìµœì í™” ê²°ê³¼)               â”‚
â”‚  - risk_assessments       (ë¦¬ìŠ¤í¬ í‰ê°€)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         System & Metadata                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  - macro_context_snapshots (ë§¤í¬ë¡œ ì»¨í…ìŠ¤íŠ¸)                     â”‚
â”‚  - rss_feeds              (RSS í”¼ë“œ)                             â”‚
â”‚  - api_usage_logs         (API ì‚¬ìš© ë¡œê·¸)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì£¼ìš” í…Œì´ë¸” ìƒì„¸

#### 1. trading_signals

íŠ¸ë ˆì´ë”© ì‹œê·¸ë„ ìƒì„± ë° ì¶”ì 

```sql
CREATE TABLE trading_signals (
    id SERIAL PRIMARY KEY,
    symbol VARCHAR(20) NOT NULL,
    signal_type VARCHAR(20) NOT NULL,  -- 'BUY', 'SELL', 'HOLD'
    confidence DECIMAL(5, 2),           -- 0.00 ~ 100.00
    reasoning TEXT,                     -- AI ì¶”ë¡  ë‚´ìš©
    created_at TIMESTAMP DEFAULT NOW(),
    source VARCHAR(50),                 -- 'war_room', 'technical', 'news'
    status VARCHAR(20) DEFAULT 'active', -- 'active', 'executed', 'cancelled'

    -- Price Targets
    entry_price DECIMAL(12, 2),
    target_price DECIMAL(12, 2),
    stop_loss DECIMAL(12, 2),

    -- Execution
    executed_at TIMESTAMP,
    execution_price DECIMAL(12, 2),

    -- Performance Tracking
    pnl DECIMAL(12, 2),
    pnl_percentage DECIMAL(10, 4),

    -- Metadata
    metadata JSONB
);

-- Indexes
CREATE INDEX idx_signals_symbol ON trading_signals(symbol);
CREATE INDEX idx_signals_created ON trading_signals(created_at DESC);
CREATE INDEX idx_signals_status ON trading_signals(status);
```

**í•„ë“œ ì„¤ëª…**:
- `signal_type`: BUY(ë§¤ìˆ˜), SELL(ë§¤ë„), HOLD(ë³´ìœ )
- `confidence`: AIì˜ í™•ì‹ ë„ (0~100%)
- `reasoning`: AI ì—ì´ì „íŠ¸ë“¤ì˜ ì¶”ë¡  ë‚´ìš© (War Room ëŒ€í™”)
- `source`: ì‹œê·¸ë„ ì¶œì²˜ (War Room, ê¸°ìˆ ì  ë¶„ì„, ë‰´ìŠ¤ ë¶„ì„)
- `metadata`: ì¶”ê°€ ì •ë³´ (JSON í˜•íƒœ)

**ì—°ê²° í…Œì´ë¸”**:
- `orders`: signal_idë¡œ ì—°ê²°
- `war_room_conversations`: ì‹œê·¸ë„ ìƒì„± ì‹œ ëŒ€í™” ê¸°ë¡

---

#### 2. news_interpretations

ë‰´ìŠ¤ í•´ì„ ë° ì‹œì¥ ì˜í–¥ ë¶„ì„

```sql
CREATE TABLE news_interpretations (
    id SERIAL PRIMARY KEY,
    article_id INTEGER REFERENCES news_articles(id),
    symbol VARCHAR(20) NOT NULL,

    -- Interpretation
    sentiment VARCHAR(20),              -- 'bullish', 'bearish', 'neutral'
    impact_score DECIMAL(5, 2),         -- 0.00 ~ 10.00
    reasoning TEXT,                     -- í•´ì„ ê·¼ê±°

    -- Market Impact Prediction
    predicted_direction VARCHAR(20),    -- 'up', 'down', 'sideways'
    predicted_magnitude DECIMAL(10, 4), -- ì˜ˆìƒ ë³€ë™í­ (%)
    time_horizon VARCHAR(20),           -- '1d', '1w', '1m'

    -- AI Agent Info
    agent_name VARCHAR(50),             -- 'news_agent'
    model_version VARCHAR(50),          -- 'gemini-2.0-flash'

    -- Timestamps
    created_at TIMESTAMP DEFAULT NOW(),

    -- Metadata
    metadata JSONB
);

-- Indexes
CREATE INDEX idx_interp_article ON news_interpretations(article_id);
CREATE INDEX idx_interp_symbol ON news_interpretations(symbol);
CREATE INDEX idx_interp_created ON news_interpretations(created_at DESC);
```

**í•„ë“œ ì„¤ëª…**:
- `sentiment`: ë‰´ìŠ¤ì˜ ê°ì„± (ìƒìŠ¹/í•˜ë½/ì¤‘ë¦½)
- `impact_score`: ì‹œì¥ ì˜í–¥ë„ (0~10ì )
- `predicted_direction`: ì˜ˆì¸¡ ë°©í–¥
- `predicted_magnitude`: ì˜ˆì¸¡ ë³€ë™í­ (%)
- `time_horizon`: ì˜ˆì¸¡ ì‹œê°„ ë²”ìœ„

**ì—°ê²° í…Œì´ë¸”**:
- `news_articles`: article_idë¡œ ì—°ê²°
- `news_market_reactions`: interpretation_idë¡œ ì—°ê²° (ê²€ì¦)

---

#### 3. news_market_reactions

ë‰´ìŠ¤ ì˜ˆì¸¡ ê²€ì¦ ë° ì •í™•ë„ ì¶”ì 

```sql
CREATE TABLE news_market_reactions (
    id SERIAL PRIMARY KEY,
    interpretation_id INTEGER REFERENCES news_interpretations(id),

    -- Prediction
    predicted_direction VARCHAR(20),
    predicted_magnitude DECIMAL(10, 4),

    -- Actual Market Movement
    actual_direction VARCHAR(20),
    actual_magnitude DECIMAL(10, 4),

    -- Accuracy Metrics (1d)
    accuracy_1d DECIMAL(5, 4),          -- 0.0000 ~ 1.0000
    verified_at_1d TIMESTAMP,

    -- Accuracy Metrics (1w)
    accuracy_1w DECIMAL(5, 4),
    verified_at_1w TIMESTAMP,

    -- Accuracy Metrics (1m)
    accuracy_1m DECIMAL(5, 4),
    verified_at_1m TIMESTAMP,

    -- Price Data
    price_at_prediction DECIMAL(12, 2),
    price_after_1d DECIMAL(12, 2),
    price_after_1w DECIMAL(12, 2),
    price_after_1m DECIMAL(12, 2),

    created_at TIMESTAMP DEFAULT NOW()
);

-- Indexes
CREATE INDEX idx_reaction_interp ON news_market_reactions(interpretation_id);
CREATE INDEX idx_reaction_verified_1d ON news_market_reactions(verified_at_1d);
```

**í•„ë“œ ì„¤ëª…**:
- `accuracy_1d/1w/1m`: 1ì¼/1ì£¼/1ê°œì›” í›„ ì •í™•ë„
- `verified_at_*`: ê²€ì¦ ì™„ë£Œ ì‹œê°
- `price_at_prediction`: ì˜ˆì¸¡ ì‹œì  ê°€ê²©
- `price_after_*`: 1d/1w/1m í›„ ì‹¤ì œ ê°€ê²©

**ì‚¬ìš©ì²˜**:
- NIA(News Interpretation Accuracy) ì ìˆ˜ ê³„ì‚°
- ì‹¤íŒ¨ í•™ìŠµ (Failure Learning)
- ì—ì´ì „íŠ¸ ê°€ì¤‘ì¹˜ ìë™ ì¡°ì •

---

#### 4. agent_weights_history

War Room ì—ì´ì „íŠ¸ ê°€ì¤‘ì¹˜ íˆìŠ¤í† ë¦¬

```sql
CREATE TABLE agent_weights_history (
    id SERIAL PRIMARY KEY,

    -- Timestamp & Source
    changed_at TIMESTAMP DEFAULT NOW(),
    changed_by VARCHAR(100),            -- 'system', 'admin', 'FailureLearningScheduler'
    reason TEXT,                        -- ì¡°ì • ì´ìœ 

    -- Agent Weights (í•©ê³„ = 1.0)
    trader_agent DECIMAL(5, 4),         -- ê¸°ë³¸ 0.15
    risk_agent DECIMAL(5, 4),           -- ê¸°ë³¸ 0.15
    analyst_agent DECIMAL(5, 4),        -- ê¸°ë³¸ 0.12
    macro_agent DECIMAL(5, 4),          -- ê¸°ë³¸ 0.14
    institutional_agent DECIMAL(5, 4),  -- ê¸°ë³¸ 0.14
    news_agent DECIMAL(5, 4),           -- ê¸°ë³¸ 0.14 (NIA ê¸°ë°˜ ì¡°ì •)
    chip_war_agent DECIMAL(5, 4),       -- ê¸°ë³¸ 0.14
    dividend_risk_agent DECIMAL(5, 4),  -- ê¸°ë³¸ 0.02
    pm_agent DECIMAL(5, 4) DEFAULT 0    -- PMì€ ê°€ì¤‘ì¹˜ ì—†ìŒ (ìµœì¢… ì˜ì‚¬ê²°ì •ì)
);

-- Indexes
CREATE INDEX idx_weights_changed ON agent_weights_history(changed_at DESC);
CREATE INDEX idx_weights_changedby ON agent_weights_history(changed_by);
```

**í•„ë“œ ì„¤ëª…**:
- `changed_by`: ë³€ê²½ ì£¼ì²´ (ì‹œìŠ¤í…œ/ê´€ë¦¬ì/ìë™í•™ìŠµ)
- `reason`: ì¡°ì • ì´ìœ  (ì˜ˆ: "NIA below 60% - decreasing News Agent weight")
- `*_agent`: ê° ì—ì´ì „íŠ¸ì˜ ê°€ì¤‘ì¹˜ (í•©ê³„ 1.0)

**ìë™ ì¡°ì • ê·œì¹™**:
```python
if NIA < 60%:
    news_agent -= 0.02  # ì„±ëŠ¥ ì €í•˜ ì‹œ ê°€ì¤‘ì¹˜ ê°ì†Œ
elif NIA >= 80%:
    news_agent += 0.02  # ì„±ëŠ¥ ìš°ìˆ˜ ì‹œ ê°€ì¤‘ì¹˜ ì¦ê°€
```

**ì‚¬ìš©ì²˜**:
- War Room ìµœì¢… ì˜ì‚¬ê²°ì • ì‹œ ê°€ì¤‘ì¹˜ ì ìš©
- Auto-Learning Dashboard ì‹œê°í™”
- ì„±ëŠ¥ ì¶”ì  ë° ìµœì í™”

---

#### 5. asset_correlations

ìì‚° ê°„ ìƒê´€ê³„ìˆ˜ (í¬íŠ¸í´ë¦¬ì˜¤ ë¶„ì‚° ìµœì í™”)

```sql
CREATE TABLE asset_correlations (
    id SERIAL PRIMARY KEY,

    -- Asset Pair
    symbol1 VARCHAR(20) NOT NULL,
    symbol2 VARCHAR(20) NOT NULL,

    -- Correlation Coefficients
    correlation_30d DECIMAL(10, 6),     -- 30ì¼ ìƒê´€ê³„ìˆ˜
    correlation_90d DECIMAL(10, 6),     -- 90ì¼ ìƒê´€ê³„ìˆ˜
    correlation_1y DECIMAL(10, 6),      -- 1ë…„ ìƒê´€ê³„ìˆ˜

    -- Metadata
    calculated_at TIMESTAMP DEFAULT NOW(),

    -- Unique Constraint
    UNIQUE(symbol1, symbol2)
);

-- Indexes
CREATE INDEX idx_correlation_pair ON asset_correlations(symbol1, symbol2);
CREATE INDEX idx_correlation_calculated ON asset_correlations(calculated_at DESC);
```

**í•„ë“œ ì„¤ëª…**:
- `symbol1, symbol2`: ìì‚° í˜ì–´ (ì˜ˆ: AAPL, MSFT)
- `correlation_30d/90d/1y`: ê¸°ê°„ë³„ ìƒê´€ê³„ìˆ˜ (-1.0 ~ 1.0)
- `calculated_at`: ê³„ì‚° ì‹œê°

**ìƒê´€ê³„ìˆ˜ í•´ì„**:
- `> 0.7`: ê°•í•œ ì–‘ì˜ ìƒê´€ê´€ê³„ (í•¨ê»˜ ì›€ì§ì„)
- `0.3 ~ 0.7`: ì•½í•œ ì–‘ì˜ ìƒê´€ê´€ê³„
- `-0.3 ~ 0.3`: ë¬´ìƒê´€
- `< -0.3`: ìŒì˜ ìƒê´€ê´€ê³„ (ë°˜ëŒ€ë¡œ ì›€ì§ì„)

**ê³„ì‚° ë°©ì‹**:
```python
# Pearson Correlation on Returns
returns1 = prices1.pct_change()
returns2 = prices2.pct_change()
correlation = returns1.corr(returns2)
```

**ì‚¬ìš©ì²˜**:
- í¬íŠ¸í´ë¦¬ì˜¤ ë¶„ì‚° ìµœì í™”
- Correlation Dashboard ì‹œê°í™”
- Hedging ì „ëµ ìˆ˜ë¦½

---

#### 6. multi_asset_config

ë©€í‹° ìì‚° íŠ¸ë ˆì´ë”© ì„¤ì •

```sql
CREATE TABLE multi_asset_config (
    id SERIAL PRIMARY KEY,
    symbol VARCHAR(20) UNIQUE NOT NULL,

    -- Asset Info
    asset_name VARCHAR(100),
    asset_type VARCHAR(50),             -- 'stock', 'etf', 'crypto', 'commodity'
    sector VARCHAR(50),

    -- Trading Config
    is_active BOOLEAN DEFAULT true,     -- íŠ¸ë ˆì´ë”© í™œì„±í™” ì—¬ë¶€
    max_position_size DECIMAL(12, 2),   -- ìµœëŒ€ í¬ì§€ì…˜ í¬ê¸° ($)
    allocation_percentage DECIMAL(5, 2), -- í¬íŠ¸í´ë¦¬ì˜¤ í• ë‹¹ ë¹„ìœ¨ (%)

    -- Risk Parameters
    stop_loss_percentage DECIMAL(5, 2), -- ì†ì ˆ ë¹„ìœ¨ (%)
    take_profit_percentage DECIMAL(5, 2), -- ìµì ˆ ë¹„ìœ¨ (%)

    -- Metadata
    added_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- Indexes
CREATE INDEX idx_asset_symbol ON multi_asset_config(symbol);
CREATE INDEX idx_asset_active ON multi_asset_config(is_active);
```

**í•„ë“œ ì„¤ëª…**:
- `symbol`: ìì‚° ì‹¬ë³¼ (AAPL, BTC-USD, GLD ë“±)
- `asset_type`: ìì‚° ìœ í˜• (ì£¼ì‹/ETF/ì•”í˜¸í™”í/ì›ìì¬)
- `is_active`: íŠ¸ë ˆì´ë”© í™œì„±í™” ì—¬ë¶€
- `allocation_percentage`: í¬íŠ¸í´ë¦¬ì˜¤ ë‚´ ëª©í‘œ ë¹„ì¤‘

**ì‚¬ìš©ì²˜**:
- Multi-Asset Dashboard
- Portfolio Optimization
- Correlation Calculation (í™œì„± ìì‚°ë§Œ)

---

#### 7. war_room_conversations

War Room AI ì—ì´ì „íŠ¸ ëŒ€í™” ê¸°ë¡

```sql
CREATE TABLE war_room_conversations (
    id SERIAL PRIMARY KEY,
    session_id VARCHAR(100) NOT NULL,   -- ì„¸ì…˜ ID (UUID)

    -- Context
    symbol VARCHAR(20),
    question TEXT,                      -- PMì˜ ì§ˆë¬¸

    -- Agent Responses
    trader_response TEXT,
    risk_response TEXT,
    analyst_response TEXT,
    macro_response TEXT,
    institutional_response TEXT,
    news_response TEXT,
    chip_war_response TEXT,
    dividend_risk_response TEXT,

    -- PM Decision
    pm_decision TEXT,                   -- ìµœì¢… ì˜ì‚¬ê²°ì •
    pm_reasoning TEXT,                  -- ì˜ì‚¬ê²°ì • ê·¼ê±°

    -- Result
    final_decision VARCHAR(20),         -- 'BUY', 'SELL', 'HOLD'
    confidence DECIMAL(5, 2),           -- í™•ì‹ ë„

    -- Metadata
    created_at TIMESTAMP DEFAULT NOW(),
    duration_seconds DECIMAL(10, 2),    -- ëŒ€í™” ì†Œìš” ì‹œê°„

    -- Signal Link
    signal_id INTEGER REFERENCES trading_signals(id)
);

-- Indexes
CREATE INDEX idx_warroom_session ON war_room_conversations(session_id);
CREATE INDEX idx_warroom_symbol ON war_room_conversations(symbol);
CREATE INDEX idx_warroom_created ON war_room_conversations(created_at DESC);
```

**í•„ë“œ ì„¤ëª…**:
- `session_id`: War Room ì„¸ì…˜ ID
- `*_response`: ê° ì—ì´ì „íŠ¸ì˜ ì‘ë‹µ
- `pm_decision`: PMì˜ ìµœì¢… ì˜ì‚¬ê²°ì •
- `final_decision`: ìµœì¢… ì•¡ì…˜ (BUY/SELL/HOLD)
- `signal_id`: ìƒì„±ëœ íŠ¸ë ˆì´ë”© ì‹œê·¸ë„ ID

**ëŒ€í™” íë¦„**:
```
PM: "AAPLì— ëŒ€í•œ ë§¤ìˆ˜ ì˜ê²¬ì„ ë“£ê³  ì‹¶ìŠµë‹ˆë‹¤."
  â†“
Trader Agent: "ê¸°ìˆ ì ìœ¼ë¡œ ìƒìŠ¹ ì¶”ì„¸..."
Risk Agent: "í˜„ì¬ ë³€ë™ì„± ë†’ìŒ, ì£¼ì˜ í•„ìš”..."
Analyst Agent: "ì‹¤ì  ì „ë§ ê¸ì •ì ..."
News Agent: "ìµœê·¼ ê¸ì •ì  ë‰´ìŠ¤ ë‹¤ìˆ˜..."
Macro Agent: "ì—°ì¤€ ê¸ˆë¦¬ ë™ê²° ì˜ˆìƒ..."
...
  â†“
PM: "ì¢…í•© ì˜ê²¬: ë§¤ìˆ˜ ì¶”ì²œ, í™•ì‹ ë„ 75%"
  â†“
Trading Signal ìƒì„±
```

---

#### 8. failure_analysis

AI ì‹¤íŒ¨ ë¶„ì„ ë° í•™ìŠµ

```sql
CREATE TABLE failure_analysis (
    id SERIAL PRIMARY KEY,

    -- Link to Prediction
    interpretation_id INTEGER REFERENCES news_interpretations(id),

    -- Failure Details
    predicted_direction VARCHAR(20),
    actual_direction VARCHAR(20),
    accuracy DECIMAL(5, 4),             -- ì •í™•ë„ (0.0 ~ 1.0)

    -- AI Analysis
    failure_reason TEXT,                -- ì‹¤íŒ¨ ì›ì¸ ë¶„ì„
    missed_factors TEXT[],              -- ë†“ì¹œ ìš”ì¸ë“¤
    suggested_improvements TEXT,        -- ê°œì„  ì œì•ˆ

    -- Agent Responsibility
    responsible_agent VARCHAR(50),      -- ì£¼ ì±…ì„ ì—ì´ì „íŠ¸

    -- Learning Action
    action_taken VARCHAR(100),          -- ì·¨í•œ ì¡°ì¹˜
    weight_adjustment DECIMAL(5, 4),    -- ê°€ì¤‘ì¹˜ ì¡°ì •ëŸ‰

    -- Metadata
    analyzed_at TIMESTAMP DEFAULT NOW(),
    analyzer_agent VARCHAR(50) DEFAULT 'failure_learning_agent'
);

-- Indexes
CREATE INDEX idx_failure_interp ON failure_analysis(interpretation_id);
CREATE INDEX idx_failure_analyzed ON failure_analysis(analyzed_at DESC);
```

**í•„ë“œ ì„¤ëª…**:
- `failure_reason`: AIê°€ ë¶„ì„í•œ ì‹¤íŒ¨ ì›ì¸
- `missed_factors`: ì˜ˆì¸¡ ì‹œ ê³ ë ¤í•˜ì§€ ëª»í•œ ìš”ì¸ë“¤
- `responsible_agent`: ì£¼ ì±…ì„ ì—ì´ì „íŠ¸
- `action_taken`: ì·¨í•œ ì¡°ì¹˜ (ê°€ì¤‘ì¹˜ ì¡°ì •, í•™ìŠµ ë“±)

**ì‹¤íŒ¨ ë¶„ì„ í”„ë¡œì„¸ìŠ¤**:
```python
1. ë‚®ì€ ì •í™•ë„ ì˜ˆì¸¡ ìˆ˜ì§‘ (accuracy < 0.5)
2. Gemini AIë¡œ ì‹¤íŒ¨ ì›ì¸ ë¶„ì„
3. ë†“ì¹œ ìš”ì¸ ì‹ë³„
4. ê°œì„  ì œì•ˆ ìƒì„±
5. ê°€ì¤‘ì¹˜ ì¡°ì • (í•„ìš” ì‹œ)
6. failure_analysis í…Œì´ë¸”ì— ì €ì¥
```

**ì‚¬ìš©ì²˜**:
- Accountability Dashboard
- Auto-Learning Dashboard
- ì—ì´ì „íŠ¸ ì„±ëŠ¥ ê°œì„ 

---

### ë°ì´í„°ë² ì´ìŠ¤ ê´€ê³„ë„

```
news_articles (1) â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€ (N) news_interpretations
                        â”‚
                        â””â”€â”€â”€ (N) news_decision_links

news_interpretations (1) â”€â”€â”€ (1) news_market_reactions
                        â”‚
                        â””â”€â”€â”€ (1) failure_analysis

trading_signals (1) â”€â”€â”€â”€â”¬â”€â”€â”€ (N) orders
                        â”‚
                        â””â”€â”€â”€ (1) war_room_conversations

multi_asset_config (N) â”€â”€â”€ (1) portfolio_optimization

asset_correlations (pair) â”€â”€â”€ portfolio_optimization
```

---

## ë°±ì—”ë“œ ì•„í‚¤í…ì²˜

### ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
backend/
â”œâ”€â”€ main.py                      # FastAPI ì•± ì§„ì…ì 
â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ models.py                # SQLAlchemy ëª¨ë¸ ì •ì˜
â”‚   â”œâ”€â”€ repository.py            # ë°ì´í„°ë² ì´ìŠ¤ ì„¸ì…˜ ê´€ë¦¬
â”‚   â””â”€â”€ migrations/              # Alembic ë§ˆì´ê·¸ë ˆì´ì…˜
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ trading_router.py        # íŠ¸ë ˆì´ë”© API
â”‚   â”œâ”€â”€ news_router.py           # ë‰´ìŠ¤ API
â”‚   â”œâ”€â”€ war_room_router.py       # War Room API
â”‚   â”œâ”€â”€ portfolio_router.py      # í¬íŠ¸í´ë¦¬ì˜¤ API
â”‚   â”œâ”€â”€ correlation_router.py    # ìƒê´€ê³„ìˆ˜ API
â”‚   â”œâ”€â”€ failure_learning_router.py # ìë™í•™ìŠµ API
â”‚   â””â”€â”€ ...
â”œâ”€â”€ ai/
â”‚   â”œâ”€â”€ agents/
â”‚   â”‚   â”œâ”€â”€ trader_agent.py      # Trader Agent
â”‚   â”‚   â”œâ”€â”€ risk_agent.py        # Risk Agent
â”‚   â”‚   â”œâ”€â”€ news_agent.py        # News Agent
â”‚   â”‚   â”œâ”€â”€ pm_agent.py          # PM Agent
â”‚   â”‚   â”œâ”€â”€ failure_learning_agent.py
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ prompts/
â”‚   â”‚   â”œâ”€â”€ trader_prompt.txt
â”‚   â”‚   â”œâ”€â”€ news_prompt.txt
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ gemini_client.py     # Gemini API í´ë¼ì´ì–¸íŠ¸
â”‚       â””â”€â”€ prompt_loader.py     # í”„ë¡¬í”„íŠ¸ ë¡œë”
â”œâ”€â”€ schedulers/
â”‚   â”œâ”€â”€ news_scheduler.py        # ë‰´ìŠ¤ ìˆ˜ì§‘ ìŠ¤ì¼€ì¤„ëŸ¬
â”‚   â”œâ”€â”€ verification_scheduler.py # ì˜ˆì¸¡ ê²€ì¦ ìŠ¤ì¼€ì¤„ëŸ¬
â”‚   â”œâ”€â”€ failure_learning_scheduler.py # ìë™í•™ìŠµ ìŠ¤ì¼€ì¤„ëŸ¬
â”‚   â”œâ”€â”€ correlation_scheduler.py  # ìƒê´€ê³„ìˆ˜ ê³„ì‚° ìŠ¤ì¼€ì¤„ëŸ¬
â”‚   â””â”€â”€ ...
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ portfolio_optimizer.py   # í¬íŠ¸í´ë¦¬ì˜¤ ìµœì í™”
â”‚   â”œâ”€â”€ risk_calculator.py       # ë¦¬ìŠ¤í¬ ê³„ì‚°
â”‚   â””â”€â”€ ...
â””â”€â”€ utils/
    â”œâ”€â”€ logger.py                # ë¡œê¹… ìœ í‹¸
    â””â”€â”€ config.py                # ì„¤ì • ê´€ë¦¬
```

### FastAPI ë¼ìš°í„° êµ¬ì¡°

#### ë¼ìš°í„° ë“±ë¡ (main.py)

```python
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware

app = FastAPI(title="AI Trading System")

# CORS ì„¤ì •
app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:3002"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# ë¼ìš°í„° ë“±ë¡
from backend.api.trading_router import router as trading_router
from backend.api.news_router import router as news_router
from backend.api.war_room_router import router as war_room_router
from backend.api.portfolio_router import router as portfolio_router
from backend.api.correlation_router import router as correlation_router
from backend.api.failure_learning_router import router as failure_learning_router

app.include_router(trading_router)
app.include_router(news_router)
app.include_router(war_room_router)
app.include_router(portfolio_router)
app.include_router(correlation_router)
app.include_router(failure_learning_router)

@app.get("/")
async def root():
    return {"message": "AI Trading System API", "version": "1.0.0"}

@app.get("/health")
async def health_check():
    return {"status": "healthy"}
```

#### API Router êµ¬ì¡° ì˜ˆì‹œ (correlation_router.py)

```python
from fastapi import APIRouter, HTTPException, Query
from typing import Optional, List, Dict
from datetime import datetime

router = APIRouter(prefix="/api/correlation", tags=["Correlation"])

@router.post("/calculate")
async def calculate_correlations():
    """
    ìƒê´€ê³„ìˆ˜ ìˆ˜ë™ ê³„ì‚° íŠ¸ë¦¬ê±°

    Returns:
        - timestamp: ê³„ì‚° ì‹œê°
        - success: ì„±ê³µ ì—¬ë¶€
        - assets_count: ìì‚° ìˆ˜
        - pairs_calculated: ê³„ì‚°ëœ í˜ì–´ ìˆ˜
    """
    try:
        scheduler = CorrelationScheduler()
        result = scheduler.calculate_all_correlations()
        return result
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

@router.get("/status")
async def get_status():
    """
    ê³„ì‚° ìƒíƒœ ì¡°íšŒ

    Returns:
        - total_pairs: ì €ì¥ëœ í˜ì–´ ìˆ˜
        - expected_pairs: ê¸°ëŒ€ í˜ì–´ ìˆ˜
        - coverage: ì»¤ë²„ë¦¬ì§€ %
        - last_calculated: ë§ˆì§€ë§‰ ê³„ì‚° ì‹œê°
    """
    # Implementation
    pass

@router.get("/heatmap")
async def get_heatmap(
    period: str = Query("90d", regex="^(30d|90d|1y)$"),
    min_correlation: Optional[float] = Query(None, ge=-1.0, le=1.0)
):
    """
    íˆíŠ¸ë§µ ë°ì´í„° ì¡°íšŒ

    Args:
        period: ê¸°ê°„ (30d, 90d, 1y)
        min_correlation: ìµœì†Œ ìƒê´€ê³„ìˆ˜ í•„í„°

    Returns:
        - matrix: ìƒê´€ê³„ìˆ˜ í–‰ë ¬
        - heatmap_data: ì°¨íŠ¸ìš© ë°ì´í„°
    """
    # Implementation
    pass

@router.get("/pairs")
async def get_top_pairs(
    period: str = Query("90d"),
    sort_by: str = Query("highest", regex="^(highest|lowest)$"),
    limit: int = Query(20, ge=1, le=100)
):
    """
    Top ìƒê´€ í˜ì–´ ì¡°íšŒ

    Args:
        period: ê¸°ê°„
        sort_by: ì •ë ¬ (highest/lowest)
        limit: ìµœëŒ€ ê²°ê³¼ ìˆ˜

    Returns:
        - pairs: ìƒê´€ í˜ì–´ ë¦¬ìŠ¤íŠ¸
    """
    # Implementation
    pass
```

**FastAPI íŠ¹ì§•**:
- **ìë™ ë¬¸ì„œí™”**: `/docs` (Swagger UI), `/redoc` (ReDoc)
- **íƒ€ì… ê²€ì¦**: Pydantic ëª¨ë¸ ìë™ ê²€ì¦
- **ë¹„ë™ê¸° ì§€ì›**: `async/await` íŒ¨í„´
- **ì˜ì¡´ì„± ì£¼ì…**: Dependency Injection

---

### AI ì—ì´ì „íŠ¸ ì‹œìŠ¤í…œ

#### ì—ì´ì „íŠ¸ ê³„ì¸µ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PM Agent (ìµœì¢… ì˜ì‚¬ê²°ì •)                     â”‚
â”‚                   Portfolio Manager Agent                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚ (ê°€ì¤‘ì¹˜ ê¸°ë°˜ ì¢…í•©)
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼               â–¼               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Trader Agent  â”‚ â”‚ Risk Agent   â”‚ â”‚Analyst Agent â”‚ â”‚ Macro Agent  â”‚
â”‚(ê¸°ìˆ ì  ë¶„ì„) â”‚ â”‚(ë¦¬ìŠ¤í¬ ê´€ë¦¬) â”‚ â”‚(ê¸°ë³¸ì  ë¶„ì„) â”‚ â”‚(ë§¤í¬ë¡œ ë¶„ì„) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Institutional â”‚ â”‚  News Agent  â”‚ â”‚Chip War Agentâ”‚ â”‚Dividend Risk â”‚
â”‚    Agent     â”‚ â”‚(ë‰´ìŠ¤ ë¶„ì„)   â”‚ â”‚(ë°˜ë„ì²´ ë¶„ì„) â”‚ â”‚    Agent     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ì—ì´ì „íŠ¸ êµ¬í˜„ ì˜ˆì‹œ (news_agent.py)

```python
"""
News Agent

ë‰´ìŠ¤ í•´ì„ ë° ì‹œì¥ ì˜í–¥ ì˜ˆì¸¡ ì „ë¬¸ AI ì—ì´ì „íŠ¸
"""

import os
from datetime import datetime
from typing import Dict, Optional
import google.generativeai as genai

class NewsAgent:
    """
    ë‰´ìŠ¤ ë¶„ì„ ì—ì´ì „íŠ¸

    ì—­í• :
    - ë‰´ìŠ¤ ê¸°ì‚¬ í•´ì„
    - ì‹œì¥ ì˜í–¥ ì˜ˆì¸¡
    - ê°ì„± ë¶„ì„
    """

    def __init__(self):
        """Initialize News Agent"""
        self.agent_name = "news_agent"
        self.model_version = "gemini-2.0-flash-exp"

        # Gemini API ì„¤ì •
        genai.configure(api_key=os.getenv("GEMINI_API_KEY"))
        self.model = genai.GenerativeModel(self.model_version)

        # í”„ë¡¬í”„íŠ¸ ë¡œë“œ
        with open("backend/ai/prompts/news_agent_prompt.txt", "r") as f:
            self.system_prompt = f.read()

    def interpret_news(
        self,
        article: Dict,
        symbol: str,
        context: Optional[Dict] = None
    ) -> Dict:
        """
        ë‰´ìŠ¤ í•´ì„ ë° ì‹œì¥ ì˜í–¥ ì˜ˆì¸¡

        Args:
            article: ë‰´ìŠ¤ ê¸°ì‚¬ ì •ë³´
            symbol: ì¢…ëª© ì‹¬ë³¼
            context: ì¶”ê°€ ì»¨í…ìŠ¤íŠ¸ (ë§¤í¬ë¡œ í™˜ê²½ ë“±)

        Returns:
            {
                'sentiment': 'bullish' | 'bearish' | 'neutral',
                'impact_score': 0.0 ~ 10.0,
                'reasoning': 'í•´ì„ ê·¼ê±°',
                'predicted_direction': 'up' | 'down' | 'sideways',
                'predicted_magnitude': ì˜ˆìƒ ë³€ë™í­ (%),
                'time_horizon': '1d' | '1w' | '1m',
                'confidence': 0.0 ~ 1.0
            }
        """
        # í”„ë¡¬í”„íŠ¸ êµ¬ì„±
        user_prompt = f"""
**ë‰´ìŠ¤ ë¶„ì„ ìš”ì²­**

ì¢…ëª©: {symbol}
ì œëª©: {article['title']}
ë³¸ë¬¸: {article['content']}
ì¶œì²˜: {article['source']}
ë°œí–‰ì¼: {article['published_at']}

**ì»¨í…ìŠ¤íŠ¸**:
{context if context else 'ì—†ìŒ'}

ìœ„ ë‰´ìŠ¤ë¥¼ ë¶„ì„í•˜ì—¬ ë‹¤ìŒì„ ì œê³µí•˜ì„¸ìš”:
1. ê°ì„± (bullish/bearish/neutral)
2. ì‹œì¥ ì˜í–¥ë„ (0~10ì )
3. í•´ì„ ê·¼ê±°
4. ì˜ˆìƒ ë°©í–¥ (up/down/sideways)
5. ì˜ˆìƒ ë³€ë™í­ (%)
6. ì‹œê°„ ë²”ìœ„ (1d/1w/1m)
7. í™•ì‹ ë„ (0.0~1.0)

JSON í˜•íƒœë¡œ ë°˜í™˜í•˜ì„¸ìš”.
"""

        # Gemini API í˜¸ì¶œ
        response = self.model.generate_content(
            [self.system_prompt, user_prompt],
            generation_config={
                "temperature": 0.3,  # ë‚®ì€ ì˜¨ë„ë¡œ ì¼ê´€ì„± ìœ ì§€
                "top_p": 0.95,
                "max_output_tokens": 1000
            }
        )

        # JSON íŒŒì‹±
        result = self._parse_response(response.text)

        # ë©”íƒ€ë°ì´í„° ì¶”ê°€
        result['agent_name'] = self.agent_name
        result['model_version'] = self.model_version
        result['analyzed_at'] = datetime.now().isoformat()

        return result

    def _parse_response(self, text: str) -> Dict:
        """Gemini ì‘ë‹µ íŒŒì‹± (JSON ì¶”ì¶œ)"""
        import json
        import re

        # JSON ë¸”ë¡ ì¶”ì¶œ
        json_match = re.search(r'\{.*\}', text, re.DOTALL)
        if json_match:
            return json.loads(json_match.group())
        else:
            # íŒŒì‹± ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ê°’ ë°˜í™˜
            return {
                'sentiment': 'neutral',
                'impact_score': 5.0,
                'reasoning': text,
                'predicted_direction': 'sideways',
                'predicted_magnitude': 0.0,
                'time_horizon': '1d',
                'confidence': 0.5
            }
```

#### PM Agent (Portfolio Manager)

```python
"""
PM Agent - Portfolio Manager

ìµœì¢… ì˜ì‚¬ê²°ì •ì
ëª¨ë“  ì—ì´ì „íŠ¸ì˜ ì˜ê²¬ì„ ì¢…í•©í•˜ì—¬ ìµœì¢… ê²°ì •
"""

class PMAgent:
    """
    Portfolio Manager Agent

    ì—­í• :
    - ëª¨ë“  ì—ì´ì „íŠ¸ ì˜ê²¬ ìˆ˜ì§‘
    - ê°€ì¤‘ì¹˜ ê¸°ë°˜ ì¢…í•© íŒë‹¨
    - ìµœì¢… ì˜ì‚¬ê²°ì • (BUY/SELL/HOLD)
    - War Room ëŒ€í™” ì§„í–‰
    """

    def __init__(self):
        self.agent_name = "pm_agent"
        self.model = genai.GenerativeModel("gemini-2.0-flash-exp")

        # ë‹¤ë¥¸ ì—ì´ì „íŠ¸ ì¸ìŠ¤í„´ìŠ¤
        self.trader = TraderAgent()
        self.risk = RiskAgent()
        self.analyst = AnalystAgent()
        self.macro = MacroAgent()
        self.institutional = InstitutionalAgent()
        self.news = NewsAgent()
        self.chip_war = ChipWarAgent()
        self.dividend_risk = DividendRiskAgent()

    def make_decision(
        self,
        symbol: str,
        question: str,
        context: Optional[Dict] = None
    ) -> Dict:
        """
        War Room ëŒ€í™”ë¥¼ í†µí•œ ìµœì¢… ì˜ì‚¬ê²°ì •

        Process:
        1. PMì´ ì§ˆë¬¸ ì œì‹œ
        2. ê° ì—ì´ì „íŠ¸ ì˜ê²¬ ìˆ˜ì§‘
        3. ê°€ì¤‘ì¹˜ ì ìš©í•˜ì—¬ ì¢…í•©
        4. PMì´ ìµœì¢… ê²°ì •
        5. Trading Signal ìƒì„±

        Args:
            symbol: ì¢…ëª© ì‹¬ë³¼
            question: PMì˜ ì§ˆë¬¸
            context: ì¶”ê°€ ì»¨í…ìŠ¤íŠ¸

        Returns:
            {
                'session_id': UUID,
                'final_decision': 'BUY' | 'SELL' | 'HOLD',
                'confidence': 0.0 ~ 100.0,
                'reasoning': PMì˜ ì¶”ë¡ ,
                'agent_responses': {...},
                'signal_id': int (ìƒì„±ëœ ì‹œê·¸ë„ ID)
            }
        """
        import uuid
        session_id = str(uuid.uuid4())

        # 1. ê° ì—ì´ì „íŠ¸ ì˜ê²¬ ìˆ˜ì§‘
        responses = {}
        responses['trader'] = self.trader.analyze(symbol, context)
        responses['risk'] = self.risk.assess(symbol, context)
        responses['analyst'] = self.analyst.analyze(symbol, context)
        responses['macro'] = self.macro.analyze(context)
        responses['institutional'] = self.institutional.analyze(symbol, context)
        responses['news'] = self.news.get_latest_sentiment(symbol)
        responses['chip_war'] = self.chip_war.analyze(symbol, context)
        responses['dividend_risk'] = self.dividend_risk.analyze(symbol, context)

        # 2. ê°€ì¤‘ì¹˜ ê°€ì ¸ì˜¤ê¸°
        weights = self._get_current_weights()

        # 3. PMì˜ ì¢…í•© íŒë‹¨
        pm_prompt = f"""
**War Room ì˜ì‚¬ê²°ì •**

ì§ˆë¬¸: {question}
ì¢…ëª©: {symbol}

**ì—ì´ì „íŠ¸ ì˜ê²¬**:

Trader Agent (ê°€ì¤‘ì¹˜: {weights['trader_agent']:.2%}):
{responses['trader']}

Risk Agent (ê°€ì¤‘ì¹˜: {weights['risk_agent']:.2%}):
{responses['risk']}

Analyst Agent (ê°€ì¤‘ì¹˜: {weights['analyst_agent']:.2%}):
{responses['analyst']}

Macro Agent (ê°€ì¤‘ì¹˜: {weights['macro_agent']:.2%}):
{responses['macro']}

Institutional Agent (ê°€ì¤‘ì¹˜: {weights['institutional_agent']:.2%}):
{responses['institutional']}

News Agent (ê°€ì¤‘ì¹˜: {weights['news_agent']:.2%}):
{responses['news']}

Chip War Agent (ê°€ì¤‘ì¹˜: {weights['chip_war_agent']:.2%}):
{responses['chip_war']}

Dividend Risk Agent (ê°€ì¤‘ì¹˜: {weights['dividend_risk_agent']:.2%}):
{responses['dividend_risk']}

---

ìœ„ ì˜ê²¬ë“¤ì„ ì¢…í•©í•˜ì—¬ ìµœì¢… ì˜ì‚¬ê²°ì •ì„ ë‚´ë ¤ì£¼ì„¸ìš”:
1. ìµœì¢… ê²°ì • (BUY/SELL/HOLD)
2. í™•ì‹ ë„ (0~100%)
3. ì˜ì‚¬ê²°ì • ê·¼ê±°
4. ëª©í‘œê°€, ì†ì ˆê°€

JSON í˜•íƒœë¡œ ë°˜í™˜í•˜ì„¸ìš”.
"""

        # PM ì˜ì‚¬ê²°ì •
        pm_response = self.model.generate_content(pm_prompt)
        pm_decision = self._parse_pm_response(pm_response.text)

        # 4. War Room ëŒ€í™” ê¸°ë¡ ì €ì¥
        self._save_war_room_conversation(
            session_id=session_id,
            symbol=symbol,
            question=question,
            responses=responses,
            pm_decision=pm_decision
        )

        # 5. Trading Signal ìƒì„±
        signal_id = self._create_trading_signal(
            symbol=symbol,
            decision=pm_decision,
            session_id=session_id
        )

        return {
            'session_id': session_id,
            'final_decision': pm_decision['action'],
            'confidence': pm_decision['confidence'],
            'reasoning': pm_decision['reasoning'],
            'target_price': pm_decision['target_price'],
            'stop_loss': pm_decision['stop_loss'],
            'agent_responses': responses,
            'signal_id': signal_id
        }

    def _get_current_weights(self) -> Dict[str, float]:
        """í˜„ì¬ ì—ì´ì „íŠ¸ ê°€ì¤‘ì¹˜ ì¡°íšŒ"""
        from backend.database.repository import get_sync_session
        from backend.database.models import AgentWeightsHistory

        with get_sync_session() as session:
            latest = session.query(AgentWeightsHistory).order_by(
                AgentWeightsHistory.changed_at.desc()
            ).first()

            if latest:
                return {
                    'trader_agent': float(latest.trader_agent),
                    'risk_agent': float(latest.risk_agent),
                    'analyst_agent': float(latest.analyst_agent),
                    'macro_agent': float(latest.macro_agent),
                    'institutional_agent': float(latest.institutional_agent),
                    'news_agent': float(latest.news_agent),
                    'chip_war_agent': float(latest.chip_war_agent),
                    'dividend_risk_agent': float(latest.dividend_risk_agent)
                }
            else:
                # ê¸°ë³¸ ê°€ì¤‘ì¹˜
                return {
                    'trader_agent': 0.15,
                    'risk_agent': 0.15,
                    'analyst_agent': 0.12,
                    'macro_agent': 0.14,
                    'institutional_agent': 0.14,
                    'news_agent': 0.14,
                    'chip_war_agent': 0.14,
                    'dividend_risk_agent': 0.02
                }
```

---

### Gemini API í†µí•©

#### Gemini Client (gemini_client.py)

```python
"""
Gemini API Client

Google Gemini 2.0 Flash API í†µí•©
"""

import os
import logging
from typing import List, Dict, Optional
import google.generativeai as genai

logger = logging.getLogger(__name__)

class GeminiClient:
    """
    Gemini API í´ë¼ì´ì–¸íŠ¸

    Features:
    - API í‚¤ ê´€ë¦¬
    - ëª¨ë¸ ì„ íƒ
    - í”„ë¡¬í”„íŠ¸ ì „ì†¡
    - ì‘ë‹µ íŒŒì‹±
    - ì—ëŸ¬ í•¸ë“¤ë§
    - ë¹„ìš© ì¶”ì 
    """

    def __init__(
        self,
        model_name: str = "gemini-2.0-flash-exp",
        temperature: float = 0.7,
        max_tokens: int = 2000
    ):
        """
        Initialize Gemini Client

        Args:
            model_name: Gemini ëª¨ë¸ëª…
            temperature: ìƒì„± ì˜¨ë„ (0.0 ~ 1.0)
            max_tokens: ìµœëŒ€ í† í° ìˆ˜
        """
        self.model_name = model_name
        self.temperature = temperature
        self.max_tokens = max_tokens

        # API í‚¤ ì„¤ì •
        api_key = os.getenv("GEMINI_API_KEY")
        if not api_key:
            raise ValueError("GEMINI_API_KEY environment variable not set")

        genai.configure(api_key=api_key)
        self.model = genai.GenerativeModel(model_name)

        logger.info(f"âœ… Gemini Client initialized: {model_name}")

    def generate(
        self,
        prompt: str,
        system_prompt: Optional[str] = None,
        temperature: Optional[float] = None,
        max_tokens: Optional[int] = None
    ) -> str:
        """
        Gemini APIë¡œ í…ìŠ¤íŠ¸ ìƒì„±

        Args:
            prompt: ì‚¬ìš©ì í”„ë¡¬í”„íŠ¸
            system_prompt: ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ (ì˜µì…˜)
            temperature: ìƒì„± ì˜¨ë„ (ì˜µì…˜)
            max_tokens: ìµœëŒ€ í† í° ìˆ˜ (ì˜µì…˜)

        Returns:
            ìƒì„±ëœ í…ìŠ¤íŠ¸
        """
        try:
            # í”„ë¡¬í”„íŠ¸ êµ¬ì„±
            messages = []
            if system_prompt:
                messages.append(system_prompt)
            messages.append(prompt)

            # Generation Config
            config = {
                "temperature": temperature or self.temperature,
                "top_p": 0.95,
                "max_output_tokens": max_tokens or self.max_tokens
            }

            # API í˜¸ì¶œ
            response = self.model.generate_content(
                messages,
                generation_config=config
            )

            # ë¹„ìš© ì¶”ì  (ì˜µì…˜)
            self._track_usage(response)

            return response.text

        except Exception as e:
            logger.error(f"âŒ Gemini API error: {e}")
            raise

    def _track_usage(self, response):
        """API ì‚¬ìš©ëŸ‰ ì¶”ì  (ë¹„ìš© ê´€ë¦¬)"""
        try:
            # Usage metadata ì¶”ì¶œ
            usage = response.usage_metadata

            # DBì— ì €ì¥
            from backend.database.repository import get_sync_session
            from backend.database.models import APIUsageLog

            with get_sync_session() as session:
                log = APIUsageLog(
                    provider="gemini",
                    model=self.model_name,
                    prompt_tokens=usage.prompt_token_count,
                    completion_tokens=usage.candidates_token_count,
                    total_tokens=usage.total_token_count,
                    estimated_cost=self._calculate_cost(usage)
                )
                session.add(log)
                session.commit()

        except Exception as e:
            logger.warning(f"âš ï¸ Usage tracking failed: {e}")

    def _calculate_cost(self, usage) -> float:
        """
        ë¹„ìš© ê³„ì‚°

        Gemini 2.0 Flash Pricing:
        - Input: $0.075 / 1M tokens
        - Output: $0.30 / 1M tokens
        """
        input_cost = (usage.prompt_token_count / 1_000_000) * 0.075
        output_cost = (usage.candidates_token_count / 1_000_000) * 0.30
        return input_cost + output_cost
```

---

## ìŠ¤ì¼€ì¤„ëŸ¬ ì‹œìŠ¤í…œ

### ìŠ¤ì¼€ì¤„ëŸ¬ ê°œìš”

ì‹œìŠ¤í…œì—ëŠ” ì—¬ëŸ¬ ìë™í™”ëœ ìŠ¤ì¼€ì¤„ëŸ¬ê°€ ì‹¤í–‰ë©ë‹ˆë‹¤:

| ìŠ¤ì¼€ì¤„ëŸ¬ | ì‹¤í–‰ ì£¼ê¸° | ì—­í•  |
|---------|----------|------|
| **NewsScheduler** | 15ë¶„ë§ˆë‹¤ | RSS ë‰´ìŠ¤ ìˆ˜ì§‘ |
| **VerificationScheduler** | ë§¤ì¼ 01:00 | ë‰´ìŠ¤ ì˜ˆì¸¡ ê²€ì¦ (1d/1w/1m) |
| **FailureLearningScheduler** | ë§¤ì¼ 00:00 | NIA ì ìˆ˜ ê³„ì‚° ë° ê°€ì¤‘ì¹˜ ì¡°ì • |
| **CorrelationScheduler** | ë§¤ì¼ 01:00 | ìì‚° ìƒê´€ê³„ìˆ˜ ê³„ì‚° |

### Failure Learning Scheduler ìƒì„¸

**íŒŒì¼**: `backend/schedulers/failure_learning_scheduler.py`

```python
"""
Failure Learning Scheduler

ë§¤ì¼ ìì •ì— ì‹¤í–‰:
1. NIA ì ìˆ˜ ê³„ì‚°
2. ì‹¤íŒ¨ ì˜ˆì¸¡ ë¶„ì„
3. War Room ê°€ì¤‘ì¹˜ ìë™ ì¡°ì •
"""

from datetime import datetime, timedelta
from typing import Dict, Optional
from sqlalchemy import and_

class FailureLearningScheduler:
    """ìë™ í•™ìŠµ ìŠ¤ì¼€ì¤„ëŸ¬"""

    def __init__(self):
        self.agent = FailureLearningAgent()
        self.scheduler_name = "FailureLearningScheduler"

    def calculate_nia_score(self, lookback_days: int = 30) -> Optional[float]:
        """
        NIA (News Interpretation Accuracy) ì ìˆ˜ ê³„ì‚°

        Process:
        1. ì§€ë‚œ Nì¼ê°„ ê²€ì¦ëœ ì˜ˆì¸¡ ì¡°íšŒ
        2. accuracy_1d í‰ê·  ê³„ì‚°
        3. NIA ì ìˆ˜ ë°˜í™˜ (0.0 ~ 1.0)

        Args:
            lookback_days: ì¡°íšŒ ê¸°ê°„

        Returns:
            NIA score or None
        """
        with get_sync_session() as session:
            cutoff_date = datetime.now() - timedelta(days=lookback_days)

            # ê²€ì¦ëœ ì˜ˆì¸¡ ì¡°íšŒ
            results = session.query(
                NewsMarketReaction.accuracy_1d
            ).filter(
                and_(
                    NewsMarketReaction.accuracy_1d.isnot(None),
                    NewsMarketReaction.verified_at_1d >= cutoff_date
                )
            ).all()

            if not results:
                return None

            # í‰ê·  ê³„ì‚°
            accuracies = [r[0] for r in results]
            nia_score = sum(accuracies) / len(accuracies)

            logger.info(f"âœ… NIA Score: {nia_score:.2%}")
            return nia_score

    def adjust_weights_based_on_nia(
        self,
        nia_score: float,
        current_weights: Dict[str, float]
    ) -> Dict[str, float]:
        """
        NIA ì ìˆ˜ ê¸°ë°˜ ê°€ì¤‘ì¹˜ ìë™ ì¡°ì •

        ê·œì¹™:
        - NIA < 60%: News Agent -2%
        - 60% <= NIA < 80%: ë³€í™” ì—†ìŒ
        - NIA >= 80%: News Agent +2%

        Args:
            nia_score: NIA ì ìˆ˜
            current_weights: í˜„ì¬ ê°€ì¤‘ì¹˜

        Returns:
            ì¡°ì •ëœ ê°€ì¤‘ì¹˜
        """
        new_weights = current_weights.copy()
        news_weight = new_weights['news_agent']

        if nia_score < 0.60:
            # ì„±ëŠ¥ ì €í•˜ - ê°€ì¤‘ì¹˜ ê°ì†Œ
            adjustment = -0.02
            reason = f"NIA below 60% ({nia_score:.1%})"
        elif nia_score >= 0.80:
            # ì„±ëŠ¥ ìš°ìˆ˜ - ê°€ì¤‘ì¹˜ ì¦ê°€
            adjustment = 0.02
            reason = f"NIA above 80% ({nia_score:.1%})"
        else:
            # ìœ ì§€
            return new_weights

        # News Agent ê°€ì¤‘ì¹˜ ì¡°ì • (0.05 ~ 0.25 ë²”ìœ„)
        new_news_weight = max(0.05, min(0.25, news_weight + adjustment))
        actual_adjustment = new_news_weight - news_weight

        if actual_adjustment == 0:
            return new_weights

        new_weights['news_agent'] = new_news_weight

        # ë‹¤ë¥¸ ì—ì´ì „íŠ¸ì— ì¬ë¶„ë°°
        other_agents = [
            'trader_agent', 'risk_agent', 'analyst_agent',
            'macro_agent', 'institutional_agent',
            'chip_war_agent', 'dividend_risk_agent'
        ]

        redistribution = -actual_adjustment / len(other_agents)
        for agent in other_agents:
            new_weights[agent] = max(0.01, new_weights[agent] + redistribution)

        # ì •ê·œí™” (í•©ê³„ = 1.0)
        total = sum(new_weights.values())
        for agent in new_weights:
            new_weights[agent] /= total

        logger.info(f"âœ… Weights adjusted: {reason}")
        return new_weights

    def run_daily_learning_cycle(self) -> Dict:
        """
        ì¼ì¼ í•™ìŠµ ì‚¬ì´í´ ì‹¤í–‰

        Returns:
            {
                'timestamp': ISO datetime,
                'success': bool,
                'nia_score': float,
                'weight_adjusted': bool,
                'failure_analysis': {...}
            }
        """
        logger.info("ğŸš€ Starting daily learning cycle")

        results = {
            'timestamp': datetime.now().isoformat(),
            'success': False,
            'nia_score': None,
            'weight_adjusted': False
        }

        try:
            # 1. NIA ì ìˆ˜ ê³„ì‚°
            nia_score = self.calculate_nia_score(lookback_days=30)
            results['nia_score'] = nia_score

            if nia_score is None:
                return results

            # 2. ì‹¤íŒ¨ ë¶„ì„
            failed_predictions = self.agent.collect_failed_predictions(
                lookback_days=7,
                accuracy_threshold=0.5
            )

            if failed_predictions:
                analysis = self.agent.analyze_failures_batch(failed_predictions)
                results['failure_analysis'] = analysis

            # 3. ê°€ì¤‘ì¹˜ ì¡°ì •
            current_weights = self._get_current_weights()
            new_weights = self.adjust_weights_based_on_nia(nia_score, current_weights)

            # ë³€í™” í™•ì¸
            weights_changed = any(
                abs(new_weights[a] - current_weights[a]) > 0.001
                for a in current_weights
            )

            if weights_changed:
                saved = self._save_weight_adjustment(
                    old_weights=current_weights,
                    new_weights=new_weights,
                    reason=f"Auto-adjusted based on NIA {nia_score:.2%}"
                )
                results['weight_adjusted'] = saved

            results['success'] = True
            logger.info("âœ… Daily learning cycle completed")

        except Exception as e:
            logger.error(f"âŒ Learning cycle failed: {e}")
            results['error'] = str(e)

        return results
```

**ì‹¤í–‰ ë°©ë²•**:

```bash
# ìˆ˜ë™ ì‹¤í–‰
python -m backend.schedulers.failure_learning_scheduler

# APSchedulerë¡œ ìë™ ì‹¤í–‰ (main.pyì—ì„œ)
from apscheduler.schedulers.background import BackgroundScheduler

scheduler = BackgroundScheduler()
scheduler.add_job(
    func=FailureLearningScheduler().run_daily_learning_cycle,
    trigger='cron',
    hour=0,
    minute=0,
    id='daily_learning',
    name='Daily Failure Learning Cycle'
)
scheduler.start()
```

---

### Correlation Scheduler ìƒì„¸

**íŒŒì¼**: `backend/schedulers/correlation_scheduler.py`

```python
"""
Correlation Scheduler

ë§¤ì¼ 01:00 ì‹¤í–‰:
1. í™œì„± ìì‚° ì¡°íšŒ
2. YFinanceì—ì„œ ê°€ê²© ë°ì´í„° ë‹¤ìš´ë¡œë“œ
3. 30d/90d/1y ìƒê´€ê³„ìˆ˜ ê³„ì‚°
4. asset_correlations í…Œì´ë¸” ì—…ë°ì´íŠ¸
"""

import yfinance as yf
import pandas as pd
import numpy as np
from datetime import datetime
from typing import List, Dict, Optional

class CorrelationScheduler:
    """ìƒê´€ê³„ìˆ˜ ìë™ ê³„ì‚° ìŠ¤ì¼€ì¤„ëŸ¬"""

    def __init__(self):
        self.scheduler_name = "CorrelationScheduler"

    def fetch_price_data(
        self,
        symbols: List[str],
        period: str = "1y"
    ) -> pd.DataFrame:
        """
        YFinanceì—ì„œ ê°€ê²© ë°ì´í„° ë‹¤ìš´ë¡œë“œ

        Args:
            symbols: ìì‚° ì‹¬ë³¼ ë¦¬ìŠ¤íŠ¸
            period: ê¸°ê°„ ('30d', '90d', '1y')

        Returns:
            DataFrame (columns: symbols, index: dates)
        """
        logger.info(f"ğŸ“¥ Downloading price data for {len(symbols)} assets")

        # YFinance ë‹¤ìš´ë¡œë“œ
        raw_data = yf.download(
            symbols,
            period=period,
            progress=False,
            group_by='ticker'
        )

        # MultiIndex ì²˜ë¦¬
        if len(symbols) == 1:
            # ë‹¨ì¼ ì‹¬ë³¼
            prices = raw_data['Close'].to_frame(name=symbols[0])
        else:
            # ë³µìˆ˜ ì‹¬ë³¼
            prices = pd.DataFrame()
            for symbol in symbols:
                if (symbol, 'Close') in raw_data.columns:
                    prices[symbol] = raw_data[(symbol, 'Close')]

        # NaN ì œê±°
        prices = prices.dropna()

        logger.info(f"âœ… Downloaded {len(prices)} days of data")
        return prices

    def calculate_correlation(
        self,
        prices: pd.DataFrame,
        symbol1: str,
        symbol2: str
    ) -> Optional[float]:
        """
        ë‘ ìì‚° ê°„ ìƒê´€ê³„ìˆ˜ ê³„ì‚°

        Process:
        1. ìˆ˜ìµë¥  ê³„ì‚° (pct_change)
        2. ë°ì´í„° ì •ë ¬
        3. Pearson ìƒê´€ê³„ìˆ˜ ê³„ì‚°

        Args:
            prices: ê°€ê²© DataFrame
            symbol1: ì²« ë²ˆì§¸ ìì‚°
            symbol2: ë‘ ë²ˆì§¸ ìì‚°

        Returns:
            ìƒê´€ê³„ìˆ˜ (-1.0 ~ 1.0) or None
        """
        try:
            # ìˆ˜ìµë¥  ê³„ì‚°
            returns1 = prices[symbol1].pct_change().dropna()
            returns2 = prices[symbol2].pct_change().dropna()

            # ë°ì´í„° ì •ë ¬
            aligned = pd.concat([returns1, returns2], axis=1).dropna()

            # ìµœì†Œ ë°ì´í„° í¬ì¸íŠ¸ í™•ì¸
            if len(aligned) < 10:
                return None

            # Pearson ìƒê´€ê³„ìˆ˜
            corr = aligned.iloc[:, 0].corr(aligned.iloc[:, 1])

            return float(corr) if not np.isnan(corr) else None

        except Exception as e:
            logger.warning(f"âš ï¸ Correlation calc failed for {symbol1}-{symbol2}: {e}")
            return None

    def calculate_all_correlations(self) -> Dict:
        """
        ëª¨ë“  ìì‚° í˜ì–´ì˜ ìƒê´€ê³„ìˆ˜ ê³„ì‚°

        Returns:
            {
                'timestamp': ISO datetime,
                'success': bool,
                'assets_count': int,
                'pairs_calculated': int,
                'records_saved': int
            }
        """
        logger.info("ğŸš€ Starting correlation calculation")
        start_time = datetime.now()

        results = {
            'timestamp': start_time.isoformat(),
            'success': False,
            'assets_count': 0,
            'pairs_calculated': 0,
            'records_saved': 0
        }

        try:
            # 1. í™œì„± ìì‚° ì¡°íšŒ
            symbols = self._get_active_symbols()
            results['assets_count'] = len(symbols)

            if len(symbols) < 2:
                logger.warning("âš ï¸ Need at least 2 assets")
                return results

            # 2. ê°€ê²© ë°ì´í„° ë‹¤ìš´ë¡œë“œ
            prices_30d = self.fetch_price_data(symbols, period='30d')
            prices_90d = self.fetch_price_data(symbols, period='90d')
            prices_1y = self.fetch_price_data(symbols, period='1y')

            # 3. ëª¨ë“  í˜ì–´ ê³„ì‚°
            pairs_calculated = 0
            records_saved = 0

            for i, symbol1 in enumerate(symbols):
                for symbol2 in symbols[i+1:]:
                    # ìƒê´€ê³„ìˆ˜ ê³„ì‚°
                    corr_30d = self.calculate_correlation(prices_30d, symbol1, symbol2)
                    corr_90d = self.calculate_correlation(prices_90d, symbol1, symbol2)
                    corr_1y = self.calculate_correlation(prices_1y, symbol1, symbol2)

                    pairs_calculated += 1

                    # DB ì €ì¥ (Upsert)
                    if any([corr_30d, corr_90d, corr_1y]):
                        saved = self._save_correlation(
                            symbol1=symbol1,
                            symbol2=symbol2,
                            corr_30d=corr_30d,
                            corr_90d=corr_90d,
                            corr_1y=corr_1y
                        )
                        if saved:
                            records_saved += 1

            results['pairs_calculated'] = pairs_calculated
            results['records_saved'] = records_saved
            results['success'] = True

            duration = (datetime.now() - start_time).total_seconds()
            logger.info(f"âœ… Correlation calculation completed in {duration:.1f}s")

        except Exception as e:
            logger.error(f"âŒ Correlation calculation failed: {e}")
            results['error'] = str(e)

        return results

    def _get_active_symbols(self) -> List[str]:
        """í™œì„± ìì‚° ì‹¬ë³¼ ì¡°íšŒ"""
        with get_sync_session() as session:
            from backend.database.models import MultiAssetConfig

            assets = session.query(MultiAssetConfig).filter(
                MultiAssetConfig.is_active == True
            ).all()

            return [asset.symbol for asset in assets]

    def _save_correlation(
        self,
        symbol1: str,
        symbol2: str,
        corr_30d: Optional[float],
        corr_90d: Optional[float],
        corr_1y: Optional[float]
    ) -> bool:
        """ìƒê´€ê³„ìˆ˜ ì €ì¥ (Upsert)"""
        try:
            with get_sync_session() as session:
                from backend.database.models import AssetCorrelation

                # Upsert (PostgreSQL)
                stmt = insert(AssetCorrelation).values(
                    symbol1=symbol1,
                    symbol2=symbol2,
                    correlation_30d=corr_30d,
                    correlation_90d=corr_90d,
                    correlation_1y=corr_1y,
                    calculated_at=datetime.now()
                ).on_conflict_do_update(
                    index_elements=['symbol1', 'symbol2'],
                    set_={
                        'correlation_30d': corr_30d,
                        'correlation_90d': corr_90d,
                        'correlation_1y': corr_1y,
                        'calculated_at': datetime.now()
                    }
                )

                session.execute(stmt)
                session.commit()
                return True

        except Exception as e:
            logger.error(f"âŒ Failed to save correlation: {e}")
            return False
```

---

## í”„ë¡ íŠ¸ì—”ë“œ ì•„í‚¤í…ì²˜

### ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.tsx                 # ì§„ì…ì 
â”‚   â”œâ”€â”€ App.tsx                  # ë¼ìš°íŒ… ì„¤ì •
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ Dashboard.tsx        # ë©”ì¸ ëŒ€ì‹œë³´ë“œ
â”‚   â”‚   â”œâ”€â”€ WarRoomPage.tsx      # War Room
â”‚   â”‚   â”œâ”€â”€ TradingDashboard.tsx # íŠ¸ë ˆì´ë”© ì‹œê·¸ë„
â”‚   â”‚   â”œâ”€â”€ Portfolio.tsx        # í¬íŠ¸í´ë¦¬ì˜¤
â”‚   â”‚   â”œâ”€â”€ MultiAssetDashboard.tsx # ë©€í‹° ìì‚° (ê°œë°œì¤‘)
â”‚   â”‚   â”œâ”€â”€ PortfolioOptimizationPage.tsx # í¬íŠ¸í´ë¦¬ì˜¤ ìµœì í™” (ê°œë°œì¤‘)
â”‚   â”‚   â”œâ”€â”€ CorrelationDashboard.tsx # ìì‚° ìƒê´€ê³„ìˆ˜ (ê°œë°œì¤‘)
â”‚   â”‚   â”œâ”€â”€ FailureLearningDashboard.tsx # ìë™ í•™ìŠµ
â”‚   â”‚   â”œâ”€â”€ AccountabilityDashboard.tsx # ì±…ì„ ì¶”ì 
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ Layout/
â”‚   â”‚   â”‚   â”œâ”€â”€ Layout.tsx       # ë ˆì´ì•„ì›ƒ ì»¨í…Œì´ë„ˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx      # ì‚¬ì´ë“œë°”
â”‚   â”‚   â”‚   â””â”€â”€ Header.tsx       # í—¤ë”
â”‚   â”‚   â”œâ”€â”€ common/
â”‚   â”‚   â”‚   â”œâ”€â”€ Card.tsx         # ì¹´ë“œ ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ Button.tsx       # ë²„íŠ¼ ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ Badge.tsx        # ë°°ì§€ ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ Charts/
â”‚   â”‚   â”‚   â”œâ”€â”€ LineChart.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ BarChart.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â””â”€â”€ News/
â”‚   â”‚       â”œâ”€â”€ NewsCard.tsx
â”‚   â”‚       â””â”€â”€ ...
â”‚   â”œâ”€â”€ contexts/
â”‚   â”‚   â””â”€â”€ AnalysisContext.tsx  # ì „ì—­ ìƒíƒœ ê´€ë¦¬
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â””â”€â”€ useQuery.ts          # React Query í›…
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ api.ts               # API í´ë¼ì´ì–¸íŠ¸
â”‚       â””â”€â”€ formatters.ts        # í¬ë§·íŒ… ìœ í‹¸
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ vite.config.ts
```

### ë¼ìš°íŒ… êµ¬ì¡° (App.tsx)

```typescript
import React from 'react';
import { BrowserRouter as Router, Routes, Route, Navigate } from 'react-router-dom';
import { Layout } from './components/Layout/Layout';

const App: React.FC = () => {
  return (
    <Router>
      <Layout>
        <Routes>
          {/* Overview */}
          <Route path="/" element={<Navigate to="/dashboard" replace />} />
          <Route path="/dashboard" element={<Dashboard />} />
          <Route path="/portfolio" element={<Portfolio />} />
          <Route path="/dividend" element={<DividendDashboard />} />

          {/* Trading & Strategy */}
          <Route path="/war-room" element={<WarRoomPage />} />
          <Route path="/trading" element={<TradingDashboard />} />
          <Route path="/backtest" element={<BacktestDashboard />} />
          <Route path="/deep-reasoning" element={<DeepReasoning />} />

          {/* Analysis */}
          <Route path="/global-macro" element={<GlobalMacro />} />
          <Route path="/ceo-analysis" element={<CEOAnalysis />} />
          <Route path="/analysis" element={<Analysis />} />

          {/* Data & News */}
          <Route path="/data-backfill" element={<DataBackfill />} />
          <Route path="/news" element={<NewsAggregation />} />
          <Route path="/rss-management" element={<RssFeedManagement />} />

          {/* System & Operations */}
          <Route path="/monitor" element={<Monitor />} />
          <Route path="/accountability" element={<AccountabilityDashboard />} />
          <Route path="/learning" element={<FailureLearningDashboard />} />
          <Route path="/logs" element={<Logs />} />
          <Route path="/settings" element={<Settings />} />

          {/* Under Development */}
          <Route path="/signal-consolidation" element={<SignalConsolidationPage />} />
          <Route path="/multi-asset" element={<MultiAssetDashboard />} />
          <Route path="/portfolio-optimization" element={<PortfolioOptimizationPage />} />
          <Route path="/correlation" element={<CorrelationDashboard />} />
        </Routes>
      </Layout>
    </Router>
  );
};

export default App;
```

### ì‚¬ì´ë“œë°” êµ¬ì¡° (Sidebar.tsx)

```typescript
const navCategories: NavCategory[] = [
  {
    title: 'Overview',
    items: [
      { path: '/dashboard', icon: LayoutDashboard, label: 'Dashboard' },
      { path: '/portfolio', icon: PieChart, label: 'Portfolio' },
      { path: '/dividend', icon: DollarSign, label: 'Dividend Intelligence' },
    ]
  },
  {
    title: 'Trading & Strategy',
    items: [
      { path: '/war-room', icon: MessageSquare, label: 'AI War Room' },
      { path: '/trading', icon: Zap, label: 'Trading Signals' },
      { path: '/backtest', icon: TestTube2, label: 'Backtest' },
      { path: '/deep-reasoning', icon: Brain, label: 'Deep Reasoning' },
    ]
  },
  {
    title: 'Analysis',
    items: [
      { path: '/global-macro', icon: Globe, label: 'Global Macro' },
      { path: '/ceo-analysis', icon: MessageSquare, label: 'CEO Analysis' },
      { path: '/analysis', icon: TrendingUp, label: 'Analysis' },
      { path: '/cost-report', icon: DollarSign, label: 'Emergency Cost' },
      { path: '/advanced-analytics', icon: LineChart, label: 'Advanced Analytics' },
      { path: '/ai-review', icon: FileText, label: 'AI Review' },
    ]
  },
  {
    title: 'Data & News',
    items: [
      { path: '/data-backfill', icon: Database, label: 'Data Backfill' },
      { path: '/news', icon: Newspaper, label: 'News' },
      { path: '/rss-management', icon: Rss, label: 'RSS Management' },
    ]
  },
  {
    title: 'System & Operations',
    items: [
      { path: '/monitor', icon: Activity, label: 'Monitor' },
      { path: '/accountability', icon: Target, label: 'Accountability' },
      { path: '/learning', icon: GraduationCap, label: 'Auto-Learning' },
      { path: '/reports', icon: BarChart3, label: 'Reports' },
      { path: '/incremental', icon: TrendingDown, label: 'Cost Savings' },
      { path: '/logs', icon: FileSearch, label: 'Logs' },
      { path: '/settings', icon: Settings, label: 'Settings' },
    ]
  },
  {
    title: 'Under Development',
    items: [
      { path: '/signal-consolidation', icon: BarChart3, label: 'Signal Consolidation' },
      { path: '/multi-asset', icon: Coins, label: 'Multi-Asset' },
      { path: '/portfolio-optimization', icon: Target, label: 'Portfolio Optimization' },
      { path: '/correlation', icon: Network, label: 'Asset Correlation' },
    ]
  }
];
```

### React Query ì‚¬ìš© ì˜ˆì‹œ

```typescript
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';

// GET ìš”ì²­ (ìë™ refetch)
const { data, isLoading, error } = useQuery({
  queryKey: ['correlation-status'],
  queryFn: async () => {
    const response = await fetch('/api/correlation/status');
    return response.json();
  },
  refetchInterval: 60000  // 1ë¶„ë§ˆë‹¤ ìë™ ê°±ì‹ 
});

// POST ìš”ì²­ (Mutation)
const queryClient = useQueryClient();

const mutation = useMutation({
  mutationFn: async () => {
    const response = await fetch('/api/correlation/calculate', {
      method: 'POST'
    });
    return response.json();
  },
  onSuccess: () => {
    // ì„±ê³µ ì‹œ ê´€ë ¨ ì¿¼ë¦¬ ë¬´íš¨í™” (ìë™ refetch)
    queryClient.invalidateQueries({ queryKey: ['correlation-status'] });
    queryClient.invalidateQueries({ queryKey: ['correlation-pairs'] });
  }
});

// UIì—ì„œ ì‚¬ìš©
<button onClick={() => mutation.mutate()}>
  Calculate Correlations
</button>
```

---

## ë°ì´í„° íë¦„

### War Room ì˜ì‚¬ê²°ì • í”„ë¡œì„¸ìŠ¤

```
[ì‚¬ìš©ì] â†’ [War Room UI] â†’ [POST /api/war-room/decide]
                                      â†“
                            [PM Agent í˜¸ì¶œ]
                                      â†“
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚              ê° ì—ì´ì „íŠ¸ ë³‘ë ¬ ì‹¤í–‰                    â”‚
           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¤
           â–¼        â–¼        â–¼        â–¼        â–¼        â–¼        â–¼
        Trader   Risk   Analyst  Macro  Instit  News   Chip   Dividend
        Agent    Agent   Agent   Agent  Agent   Agent  Agent   Agent
           â”‚        â”‚        â”‚        â”‚        â”‚        â”‚        â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â†“
                            [ê°€ì¤‘ì¹˜ ì ìš© ì¢…í•©]
                                      â†“
                          [PM ìµœì¢… ì˜ì‚¬ê²°ì •]
                                      â†“
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â–¼                                       â–¼
       [Trading Signal ìƒì„±]              [War Room ëŒ€í™” ì €ì¥]
                â†“                                       â†“
         [trading_signals]                [war_room_conversations]
                â†“
         [Response to UI]
```

### ë‰´ìŠ¤ ë¶„ì„ â†’ ì˜ˆì¸¡ â†’ ê²€ì¦ â†’ í•™ìŠµ ì‚¬ì´í´

```
[RSS í”¼ë“œ] â†’ [NewsScheduler (15ë¶„)] â†’ [news_articles]
                                              â†“
                                    [News Agent í•´ì„]
                                              â†“
                                  [news_interpretations]
                                              â†“
                              [ì‹œì¥ ë°˜ì‘ ì˜ˆì¸¡ ì €ì¥]
                                              â†“
                                [news_market_reactions]
                                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                         â–¼                         â–¼
          [+1ì¼ í›„ ê²€ì¦]              [+1ì£¼ í›„ ê²€ì¦]              [+1ê°œì›” í›„ ê²€ì¦]
       (VerificationScheduler)    (VerificationScheduler)    (VerificationScheduler)
                    â”‚                         â”‚                         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â†“
                                    [accuracy_1d/1w/1m ì—…ë°ì´íŠ¸]
                                              â†“
                              [FailureLearningScheduler (ë§¤ì¼ 00:00)]
                                              â†“
                                    [NIA ì ìˆ˜ ê³„ì‚°]
                                              â†“
                                  [ì‹¤íŒ¨ ì˜ˆì¸¡ ë¶„ì„]
                                              â†“
                                 [ê°€ì¤‘ì¹˜ ìë™ ì¡°ì •]
                                              â†“
                             [agent_weights_history ì €ì¥]
                                              â†“
                                [ë‹¤ìŒ War Roomì— ë°˜ì˜]
```

---

## API ì—”ë“œí¬ì¸íŠ¸

### ì „ì²´ API ëª©ë¡

#### Trading APIs (`/api/trading`)

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/api/trading/signals` | íŠ¸ë ˆì´ë”© ì‹œê·¸ë„ ëª©ë¡ |
| GET | `/api/trading/signals/{id}` | ì‹œê·¸ë„ ìƒì„¸ |
| POST | `/api/trading/signals` | ì‹œê·¸ë„ ìƒì„± (ìˆ˜ë™) |
| PUT | `/api/trading/signals/{id}/execute` | ì‹œê·¸ë„ ì‹¤í–‰ |
| DELETE | `/api/trading/signals/{id}` | ì‹œê·¸ë„ ì·¨ì†Œ |

#### War Room APIs (`/api/war-room`)

| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/api/war-room/decide` | War Room ì˜ì‚¬ê²°ì • ì‹¤í–‰ |
| GET | `/api/war-room/conversations` | ëŒ€í™” ê¸°ë¡ ì¡°íšŒ |
| GET | `/api/war-room/conversations/{id}` | íŠ¹ì • ëŒ€í™” ìƒì„¸ |
| GET | `/api/war-room/weights` | í˜„ì¬ ì—ì´ì „íŠ¸ ê°€ì¤‘ì¹˜ |

#### News APIs (`/api/news`)

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/api/news/articles` | ë‰´ìŠ¤ ê¸°ì‚¬ ëª©ë¡ |
| GET | `/api/news/articles/{id}` | ê¸°ì‚¬ ìƒì„¸ |
| GET | `/api/news/interpretations` | ë‰´ìŠ¤ í•´ì„ ëª©ë¡ |
| POST | `/api/news/analyze` | ë‰´ìŠ¤ ë¶„ì„ (ìˆ˜ë™) |
| GET | `/api/news/nia-score` | NIA ì ìˆ˜ ì¡°íšŒ |

#### Portfolio APIs (`/api/portfolio`)

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/api/portfolio/summary` | í¬íŠ¸í´ë¦¬ì˜¤ ìš”ì•½ |
| GET | `/api/portfolio/positions` | í˜„ì¬ í¬ì§€ì…˜ |
| GET | `/api/portfolio/history` | íˆìŠ¤í† ë¦¬ |
| POST | `/api/portfolio/optimize` | í¬íŠ¸í´ë¦¬ì˜¤ ìµœì í™” |

#### Correlation APIs (`/api/correlation`)

| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/api/correlation/calculate` | ìƒê´€ê³„ìˆ˜ ê³„ì‚° (ìˆ˜ë™) |
| GET | `/api/correlation/status` | ê³„ì‚° ìƒíƒœ |
| GET | `/api/correlation/heatmap` | íˆíŠ¸ë§µ ë°ì´í„° |
| GET | `/api/correlation/pairs` | Top ìƒê´€ í˜ì–´ |

#### Learning APIs (`/api/learning`)

| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/api/learning/run` | í•™ìŠµ ì‚¬ì´í´ ì‹¤í–‰ (ìˆ˜ë™) |
| GET | `/api/learning/nia` | NIA ì ìˆ˜ ì¡°íšŒ |
| GET | `/api/learning/history` | ê°€ì¤‘ì¹˜ íˆìŠ¤í† ë¦¬ |
| GET | `/api/learning/recommendations` | ê°€ì¤‘ì¹˜ ì¡°ì • ì œì•ˆ |
| GET | `/api/learning/current-weights` | í˜„ì¬ ê°€ì¤‘ì¹˜ |

#### Accountability APIs (`/api/accountability`)

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/api/accountability/decisions` | ì˜ì‚¬ê²°ì • ë¡œê·¸ |
| GET | `/api/accountability/failures` | ì‹¤íŒ¨ ë¶„ì„ |
| GET | `/api/accountability/performance` | ì—ì´ì „íŠ¸ ì„±ëŠ¥ |

---

## ë³´ì•ˆ ë° ì¸ì¦

### í™˜ê²½ ë³€ìˆ˜ ê´€ë¦¬

**íŒŒì¼**: `.env`

```bash
# Database
DATABASE_URL=postgresql://user:password@localhost:5432/ai_trading

# Gemini API
GEMINI_API_KEY=your_gemini_api_key_here

# Application
SECRET_KEY=your_secret_key_here
DEBUG=false

# CORS
CORS_ORIGINS=http://localhost:3002,http://localhost:3000

# Trading (Paper Trading)
ALPACA_API_KEY=your_alpaca_key
ALPACA_SECRET_KEY=your_alpaca_secret
ALPACA_BASE_URL=https://paper-api.alpaca.markets
```

### API ì¸ì¦ (Future)

í˜„ì¬ëŠ” ì¸ì¦ ì—†ì´ ë¡œì»¬ì—ì„œë§Œ ì‹¤í–‰ë˜ì§€ë§Œ, í–¥í›„ ì¶”ê°€ ì˜ˆì •:

```python
from fastapi.security import HTTPBearer, HTTPAuthorizationCredentials

security = HTTPBearer()

@router.get("/protected")
async def protected_route(
    credentials: HTTPAuthorizationCredentials = Depends(security)
):
    token = credentials.credentials
    # JWT ê²€ì¦
    user = verify_jwt_token(token)
    return {"user": user}
```

---

## ë°°í¬ ë° ìš´ì˜

### Docker Compose êµ¬ì„±

**íŒŒì¼**: `docker-compose.yml`

```yaml
version: '3.8'

services:
  # PostgreSQL Database
  postgres:
    image: postgres:14
    container_name: ai-trading-db
    environment:
      POSTGRES_USER: ai_trading
      POSTGRES_PASSWORD: secure_password
      POSTGRES_DB: ai_trading
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    networks:
      - ai-trading-network

  # Backend (FastAPI)
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: ai-trading-backend
    environment:
      DATABASE_URL: postgresql://ai_trading:secure_password@postgres:5432/ai_trading
      GEMINI_API_KEY: ${GEMINI_API_KEY}
    ports:
      - "8000:8000"
    depends_on:
      - postgres
    networks:
      - ai-trading-network
    command: uvicorn backend.main:app --host 0.0.0.0 --port 8000

  # Frontend (React + Vite)
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: ai-trading-frontend
    ports:
      - "3002:3002"
    depends_on:
      - backend
    networks:
      - ai-trading-network

  # Nginx (Reverse Proxy)
  nginx:
    image: nginx:alpine
    container_name: ai-trading-nginx
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf
      - ./nginx/ssl:/etc/nginx/ssl
    depends_on:
      - backend
      - frontend
    networks:
      - ai-trading-network

volumes:
  postgres_data:

networks:
  ai-trading-network:
    driver: bridge
```

### ì‹¤í–‰ ë°©ë²•

```bash
# ê°œë°œ í™˜ê²½
cd backend && uvicorn backend.main:app --reload --host 0.0.0.0 --port 8000
cd frontend && npm run dev

# Docker Compose
docker-compose up -d

# ë¡œê·¸ í™•ì¸
docker-compose logs -f backend

# ì¤‘ì§€
docker-compose down
```

---

## ì£¼ìš” í”„ë¡œì„¸ìŠ¤ ì •ë¦¬

### 1. ì‹œìŠ¤í…œ ì´ˆê¸°í™”

```
1. PostgreSQL ë°ì´í„°ë² ì´ìŠ¤ ì‹œì‘
2. FastAPI ë°±ì—”ë“œ ì‹œì‘
   - DB ì—°ê²° í™•ì¸
   - ë¼ìš°í„° ë“±ë¡
   - ìŠ¤ì¼€ì¤„ëŸ¬ ì‹œì‘
3. React í”„ë¡ íŠ¸ì—”ë“œ ì‹œì‘
4. ì‚¬ìš©ì ì ‘ì† (http://localhost:3002)
```

### 2. War Room ì˜ì‚¬ê²°ì •

```
1. ì‚¬ìš©ìê°€ ì¢…ëª© ì„ íƒ (ì˜ˆ: AAPL)
2. PM Agentì—ê²Œ ì§ˆë¬¸ ("AAPL ë§¤ìˆ˜ ì˜ê²¬ì€?")
3. PMì´ 8ê°œ ì—ì´ì „íŠ¸ì—ê²Œ ì§ˆë¬¸ ë°°í¬
4. ê° ì—ì´ì „íŠ¸ê°€ Gemini APIë¡œ ë¶„ì„
5. PMì´ ê°€ì¤‘ì¹˜ ê¸°ë°˜ìœ¼ë¡œ ì¢…í•© íŒë‹¨
6. Trading Signal ìƒì„±
7. War Room ëŒ€í™” ì €ì¥
8. ì‚¬ìš©ìì—ê²Œ ê²°ê³¼ í‘œì‹œ
```

### 3. ë‰´ìŠ¤ ë¶„ì„ ë° í•™ìŠµ

```
1. NewsSchedulerê°€ 15ë¶„ë§ˆë‹¤ RSS ìˆ˜ì§‘
2. News Agentê°€ ë‰´ìŠ¤ í•´ì„
3. ì‹œì¥ ë°˜ì‘ ì˜ˆì¸¡ ì €ì¥
4. 1ì¼/1ì£¼/1ê°œì›” í›„ ê²€ì¦
5. NIA ì ìˆ˜ ê³„ì‚°
6. ë‚®ì€ ì •í™•ë„ ì˜ˆì¸¡ ë¶„ì„
7. ê°€ì¤‘ì¹˜ ìë™ ì¡°ì •
8. ë‹¤ìŒ War Roomì— ë°˜ì˜
```

### 4. í¬íŠ¸í´ë¦¬ì˜¤ ìµœì í™”

```
1. ì‚¬ìš©ìê°€ ìµœì í™” ëª©í‘œ ì„ íƒ (Max Sharpe)
2. í™œì„± ìì‚° ì¡°íšŒ
3. ê°€ê²© ë°ì´í„° ë‹¤ìš´ë¡œë“œ (YFinance)
4. ìƒê´€ê³„ìˆ˜ ì¡°íšŒ
5. scipy.optimizeë¡œ ìµœì  ê°€ì¤‘ì¹˜ ê³„ì‚°
6. ê²°ê³¼ ì €ì¥ ë° í‘œì‹œ
7. ë°±í…ŒìŠ¤íŠ¸ ì‹¤í–‰ (ì˜µì…˜)
```

### 5. ìƒê´€ê³„ìˆ˜ ê³„ì‚°

```
1. CorrelationScheduler ë§¤ì¼ 01:00 ì‹¤í–‰
2. í™œì„± ìì‚° ì¡°íšŒ (multi_asset_config)
3. YFinanceì—ì„œ 30d/90d/1y ê°€ê²© ë‹¤ìš´ë¡œë“œ
4. ëª¨ë“  í˜ì–´ ì¡°í•© (N*(N-1)/2)
5. Pearson ìƒê´€ê³„ìˆ˜ ê³„ì‚°
6. asset_correlations í…Œì´ë¸” upsert
7. Correlation Dashboardì— í‘œì‹œ
```

---

## ì„±ëŠ¥ ìµœì í™”

### ë°ì´í„°ë² ì´ìŠ¤ ìµœì í™”

```sql
-- ì¸ë±ìŠ¤ ì¶”ê°€
CREATE INDEX idx_signals_symbol_created ON trading_signals(symbol, created_at DESC);
CREATE INDEX idx_news_symbol_created ON news_interpretations(symbol, created_at DESC);
CREATE INDEX idx_correlation_symbols ON asset_correlations(symbol1, symbol2);

-- íŒŒí‹°ì…”ë‹ (ëŒ€ìš©ëŸ‰ ë°ì´í„°)
CREATE TABLE trading_signals_2025 PARTITION OF trading_signals
FOR VALUES FROM ('2025-01-01') TO ('2026-01-01');
```

### API ìºì‹±

```python
from fastapi_cache import FastAPICache
from fastapi_cache.backends.redis import RedisBackend

# Redis ìºì‹±
@router.get("/status")
@cache(expire=60)  # 60ì´ˆ ìºì‹œ
async def get_status():
    # ë¬´ê±°ìš´ ê³„ì‚°
    pass
```

### React Query ìµœì í™”

```typescript
// Stale time ì„¤ì •
const { data } = useQuery({
  queryKey: ['heavy-data'],
  queryFn: fetchHeavyData,
  staleTime: 5 * 60 * 1000,  // 5ë¶„ê°„ fresh
  cacheTime: 10 * 60 * 1000  // 10ë¶„ê°„ ìºì‹œ ìœ ì§€
});
```

---

## ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…

### ë¡œê¹… ì„¤ì •

```python
import logging

logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('logs/app.log'),
        logging.StreamHandler()
    ]
)

logger = logging.getLogger(__name__)

logger.info("âœ… Server started")
logger.warning("âš ï¸ High API usage detected")
logger.error("âŒ Database connection failed")
```

### í—¬ìŠ¤ ì²´í¬

```python
@app.get("/health")
async def health_check():
    """ì‹œìŠ¤í…œ í—¬ìŠ¤ ì²´í¬"""
    try:
        # DB ì—°ê²° í™•ì¸
        with get_sync_session() as session:
            session.execute("SELECT 1")

        # Gemini API í™•ì¸
        genai.configure(api_key=os.getenv("GEMINI_API_KEY"))

        return {
            "status": "healthy",
            "database": "connected",
            "gemini_api": "available",
            "timestamp": datetime.now().isoformat()
        }
    except Exception as e:
        return {
            "status": "unhealthy",
            "error": str(e)
        }
```

---

## ê²°ë¡ 

ì´ ë¬¸ì„œëŠ” AI Trading Systemì˜ ì „ì²´ ì•„í‚¤í…ì²˜ë¥¼ ë‹¤ë£¹ë‹ˆë‹¤:

âœ… **ë°ì´í„°ë² ì´ìŠ¤**: PostgreSQL í…Œì´ë¸” êµ¬ì¡° ë° ê´€ê³„
âœ… **ë°±ì—”ë“œ**: FastAPI ë¼ìš°í„°, AI ì—ì´ì „íŠ¸, ìŠ¤ì¼€ì¤„ëŸ¬
âœ… **í”„ë¡ íŠ¸ì—”ë“œ**: React ì»´í¬ë„ŒíŠ¸, ë¼ìš°íŒ…, ìƒíƒœ ê´€ë¦¬
âœ… **ë°ì´í„° íë¦„**: War Room, ë‰´ìŠ¤ ë¶„ì„, í•™ìŠµ ì‚¬ì´í´
âœ… **API**: ì „ì²´ ì—”ë“œí¬ì¸íŠ¸ ëª©ë¡
âœ… **ë°°í¬**: Docker Compose êµ¬ì„±

**ë‹¤ìŒ ë‹¨ê³„**:
- ì‹¤ì „ íŠ¸ë ˆì´ë”© ì—°ë™ (Alpaca API)
- ë°±í…ŒìŠ¤íŠ¸ ì—”ì§„ ê³ ë„í™”
- ë¦¬ìŠ¤í¬ ê´€ë¦¬ ìë™í™”
- ì•Œë¦¼ ì‹œìŠ¤í…œ êµ¬ì¶•
