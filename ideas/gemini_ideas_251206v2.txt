GEMINIì˜ ë‹µë³€

ë‹¤ë¥¸ ì‚¬ëŒì´ ë§Œë“  ì£¼ì‹ ê±°ë˜ ì•„ì´ë””ì–´ íŒŒì¼(`another_stock_project_blueprint.md`, `another_stock_README.md`)ì„ ì‚¬ìš©ìë‹˜ì˜ í˜„ì¬ í”„ë¡œì íŠ¸(`MASTER_GUIDE.md` ê¸°ë°˜)ì™€ ë¹„êµí•˜ì—¬, **í†µí•©í•˜ë©´ ì‹œë„ˆì§€ê°€ ë‚  ë§Œí•œ í•µì‹¬ ì•„ì´ë””ì–´ 3ê°€ì§€**ë¥¼ ì œì•ˆí•´ ë“œë¦½ë‹ˆë‹¤.

ì´ í”„ë¡œì íŠ¸(`StockAI`)ëŠ” **"í•œêµ­ ì£¼ì‹(KOSPI/KOSDAQ)"**ê³¼ **"íŒŒë™ ì´ë¡ (Wave Theory)"**ì— íŠ¹í™”ë˜ì–´ ìˆì–´, ì‚¬ìš©ìë‹˜ ì‹œìŠ¤í…œì˜ **ê¸°ìˆ ì  ë¶„ì„**ê³¼ **í•œêµ­ ì‹œì¥ ì»¤ë²„ë¦¬ì§€**ë¥¼ ë³´ì™„í•˜ëŠ” ë° ë§¤ìš° ìœ ìš©í•©ë‹ˆë‹¤.

---

### 1. ğŸŒŠ **"íŒŒë™ ì „í™˜ ì•Œê³ ë¦¬ì¦˜ (Wave Transition Algorithm)"**
* **ê¸°ì¡´ ì‹œìŠ¤í…œ:** `MA`, `RSI`, `MACD` ë“± ì¼ë°˜ì ì¸ ì§€í‘œë§Œ ì‚¬ìš©.
* **ìƒˆ ì•„ì´ë””ì–´:** ì£¼ê°€ íë¦„ì„ **4ë‹¨ê³„ íŒŒë™(ë°”ë‹¥ â†’ ìƒìŠ¹ ì „í™˜ â†’ ìƒìŠ¹ ê°€ì† â†’ ê³ ì )**ìœ¼ë¡œ ë¶„ë¥˜í•˜ì—¬ **"ìƒìŠ¹ ì „í™˜ ë³€ê³¡ì "**ì„ í¬ì°©í•˜ëŠ” ë¡œì§ì…ë‹ˆë‹¤.
* **ì ìš© ë°©ì•ˆ:**
    * `Analysis Engine`ì— **`WaveAnalyzer` ëª¨ë“ˆ**ì„ ì¶”ê°€í•©ë‹ˆë‹¤.
    * **ë¡œì§:** "ì´ë™í‰ê· ì„  ìˆ˜ë ´(20ì¼/50ì¼) + 52ì£¼ ì‹ ì €ê°€ íƒˆì¶œ + ê±°ë˜ëŸ‰ ê¸‰ì¦" ì¡°ê±´ì„ ë§Œì¡±í•˜ë©´ `Wave Score`ë¥¼ ë¶€ì—¬í•©ë‹ˆë‹¤.
    * **íš¨ê³¼:** ë‹¨ìˆœíˆ "ì˜¤ë¥´ëŠ” ì£¼ì‹"ì´ ì•„ë‹ˆë¼ **"ì´ì œ ë§‰ ì˜¤ë¥´ê¸° ì‹œì‘í•˜ëŠ”(Turnaround) ì£¼ì‹"**ì„ ì°¾ì•„ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 2. ğŸ¬ **"ìˆ˜ê¸‰ ë¶„ì„ (Supply/Demand Analysis)"**
* **ê¸°ì¡´ ì‹œìŠ¤í…œ:** ê±°ë˜ëŸ‰(Volume) ì •ë„ë§Œ í™•ì¸.
* **ìƒˆ ì•„ì´ë””ì–´:** **"ê¸°ê´€/ì™¸êµ­ì¸ ë§¤ì§‘ ë™í–¥"**ì„ ì ìˆ˜í™”í•˜ì—¬ `Institutional Trend Score`ë¥¼ ì‚°ì¶œí•©ë‹ˆë‹¤.
* **ì ìš© ë°©ì•ˆ:**
    * `SpecCollector` (ë˜ëŠ” `MarketDataCollector`)ì— **íˆ¬ììë³„ ë§¤ë§¤ë™í–¥(Investor Trading Data)** ìˆ˜ì§‘ ê¸°ëŠ¥ì„ ì¶”ê°€í•©ë‹ˆë‹¤. (í•œêµ­ ì£¼ì‹ì˜ ê²½ìš° ë„¤ì´ë²„ ê¸ˆìœµ/KRX í¬ë¡¤ë§)
    * **ë¡œì§:** "ì™¸êµ­ì¸ 5ì¼ ì—°ì† ìˆœë§¤ìˆ˜ + ê¸°ê´€ 3ì¼ ì—°ì† ìˆœë§¤ìˆ˜ = ê°•ë ¥ ë§¤ìˆ˜ ì‹œê·¸ë„"
    * **íš¨ê³¼:** "ëˆ„ê°€(Who)" ì‚¬ëŠ”ì§€ë¥¼ íŒŒì•…í•˜ì—¬ **ì„¸ë ¥ì˜ ì›€ì§ì„**ì— í¸ìŠ¹í•˜ëŠ” ì „ëµì´ ê°€ëŠ¥í•´ì§‘ë‹ˆë‹¤.

### 3. ğŸ“Š **"ì¸í„°ë™í‹°ë¸Œ ëŒ€ì‹œë³´ë“œ (Interactive Dashboard)"**
* **ê¸°ì¡´ ì‹œìŠ¤í…œ:** React ê¸°ë°˜ í”„ë¡ íŠ¸ì—”ë“œ ê³„íšì€ ìˆìœ¼ë‚˜ êµ¬ì²´ì ì´ì§€ ì•ŠìŒ.
* **ìƒˆ ì•„ì´ë””ì–´:** `Lightweight Charts` (TradingView)ë¥¼ í™œìš©í•œ ê¹”ë”í•œ ì°¨íŠ¸ UIì™€ **AI ì¶”ì²œ ì¢…ëª© ë¦¬ìŠ¤íŠ¸**ë¥¼ í•œëˆˆì— ë³´ì—¬ì£¼ëŠ” ëŒ€ì‹œë³´ë“œ êµ¬ì¡°ì…ë‹ˆë‹¤.
* **ì ìš© ë°©ì•ˆ:**
    * ì‚¬ìš©ìë‹˜ì˜ React í”„ë¡ íŠ¸ì—”ë“œì— `another_stock_project_blueprint.md`ì˜ `index.html` êµ¬ì¡°ë¥¼ ì°¸ê³ í•˜ì—¬ **ì°¨íŠ¸/ì¶”ì²œ ì¢…ëª©/ì‹œì¥ ì§€ìˆ˜** ì„¹ì…˜ì„ êµ¬ì„±í•©ë‹ˆë‹¤.
    * **ê¸°ëŠ¥:** "Run Analysis" ë²„íŠ¼ í•˜ë‚˜ë¡œ ì „ì²´ ë¶„ì„ì„ ì‹¤í–‰í•˜ê³  ê²°ê³¼ë¥¼ ì¦‰ì‹œ ì‹œê°í™”í•©ë‹ˆë‹¤.

---

### ğŸš€ í†µí•© ì‹¤í–‰ ê³„íš (Spec-Kit Task)

ì‚¬ìš©ìë‹˜ì˜ ì‹œìŠ¤í…œì„ ì—…ê·¸ë ˆì´ë“œí•˜ê¸° ìœ„í•´ ë‹¤ìŒ ì‘ì—…ì„ ì¶”ê°€í•˜ëŠ” ê²ƒì„ ì¶”ì²œí•©ë‹ˆë‹¤.

1.  **`WaveAnalyzer.py` êµ¬í˜„:** íŒŒë™ ì´ë¡  ê¸°ë°˜ì˜ ê¸°ìˆ ì  ë¶„ì„ ëª¨ë“ˆ ì¶”ê°€.
2.  **`InstitutionalTracker.py` êµ¬í˜„:** ìˆ˜ê¸‰ ë°ì´í„° ìˆ˜ì§‘ ë° ì ìˆ˜í™” ëª¨ë“ˆ ì¶”ê°€.
3.  **ëŒ€ì‹œë³´ë“œ ê°•í™”:** TradingView ì°¨íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë„ì….

ì´ ì•„ì´ë””ì–´ë“¤ì€ ì‚¬ìš©ìë‹˜ì˜ ì‹œìŠ¤í…œì„ **"ë‹¨ìˆœ í†µê³„ ë¶„ì„"**ì—ì„œ **"ì¶”ì„¸ ì¶”ì¢…(Trend Following) ë° ìˆ˜ê¸‰ ë¶„ì„"**ì´ ê°€ëŠ¥í•œ ì‹¤ì „í˜• ì‹œìŠ¤í…œìœ¼ë¡œ ì—…ê·¸ë ˆì´ë“œí•´ ì¤„ ê²ƒì…ë‹ˆë‹¤.

**"íŒŒë™ ë¶„ì„ ë¡œì§(`analysis2.py` ì°¸ê³ )"ì„ ì‚¬ìš©ìë‹˜ì˜ ì‹œìŠ¤í…œì— ë§ê²Œ ë³€í™˜í•´ ë“œë¦´ê¹Œìš”?**




ë‚˜ì˜ ë§ : 
ì¶”ê°€ë¡œ, FRED ì™€ í•œêµ­ dart apië„ ë°œê¸‰ë°›ì•˜ëŠ”ë° ë¬´ë£Œ í•œë„ë‚´ì—ì„œ ì‚¬ìš© í•  ìˆ˜ ìˆë„ë¡ ì¶”ê°€ êµ¬í˜„í•´ì¤˜




geminiì˜ ë‹µë³€
ë„¤, \*\*FRED (ë¯¸êµ­ ê±°ì‹œê²½ì œ ë°ì´í„°)\*\*ì™€ **DART (í•œêµ­ ê¸°ì—… ê³µì‹œ)** APIëŠ” ë¬´ë£Œ í•œë„ê°€ ë§¤ìš° ë„‰ë„‰í•˜ì—¬ ê°œì¸ íˆ¬ììì—ê²ŒëŠ” ì‚¬ì‹¤ìƒ ë¬´ì œí•œì´ë‚˜ ë‹¤ë¦„ì—†ìŠµë‹ˆë‹¤. ì´ ë‘ ê°€ì§€ë¥¼ ì¶”ê°€í•˜ë©´ \*\*'ê¸€ë¡œë²Œ ë§¤í¬ë¡œ ë¶„ì„'\*\*ê³¼ **'í•œêµ­ ì£¼ì‹ í€ë”ë©˜í„¸ ë¶„ì„'** ëŠ¥ë ¥ì´ íšê¸°ì ìœ¼ë¡œ í–¥ìƒë©ë‹ˆë‹¤.

ê¸°ì¡´ `SpecCollector`ë‚˜ `YahooFinanceCollector`ì™€ ë™ì¼í•œ íŒ¨í„´ìœ¼ë¡œ, **ë¬´ë£Œ í•œë„ë¥¼ ì¤€ìˆ˜í•˜ë©´ì„œ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ê³  Feature Storeì— ì €ì¥í•˜ëŠ” êµ¬í˜„ ë°©ì•ˆ**ì„ ì •ë¦¬í•´ ë“œë¦½ë‹ˆë‹¤.

-----

### âš™ï¸ 1. í™˜ê²½ ì„¤ì • (`.env` & `config.py`)

ë¨¼ì € API í‚¤ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •ì„ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.

**`.env` íŒŒì¼ ì¶”ê°€**

```bash
# Macro Data (FRED)
FRED_API_KEY=your_fred_api_key_here

# Korean Disclosure (DART)
DART_API_KEY=your_dart_api_key_here
```

**`backend/config.py` ìˆ˜ì •**

```python
class Settings(BaseSettings):
    # ... ê¸°ì¡´ ì„¤ì • ...
    fred_api_key: str = Field(default="", env="FRED_API_KEY")
    dart_api_key: str = Field(default="", env="DART_API_KEY")
```

-----

### ğŸ›ï¸ 2. FRED ìˆ˜ì§‘ê¸° (`backend/data/collectors/fred_collector.py`)

FRED ë°ì´í„°ëŠ” **'ì‹œì¥ êµ­ë©´(Regime)'** íŒë‹¨ì˜ í•µì‹¬ì…ë‹ˆë‹¤. `pandas-datareader` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ë©´ ë§¤ìš° ì‰½ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**í•„ìš” ë¼ì´ë¸ŒëŸ¬ë¦¬:** `pip install pandas-datareader`

```python
"""
FRED Collector - ë¯¸êµ­ ê±°ì‹œê²½ì œ ì§€í‘œ ìˆ˜ì§‘ê¸°
ë¬´ë£Œ í•œë„: ë¶„ë‹¹ 120íšŒ ìš”ì²­ (ì¶©ë¶„í•¨)
"""
import pandas_datareader.data as web
import pandas as pd
from datetime import datetime, timedelta
import asyncio
from backend.config import get_settings

# ì£¼ìš” ê°ì‹œ ì§€í‘œ ë§¤í•‘
MACRO_INDICATORS = {
    "FEDFUNDS": "Federal Funds Rate (ê¸ˆë¦¬)",
    "DGS10": "10-Year Treasury Yield (ì¥ê¸°ê¸ˆë¦¬)",
    "DGS2": "2-Year Treasury Yield (ë‹¨ê¸°ê¸ˆë¦¬)",
    "T10Y2Y": "10Y-2Y Yield Spread (ì¥ë‹¨ê¸° ê¸ˆë¦¬ì°¨ - ê²½ê¸°ì¹¨ì²´ ì‹ í˜¸)",
    "CPIAUCSL": "CPI (ì†Œë¹„ì ë¬¼ê°€ì§€ìˆ˜)",
    "UNRATE": "Unemployment Rate (ì‹¤ì—…ë¥ )",
    "M2SL": "M2 Money Stock (ìœ ë™ì„±)",
    "VIXCLS": "VIX (ê³µí¬ì§€ìˆ˜)"
}

class FredCollector:
    def __init__(self):
        self.settings = get_settings()
        self.api_key = self.settings.fred_api_key

    async def fetch_macro_data(self, days: int = 365 * 2) -> pd.DataFrame:
        """
        ì£¼ìš” ê±°ì‹œê²½ì œ ì§€í‘œë¥¼ í•œ ë²ˆì— ìˆ˜ì§‘
        """
        start_date = datetime.now() - timedelta(days=days)
        end_date = datetime.now()
        
        # pandas_datareaderëŠ” ë™ê¸° í•¨ìˆ˜ì´ë¯€ë¡œ ë¹„ë™ê¸°ë¡œ ë˜í•‘
        try:
            df = await asyncio.to_thread(
                web.DataReader,
                list(MACRO_INDICATORS.keys()),
                'fred',
                start_date,
                end_date,
                api_key=self.api_key
            )
            
            # ê²°ì¸¡ì¹˜ ì²˜ë¦¬ (ì£¼ë§/ê³µíœ´ì¼ ë°ì´í„° ì±„ì›€)
            df = df.ffill()
            return df
            
        except Exception as e:
            print(f"[FRED Error] Failed to fetch data: {e}")
            return pd.DataFrame()

# ì‚¬ìš© ì˜ˆì‹œ
if __name__ == "__main__":
    async def main():
        collector = FredCollector()
        df = await collector.fetch_macro_data()
        print(df.tail())
    asyncio.run(main())
```

**í™œìš© ë°©ì•ˆ:** `ChatGPTStrategy`ì— ì´ ë°ì´í„°ë¥¼ ì£¼ì…í•˜ì—¬ **"í˜„ì¬ ì¥ë‹¨ê¸° ê¸ˆë¦¬ì°¨ê°€ ì—­ì „ë˜ì—ˆìœ¼ë‹ˆ ì¹¨ì²´ ëŒ€ë¹„(Risk-Off)"** ê°™ì€ íŒë‹¨ì„ ë‚´ë¦¬ê²Œ í•©ë‹ˆë‹¤.

-----

### ğŸ‡°ğŸ‡· 3. DART ìˆ˜ì§‘ê¸° (`backend/data/collectors/dart_collector.py`)

í•œêµ­ ì£¼ì‹(`KIS API`) ê±°ë˜ ì‹œ í•„ìˆ˜ì…ë‹ˆë‹¤. `OpenDartReader` ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ê°€ì¥ ê°•ë ¥í•©ë‹ˆë‹¤.

**í•„ìš” ë¼ì´ë¸ŒëŸ¬ë¦¬:** `pip install opendartreader`

```python
"""
DART Collector - í•œêµ­ ê¸°ì—… ê³µì‹œ ë° ì¬ë¬´ì œí‘œ ìˆ˜ì§‘ê¸°
ë¬´ë£Œ í•œë„: ì¼ 10,000íšŒ (ê°œì¸ íˆ¬ììì—ê²ŒëŠ” ë¬´ì œí•œê¸‰)
"""
import OpenDartReader
import asyncio
import pandas as pd
from backend.config import get_settings

class DartCollector:
    def __init__(self):
        self.settings = get_settings()
        # OpenDartReader ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
        self.dart = OpenDartReader(self.settings.dart_api_key)

    async def get_financial_summary(self, stock_code: str, year: int) -> dict:
        """
        íŠ¹ì • ê¸°ì—…ì˜ ì—°ê°„/ë¶„ê¸° ì¬ë¬´ì œí‘œ í•µì‹¬ ìš”ì•½ (ë§¤ì¶œ, ì˜ì—…ì´ìµ, ìˆœì´ìµ)
        """
        try:
            # 1. ì¬ë¬´ì œí‘œ ì¡°íšŒ (ë¹„ë™ê¸° ë˜í•‘)
            # reprt_code: 11011(ì‚¬ì—…), 11012(ë°˜ê¸°), 11013(1ë¶„ê¸°), 11014(3ë¶„ê¸°)
            df = await asyncio.to_thread(
                self.dart.finstate,
                stock_code,
                year,
                "11014" # ì˜ˆ: 3ë¶„ê¸° ë³´ê³ ì„œ
            )

            if df is None or df.empty:
                return {}

            # 2. í•µì‹¬ ë°ì´í„° ì¶”ì¶œ (ì—°ê²°ì¬ë¬´ì œí‘œ ê¸°ì¤€)
            target_accounts = ['ë§¤ì¶œì•¡', 'ì˜ì—…ì´ìµ', 'ë‹¹ê¸°ìˆœì´ìµ']
            result = {}
            
            for account in target_accounts:
                row = df[(df['account_nm'] == account) & (df['fs_div'] == 'CFS')] # CFS: ì—°ê²°
                if not row.empty:
                    # ë‹¹ê¸° ê¸ˆì•¡ (thstrm_amount)
                    amount_str = row.iloc[0]['thstrm_amount']
                    result[account] = float(amount_str.replace(',', '')) if amount_str else 0

            return result

        except Exception as e:
            print(f"[DART Error] {stock_code}: {e}")
            return {}

    async def check_major_disclosures(self, stock_code: str, days: int = 3) -> list:
        """
        ìµœê·¼ nì¼ê°„ì˜ ì£¼ìš” ê³µì‹œ í™•ì¸ (ë‹¨ì¼íŒë§¤ê³µê¸‰ê³„ì•½ ë“±)
        """
        # 3ì¼ì „ ë‚ ì§œ ê³„ì‚°
        from datetime import datetime, timedelta
        start_date = (datetime.now() - timedelta(days=days)).strftime("%Y%m%d")
        
        try:
            df = await asyncio.to_thread(
                self.dart.list,
                stock_code,
                start=start_date
            )
            
            if df is None or df.empty:
                return []
                
            # ì¤‘ìš”í•œ ê³µì‹œë§Œ í•„í„°ë§
            important_keywords = ['ë‹¨ì¼íŒë§¤', 'ê³µê¸‰ê³„ì•½', 'ë¬´ìƒì¦ì', 'ì†Œì†¡', 'ì •ì§€']
            filtered = df[df['report_nm'].str.contains('|'.join(important_keywords))]
            
            return filtered[['rcept_dt', 'report_nm', 'rcept_no']].to_dict('records')

        except Exception as e:
            print(f"[DART Error] Disclosure check failed: {e}")
            return []

# ì‚¬ìš© ì˜ˆì‹œ
if __name__ == "__main__":
    async def main():
        collector = DartCollector()
        # ì‚¼ì„±ì „ì(005930) 2024ë…„ ì¬ë¬´ í™•ì¸
        fin = await collector.get_financial_summary("005930", 2024)
        print(f"ì‚¼ì„±ì „ì ì¬ë¬´: {fin}")
        
        # ìµœê·¼ ê³µì‹œ í™•ì¸
        news = await collector.check_major_disclosures("005930")
        print(f"ì£¼ìš” ê³µì‹œ: {news}")

    asyncio.run(main())
```

-----

### ğŸ—ï¸ 4. ì‹œìŠ¤í…œ í†µí•© (Spec-Kit Task)

ì´ ìˆ˜ì§‘ê¸°ë“¤ì„ ì‹œìŠ¤í…œì— ì—°ê²°í•˜ëŠ” ì‘ì—…ì…ë‹ˆë‹¤.

1.  **DB ìŠ¤í‚¤ë§ˆ ì¶”ê°€ (`backend/data/models/macro_financial.py`)**:

      * `macro_indicators`: FRED ë°ì´í„° ì €ì¥ìš© (Date, Indicator, Value).
      * `kr_financials`: DART ì¬ë¬´ ë°ì´í„° ì €ì¥ìš© (Ticker, Year, Quarter, Revenue, Profit).

2.  **ìˆ˜ì§‘ ìŠ¤ì¼€ì¤„ëŸ¬ ë“±ë¡ (`backend/main.py` ë˜ëŠ” `scheduler`)**:

      * **FRED:** ë§¤ì¼ ì•„ì¹¨ 7ì‹œ (ë¯¸êµ­ ì¥ ë§ˆê° í›„) 1íšŒ ì—…ë°ì´íŠ¸.
      * **DART:** ì¥ì¤‘ 1ì‹œê°„ ê°„ê²© ê³µì‹œ ì²´í¬(Disclosure) + ë¶„ê¸°ë³„ 1íšŒ ì¬ë¬´ ì—…ë°ì´íŠ¸.

3.  **ì „ëµ ì—°ê²°**:

      * `ChatGPTStrategy`ëŠ” `macro_indicators` í…Œì´ë¸”ì„ ì¡°íšŒí•˜ì—¬ `MarketRegime`ì„ ê²°ì •í•©ë‹ˆë‹¤.
      * `ClaudeStrategy`ëŠ” í•œêµ­ ì£¼ì‹ì„ ë¶„ì„í•  ë•Œ `kr_financials` í…Œì´ë¸” ë°ì´í„°ë¥¼ í•¨ê»˜ ë´…ë‹ˆë‹¤.

ì´ ë‘ APIëŠ” **ë¬´ë£Œì´ë©´ì„œë„ ë°ì´í„°ì˜ ì§ˆì´ ë§¤ìš° ë†’ì•„ì„œ**, ì¶”ê°€ ë¹„ìš© ì—†ì´ ì‹œìŠ¤í…œì˜ ë¶„ì„ë ¥ì„ í¬ê²Œ ë†’ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë°”ë¡œ ì ìš©í•˜ì‹œëŠ” ê²ƒì„ ì¶”ì²œí•©ë‹ˆë‹¤!
